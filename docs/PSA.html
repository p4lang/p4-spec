<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <meta name="generator" content="Madoko, version 1.1.0" />
  <meta name="viewport" content="initial-scale=1.0" />
  <meta name="author" content="The P4.org language consortium" />
  <title>P4~16~ Portable Switch Architecture (PSA)</title>
  <style type="text/css"  class="link">
  /*# sourceURL=madoko.css */
  
  .madoko .toc>.tocblock .tocblock .tocblock {
    margin-left: 2.25em;
  }
  .madoko .toc>.tocblock .tocblock {
    margin-left: 1.5em;
  }
  .madoko .toc-contents>.tocblock>.tocitem {
    font-weight: bold;
  }
  .madoko .toc {
    margin-top: 1em;
  }
  .madoko p.para-continue {
    margin-bottom: 0pt;
  }
  .madoko .para-block+p {
    margin-top: 0pt;
  }
  .madoko ul.para-block, .madoko ol.para-block {
    margin-top: 0pt;
    margin-bottom: 0pt;
  }
  .madoko ul.para-end, .madoko ol.para-end {
    margin-bottom: 1em;
  }
  .madoko dl {
    margin-left: 0em;
  }
  .madoko blockquote {
    font-style: italic;
  }
  .madoko a.localref {
    text-decoration: none;
  }
  .madoko a.localref:hover {
    text-decoration: underline;
  }
  .madoko .footnotes {
    font-size: smaller;
    margin-top: 2em;
  }
  .madoko .footnotes hr {
    width: 50%;
    text-align: left;
  }
  .madoko .footnote { 
    margin-left: 1em;
  }
  .madoko .footnote-before {
    margin-left: -1em;
    width: 1em;
    display: inline-block;
  }
  .madoko .align-center, .madoko .align-center>p {
    text-align: center !important;
  }
  .madoko .align-center pre {
    text-align: left;
  }
  .madoko .align-center>* {
    margin-left: auto !important;
    margin-right: auto !important;
  }
  .madoko .align-left, .madoko .align-left>p {
    text-align: left !important;
  }
  .madoko .align-left>* {
    margin-left: 0pt !important;
    margin-right: auto !important;
  }
  .madoko .align-right, .madoko .align-right>p {
    text-align: right !important;
  }
  .madoko .align-right>* {
    margin-left: auto !important;
    margin-right: 0pt !important;
  }
  .madoko .align-center>table,
  .madoko .align-left>table,
  .madoko .align-right>table {
    text-align: left !important;
  }
  .madoko .equation-before {
    float: right;
  }
  .madoko .bibitem {
    font-size: smaller;
  }
  .madoko .bibsearch {
    font-size: x-small;
    text-decoration:none;
    color: black;
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  .madoko .block, .madoko .figure, .madoko .bibitem, .madoko .equation, .madoko div.math {
    margin-top: 1ex;
    margin-bottom: 1ex;
  }
  .madoko .figure {
    padding: 0.5em;
    margin-left: 0pt;
    margin-right: 0pt;
  }
  .madoko .hidden {
    display: none;
  }
  .madoko .invisible {
    visibility: hidden;
  }
  .madoko.preview .invisible {
    visibility: visible;
    opacity: 0.5;
  }
  .madoko code.code, .madoko span.code {
    white-space: pre-wrap;
  }
  .madoko hr, hr.madoko {
    border: none;
    border-bottom: black solid 1px;
    margin-bottom: 0.5ex;
  }
  .madoko .framed>*:first-child {
    margin-top: 0pt;
  }
  .madoko .framed>*:last-child {
    margin-bottom: 0pt;
  }
  .madoko ul.list-style-type-dash {
      list-style-type: none !important;
  }
  .madoko ul.list-style-type-dash > li:before {
      content: "\2013"; 
      position: absolute;
      margin-left: -1em; 
  }
  .madoko table.madoko {
    border-collapse: collapse;
  }
  .madoko td, .madoko th {
    padding: 0ex 0.5ex;
    margin: 0pt;
    vertical-align: top;
  }
  .madoko .cell-border-left {
    border-left: 1px solid black;
  }
  .madoko .cell-border-right {
    border-right: 1px solid black;
  }
  .madoko thead>tr:first-child>.cell-line,
  .madoko tbody:first-child>tr:first-child>.cell-line {
    border-top: 1px solid black;
    border-bottom: none;
  }
  .madoko .cell-line, .madoko .cell-double-line {
    border-bottom: 1px solid black;
    border-top: none;
  }
  .madoko .cell-double-line {
    border-top: 1px solid black;
    padding-top: 1.5px !important;
  }
  .madoko .input-mathpre .MathJax_Display {
    text-align: left !important;
  }
  .madoko div.input-mathpre {
    text-align: left;
    margin-top: 1.5ex;
    margin-bottom: 1ex;
  }
  .madoko .math-rendering {
    white-space: pre;
    color: gray;
  }
  .madoko .mathdisplay {
    text-align: center;
  }
  .madoko .pretty table {
    border-collapse: collapse;
  }
  .madoko .pretty td {
    padding: 0em;
  }
  .madoko .pretty td.empty {
    min-width: 1.5ex;
  }
  .madoko .pretty td.expander {
    width: 100em;
  }
  body.madoko, .madoko .serif {
    font-family: Cambria,"Times New Roman","Liberation Serif","Times",serif;
  }
  .madoko .sans-serif {
    font-family: "Calibri", "Optima", sans-serif;
  }
  .madoko .symbol {
    font-family: "Segoe UI Symbol", Symbola, serif;
  }
  body.madoko {  
    -webkit-text-size-adjust: 100%;       
    text-rendering: optimizeLegibility;
  }
  body.madoko {
    max-width: 88ex; 
    margin: 1em auto;
    padding: 0em 2em;  
  }
  body.preview.madoko {
    padding: 0em 1em;
  }
  .madoko p {
    text-align: justify;
  }
  .madoko h1, .madoko h2, .madoko h3, .madoko h4 { 
    margin-top: 1.22em; 
    margin-bottom: 1ex;
  }
  .madoko h1+p, .madoko h2+p, .madoko h3+p, .madoko h4+p, .madoko h5+p  { 
    margin-top: 1ex;    
  }
  .madoko h5, .madoko h6 { 
    margin-top: 1ex;
    font-size: 1em;
  }
  .madoko h5 { 
    margin-bottom: 0.5ex;
  }
  .madoko h5 + p {
    margin-top: 0.5ex;
  }
  .madoko h6 { 
    margin-bottom: 0pt;
  }
  .madoko h6 + p {
    margin-top: 0pt;
  }
  .madoko pre, .madoko code, .madoko kbd, .madoko samp, .madoko tt, 
  .madoko .monospace, .madoko .token-indent, .madoko .reveal pre, .madoko .reveal code, .madoko .email {
    font-family: Consolas,"Andale Mono WT","Andale Mono",Lucida Console,Monaco,monospace,monospace;
    font-size: 0.85em;
  }
  .madoko pre code, .madoko .token-indent {
    font-size: 0.95em;
  }
  .madoko pre code {
    font-family: inherit !important;
  }
  .madoko ol.linenums li {
    background-color: white;
    list-style-type: decimal;
  }
  .madoko .remote {
    background-color: #F0FFF0;
  }
  .madoko .remote + * {
    margin-top: 0pt;
  }
  @media print {
    body.madoko {
      font-size: 10pt;
    }
    @page {
      margin: 1in 1.5in;
    }
  }
  @media only screen and (max-device-width:1024px) {
    body.madoko {
      padding: 0em 0.5em;    
    }
    .madoko li {
      text-align: left;
    }
  }
  
    </style>
  
  </head>
<body class="madoko">

<div class="body madoko" style="line-adjust:0">

<div class="titleblock align-center para-block" data-line="35" style="text-align:center;line-adjust:0">
<div class="titleheader align-center" data-line="35" style="text-align:center;line-adjust:0">
<div class="title para-block" data-line="35" style="font-size:xx-large;font-weight:bold;margin-bottom:0.5ex;line-adjust:0"><span data-line="35"></span>P4<sub>16</sub> Portable Switch Architecture (PSA)</div>
<div class="titlenote para-block" data-line="38" style="line-adjust:0"><span data-line="38"></span>(draft)</div></div>
<div class="authors align-center" data-line="43" style="text-align:center;width:80%;line-adjust:0"><table class="authorrow columns block" data-line="43" style="margin-top:2ex;width:100%;line-adjust:0">
<tbody><tr><td class="author column" data-line="43" style="text-align:center;line-adjust:0">
<div class="authorname" data-line="43" style="font-size:large;line-adjust:0"><span data-line="43"></span>The P4.org language consortium</div></td></tr></tbody></table></div>
<div class="titlefooter align-center" data-line="52" style="text-align:center;margin-top:0.5ex;line-adjust:0"><span data-line="52"></span>2017-10-13</div></div>
<p class="p noindent para-continued" data-line="36"><span data-line="36"></span><span data-line="36"></span>
<span data-line="37"></span><span data-line="37"></span>
<span data-line="38"></span><span data-line="38"></span>
<span data-line="39"></span><span data-line="39"></span>
<span data-line="40"></span><span data-line="40"></span>
<span data-line="41"></span><span data-line="41"></span>
</p>
<div class="abstract" data-line="43" style="margin-left:3em;margin-right:3em;font-size:small">
<p class="p noindent" data-line="44"><span data-line="44"></span><strong class="strong-star2">Abstract.</strong><span data-line="44"></span> 
P4 is a language for expressing how packets are processed by the data
plane of a programmable network forwarding element. P4 programs
specify how the various programmable blocks of a target architecture
are programmed and connected.  The Portable Switch Architecture (PSA)
is target architecture that describes common capabilities of network
switch devices which process and forward packets across multiple
interface ports.
</p></div><span data-line="55"></span>
<nav class="toc toc-contents"><h2 id="sec-contents" class="clearnum h1 heading-contents" data-heading-depth="1" style="display:block">Contents</h2>
<div class="tocblock tocblock1">
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-target-architecture-model" data-toc-depth="1" data-toc-line="[1]{.heading-label}.&#8194;Target Architecture Model" style="toctarget:sec-target-architecture-model"><a href="#sec-target-architecture-model" class="localref"><span class="heading-label">1</span>.&#8194;Target Architecture Model</a></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-naming-conventions" data-toc-depth="1" data-toc-line="[2]{.heading-label}.&#8194;Naming conventions" style="toctarget:sec-naming-conventions"><a href="#sec-naming-conventions" class="localref"><span class="heading-label">2</span>.&#8194;Naming conventions</a></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-psa-data-types" data-toc-depth="1" data-toc-line="[3]{.heading-label}.&#8194;PSA Data types" style="toctarget:sec-psa-data-types"><a href="#sec-psa-data-types" class="localref"><span class="heading-label">3</span>.&#8194;PSA Data types</a></div>
<div class="tocblock tocblock2">
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-psa-type-definitions" data-toc-depth="2" data-toc-line="[3.1]{.heading-label}.&#8194;PSA type definitions" style="toctarget:sec-psa-type-definitions"><a href="#sec-psa-type-definitions" class="localref"><span class="heading-label">3.1</span>.&#8194;PSA type definitions</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-psa-supported-metadata-types" data-toc-depth="2" data-toc-line="[3.2]{.heading-label}.&#8194;PSA supported metadata types" style="toctarget:sec-psa-supported-metadata-types"><a href="#sec-psa-supported-metadata-types" class="localref"><span class="heading-label">3.2</span>.&#8194;PSA supported metadata types</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-match-kinds" data-toc-depth="2" data-toc-line="[3.3]{.heading-label}.&#8194;Match kinds" style="toctarget:sec-match-kinds"><a href="#sec-match-kinds" class="localref"><span class="heading-label">3.3</span>.&#8194;Match kinds</a></div></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-psa-externs" data-toc-depth="1" data-toc-line="[4]{.heading-label}.&#8194;PSA Externs" style="toctarget:sec-psa-externs"><a href="#sec-psa-externs" class="localref"><span class="heading-label">4</span>.&#8194;PSA Externs</a></div>
<div class="tocblock tocblock2">
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-extern-restrictions" data-toc-depth="2" data-toc-line="[4.1]{.heading-label}.&#8194;Restrictions on where externs may be used" style="toctarget:sec-extern-restrictions"><a href="#sec-extern-restrictions" class="localref"><span class="heading-label">4.1</span>.&#8194;Restrictions on where externs may be used</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-pre" data-toc-depth="2" data-toc-line="[4.2]{.heading-label}.&#8194;Packet Replication Engine" style="toctarget:sec-pre"><a href="#sec-pre" class="localref"><span class="heading-label">4.2</span>.&#8194;Packet Replication Engine</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-after-ingress" data-toc-depth="3" data-toc-line="[4.2.1]{.heading-label}.&#8194;Behavior of packets after Ingress processing is complete" style="toctarget:sec-after-ingress"><a href="#sec-after-ingress" class="localref"><span class="heading-label">4.2.1</span>.&#8194;Behavior of packets after Ingress processing is complete</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-after-egress" data-toc-depth="3" data-toc-line="[4.2.2]{.heading-label}.&#8194;Behavior of packets after Egress processing is complete" style="toctarget:sec-after-egress"><a href="#sec-after-egress" class="localref"><span class="heading-label">4.2.2</span>.&#8194;Behavior of packets after Egress processing is complete</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-ingress-actions" data-toc-depth="3" data-toc-line="[4.2.3]{.heading-label}.&#8194;Actions for directing packets during ingress" style="toctarget:sec-ingress-actions"><a href="#sec-ingress-actions" class="localref"><span class="heading-label">4.2.3</span>.&#8194;Actions for directing packets during ingress</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-clone-recirculate-resubmit" data-toc-depth="3" data-toc-line="[4.2.4]{.heading-label}.&#8194;Clone, Recirculate, Resubmit" style="toctarget:sec-clone-recirculate-resubmit"><a href="#sec-clone-recirculate-resubmit" class="localref"><span class="heading-label">4.2.4</span>.&#8194;Clone, Recirculate, Resubmit</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-bqe" data-toc-depth="2" data-toc-line="[4.3]{.heading-label}.&#8194;Buffering Queuing Engine" style="toctarget:sec-bqe"><a href="#sec-bqe" class="localref"><span class="heading-label">4.3</span>.&#8194;Buffering Queuing Engine</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-egress-actions" data-toc-depth="3" data-toc-line="[4.3.1]{.heading-label}.&#8194;Actions for directing packets during egress" style="toctarget:sec-egress-actions"><a href="#sec-egress-actions" class="localref"><span class="heading-label">4.3.1</span>.&#8194;Actions for directing packets during egress</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-hash-algorithms" data-toc-depth="2" data-toc-line="[4.4]{.heading-label}.&#8194;Hashes" style="toctarget:sec-hash-algorithms"><a href="#sec-hash-algorithms" class="localref"><span class="heading-label">4.4</span>.&#8194;Hashes</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-hash-function" data-toc-depth="3" data-toc-line="[4.4.1]{.heading-label}.&#8194;Hash function" style="toctarget:sec-hash-function"><a href="#sec-hash-function" class="localref"><span class="heading-label">4.4.1</span>.&#8194;Hash function</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-checksum-computation" data-toc-depth="2" data-toc-line="[4.5]{.heading-label}.&#8194;Checksum computation" style="toctarget:sec-checksum-computation"><a href="#sec-checksum-computation" class="localref"><span class="heading-label">4.5</span>.&#8194;Checksum computation</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-checksum-example" data-toc-depth="3" data-toc-line="[4.5.1]{.heading-label}.&#8194;Checksum example" style="toctarget:sec-checksum-example"><a href="#sec-checksum-example" class="localref"><span class="heading-label">4.5.1</span>.&#8194;Checksum example</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-counters" data-toc-depth="2" data-toc-line="[4.6]{.heading-label}.&#8194;Counters" style="toctarget:sec-counters"><a href="#sec-counters" class="localref"><span class="heading-label">4.6</span>.&#8194;Counters</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-counter-types" data-toc-depth="3" data-toc-line="[4.6.1]{.heading-label}.&#8194;Counter types" style="toctarget:sec-counter-types"><a href="#sec-counter-types" class="localref"><span class="heading-label">4.6.1</span>.&#8194;Counter types</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-counter" data-toc-depth="3" data-toc-line="[4.6.2]{.heading-label}.&#8194;Counter" style="toctarget:sec-counter"><a href="#sec-counter" class="localref"><span class="heading-label">4.6.2</span>.&#8194;Counter</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-direct-counter" data-toc-depth="3" data-toc-line="[4.6.3]{.heading-label}.&#8194;Direct Counter" style="toctarget:sec-direct-counter"><a href="#sec-direct-counter" class="localref"><span class="heading-label">4.6.3</span>.&#8194;Direct Counter</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-example-program-using-counters" data-toc-depth="3" data-toc-line="[4.6.4]{.heading-label}.&#8194;Example program using counters" style="toctarget:sec-example-program-using-counters"><a href="#sec-example-program-using-counters" class="localref"><span class="heading-label">4.6.4</span>.&#8194;Example program using counters</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-meters" data-toc-depth="2" data-toc-line="[4.7]{.heading-label}.&#8194;Meters" style="toctarget:sec-meters"><a href="#sec-meters" class="localref"><span class="heading-label">4.7</span>.&#8194;Meters</a></div>
<div class="tocblock tocblock3">
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-meter-types" data-toc-depth="3" data-toc-line="[4.7.1]{.heading-label}.&#8194;Meter types" style="toctarget:sec-meter-types"><a href="#sec-meter-types" class="localref"><span class="heading-label">4.7.1</span>.&#8194;Meter types</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-meter-colors" data-toc-depth="3" data-toc-line="[4.7.2]{.heading-label}.&#8194;Meter colors" style="toctarget:sec-meter-colors"><a href="#sec-meter-colors" class="localref"><span class="heading-label">4.7.2</span>.&#8194;Meter colors</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-meter" data-toc-depth="3" data-toc-line="[4.7.3]{.heading-label}.&#8194;Meter" style="toctarget:sec-meter"><a href="#sec-meter" class="localref"><span class="heading-label">4.7.3</span>.&#8194;Meter</a></div>
<div class="tocitem tocitem3" data-toc-target-elem="h3" data-toc-target="sec-direct-meter" data-toc-depth="3" data-toc-line="[4.7.4]{.heading-label}.&#8194;Direct Meter" style="toctarget:sec-direct-meter"><a href="#sec-direct-meter" class="localref"><span class="heading-label">4.7.4</span>.&#8194;Direct Meter</a></div></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-registers" data-toc-depth="2" data-toc-line="[4.8]{.heading-label}.&#8194;Registers" style="toctarget:sec-registers"><a href="#sec-registers" class="localref"><span class="heading-label">4.8</span>.&#8194;Registers</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-random" data-toc-depth="2" data-toc-line="[4.9]{.heading-label}.&#8194;Random" style="toctarget:sec-random"><a href="#sec-random" class="localref"><span class="heading-label">4.9</span>.&#8194;Random</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-action-profile" data-toc-depth="2" data-toc-line="[4.10]{.heading-label}.&#8194;Action Profile" style="toctarget:sec-action-profile"><a href="#sec-action-profile" class="localref"><span class="heading-label">4.10</span>.&#8194;Action Profile</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-action-selector" data-toc-depth="2" data-toc-line="[4.11]{.heading-label}.&#8194;Action Selector" style="toctarget:sec-action-selector"><a href="#sec-action-selector" class="localref"><span class="heading-label">4.11</span>.&#8194;Action Selector</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-packet-generation" data-toc-depth="2" data-toc-line="[4.12]{.heading-label}.&#8194;Packet Generation" style="toctarget:sec-packet-generation"><a href="#sec-packet-generation" class="localref"><span class="heading-label">4.12</span>.&#8194;Packet Generation</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-parser-value-sets" data-toc-depth="2" data-toc-line="[4.13]{.heading-label}.&#8194;Parser Value Sets" style="toctarget:sec-parser-value-sets"><a href="#sec-parser-value-sets" class="localref"><span class="heading-label">4.13</span>.&#8194;Parser Value Sets</a></div>
<div class="tocitem tocitem2" data-toc-target-elem="h2" data-toc-target="sec-timestamps" data-toc-depth="2" data-toc-line="[4.14]{.heading-label}.&#8194;Timestamps" style="toctarget:sec-timestamps"><a href="#sec-timestamps" class="localref"><span class="heading-label">4.14</span>.&#8194;Timestamps</a></div></div>
<div class="tocitem tocitem1" data-toc-target-elem="h1" data-toc-target="sec-programmable-blocks" data-toc-depth="1" data-toc-line="[5]{.heading-label}.&#8194;Programmable blocks" style="toctarget:sec-programmable-blocks"><a href="#sec-programmable-blocks" class="localref"><span class="heading-label">5</span>.&#8194;Programmable blocks</a></div></div></nav><h2 id="sec-target-architecture-model" class="h1" data-line="57" data-heading-depth="1" style="display:block"><span data-line="57"></span><span class="heading-before"><span class="heading-label">1</span>.&#8194;</span><span data-line="57"></span>Target Architecture Model</h2>
<p class="p noindent" data-line="60"><span data-line="60"></span>The Portable Switch Architecture (PSA) Model has six programmable P4
blocks and two fixed-function blocks, as shown in Figure
<span data-line="62"></span><a href="#fig-switch" title="Portable Switch Pipeline" class="localref" style="target-element:figure"><span class="figure-label">1</span></a><span data-line="62"></span>. Programmable blocks are hardware blocks whose function
can be programmed using the P4 language. The Packet buffer and
Replication Engine (PRE) and the Buffer Queuing Engine (BQE) are
target dependent functional blocks that may be configured for a fixed
set of operations.
</p>
<p class="p indent" data-line="68"><span data-line="68"></span>Incoming packets are parsed and have their checksums validated and are
then passed to an ingress match action pipeline, which makes decisions
on where the packets should go. After the ingress pipeline, the packet
may be buffered and/or replicated (sent to multiple egress ports). For
each such egress port, the packet passes through an egress match
action pipeline and a checksum update calculation before it is
deparsed and queued to leave the pipeline. Note: the checksum
operations are available<span data-line="75"></span> <span data-line="75"></span>&#8211;<span data-line="75"></span> validation in the parser,
and checksum computation and update in deparser (see also
Table<span data-line="77"></span>&nbsp;<a href="#table-extern-usage" title="Summary of controls that can instantiate and invoke externs." class="localref" style="target-element:tablefigure"><span class="table-label">1</span></a><span data-line="77"></span>)
however, they need to be explicitly invoked though the checksum extern
in order to be executed.
</p>
<figure id="fig-switch" class="figure floating align-center float" data-line="81" style="text-align:center;float-env:figure;float-name:Figure;page-align:here">
<p class="p noindent" data-line="82"><span data-line="82"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA/0AAABsCAIAAAC3j0VMAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAdVpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpDb21wcmVzc2lvbj41PC90aWZmOkNvbXByZXNzaW9uPgogICAgICAgICA8dGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPjI8L3RpZmY6UGhvdG9tZXRyaWNJbnRlcnByZXRhdGlvbj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CrDjMt0AAC6kSURBVHgB7Z17/BVF+ceTKAlQ8S6mGHgJBRVNQg0tL10UhCBKEUVDvCUJCnLRhNTwShqoKIpoIBUICoSGd0BUEFHJEBQLTQwjpBALE4XfW5+f8532nN3vnvPdc3bP4XP+OK/Z2ZnZ2ffMzjzzzDMzW23evPlz+omACIiACIiACIiACIiACFQ1ga34SfR3RQyNTZs2ucvyO+rVq6ficNhVHA5FFhypFwcZyAKH7OQhxbZCLZVfDVL/NFQcKg6fQKbcqX8d6jgC9aE+PUeKnUcgN6lfpl4/VBx+HVBx+DRSd6deHBB4/vnnU+eQkQwcdthhKeZELZUPP/VPQ8Wh4vAJZMqd+tcBDXUcrkrQcdRzF3KIgAiIgAiIgAiIgAiIgAhUKwHJ/dVasnovERABERABERABERABEaghILm/hoVcIiACIiACIiACIiACIlCtBCT3V2vJ6r1EQAREQAREQAREQAREoIaA5P4aFnKJgAiIgAiIgAiIgAiIQLUSkNxfrSWr9xIBERABERABERABERCBGgKS+2tYyCUCIiACIiACIiACIiAC1UpAcn+1lqzeSwREQAREQAREQAREQARqCEjur2EhlwiIgAiIgAiIgAiIgAhUKwHJ/dVasnovERABERABERABERABEaghILm/hoVcIiACIiACIiACIiACIlCtBCT3V2vJ6r1EQAREQAREQAREQAREoIaA5P4aFnKJgAiIgAiIgAiIgAiIQLUSkNxfrSWr9xIBERABERABERABERCBGgKS+2tYyCUCIiACIiACIiACIiAC1UpAcn+1lqzeSwREQAREQAREQAREQARqCEjur2EhlwiIgAiIgAiIgAiIgAhUKwHJ/dVasnovERABERABERABERABEaghILm/hoVcIiACIiACIiACIiACIlCtBCT3V2vJ6r1EQAREQAREQAREQAREoIaA5P4aFnKJgAiIgAiIgAiIgAiIQLUSkNxfrSWr9xIBERABERABERABERCBGgKS+2tYyCUCIiACIiACIiACIiAC1UpAcn+1lqzeSwREQAREQAREQAREQARqCEjur2EhlwiIgAiIgAiIgAiIgAhUKwHJ/dVasnovERABERABERABERABEaghILm/hoVcIiACIiACIiACIiACIpA4gQ8++OA///mPS/Zf//rX5s2b3WXZHPXL9iQ9SAREQARSJHDOOee88MILLgMNGjTYa6+9fvzjHx9//PHOsyDH4sWLzzrrrOnTp3/5y1+OGZF2/+mnn/7a177WpEmTmFEUTAREQAREIHUCkydPvv7661026tWrt+222x522GE/+9nPGjdu7PzzOpDvBw0aNG/evNatW99xxx04RowYsXLlyjFjxtAd5I1SOk/J/aVjq5RFQASyRaB58+YXX3wxefr4449feeWVxx9/fPDgweVseVHw0PrT7h966KHZQqPciIAIiIAI1EbgF7/4xXbbbUeojRs3vvbaa3fdddd///vfm266KTreokWLnnjiidtvv33vvfcm5K9//et99tmHrseSio6b+F3J/YkjVYIiIAIZJYB65ogjjrDMtW/fvlOnTh07dnzwwQfLr3HJKCBlSwREQAREIJwACv6ddtrJ7h999NHr1q2bMmXKhx9++MUvfjE80udWrFjRqFEj4loYLnv1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HNXOkezvvffe6aefPnHiRHwuvPDCmTNnWmpswcYp6926dSMKR/D4201wqPuiRYtuvvnmTp06MXrhAHZOM3V5kEMEREAERCAjBKKba860PvPMM2nk+/btu2zZMvoC9sMl564veOGFF3r16rV69eqLL774mGOOoavyj8EO67/q+O6S++sIUNFFQAQyRACTeg6mOOSQQyxP/fr142QThPvzzz//1Vdf5VBDTrznFo0vQv/w4cM5iBRJndECza5vi2/R33nnHY5EMff48eMZKmD5w3Hobdu2HTVq1Lhx47jF3MJVV13VunXrYcOGIcEvWLBg5MiR+KMfYk9lzlHnlNMWLVrgw4FH7777Lg4GDBdccMH9999/4oknDho0iDBkzD196dKlHLvIEdqk1rFjx1mzZtmDiKifCIiACIhAdghENNdol6677joOSB08ePD2229PF0NgRHky7/oCFENLliy56KKL6CxQFe2xxx5EIZi9YFj/VcfXl51PHQEqugiIQJoEEJdNmCYTa9asmTNnDmpyflzOnj2bk4amTJmy++67c4k2pWvXrojRaNm5XLdu3a233tquXTvcJ5xwApL36NGjjzrqKC5zf4wWEL579OhBA81d5HV08FOnTj3rrLN4CicZcXSixeIMbB6KmxmAjRs3Mtg4++yzAwkyFCHMLbfccvjhh3OLuQhEfEYLzCSw1zU+W2+9NdMUOHjQypUrOWA7kIIuRUAEREAEykage/funJLrP27GjBk01Pjkba45Tuvuu+9mJpm2nTA08kj/KIncLLFL6uOPP6YDsg0kmHzGTnXhwoX0KdH9l4tehENyfxHQFEUERCArBFCcoJW33CDKo03BzscW486fP591tHjyswAtW7akMTW5n8GACf3cokFnghWby7Vr1+Z9sVdeeQXR34YTFoDVwx988AFuJgHMhwBobpDRTXbPm455MifACc0m9ONDeLI0ZMgQZns5Qhsf5oUtJP/kmXd0l3KIgAiIgAiUmUDnzp2ZFvYf6qxJ8zbXaHbQDXXo0MFFQbhH7neXvgOdlF2anapZikb3X370Qt2S+wslpvAiIAIZIoDGHU2My9Btt92GpvygT3/sxbl8+XJMKt1dHHvvvbddNm3a1Pe3OYFVq1b5ns5t/n6U+vXrN27cmAC00WPHjmXrHsIwS9ugQQPU/C5iXgdWRpys7t+yS1Iwub9Jkyb+3VwVkX9XbhEQAREQgZISYIfosHW9eZtrlDjkZ+edd3a52nHHHZ074AikYHej+69ACgVdSu4vCJcCi4AIZJoAs6V33XUXe/Aj+dPOtmnT5vrrr/dz7OZq3SSA3cXOEgc7tTmrIT+WifhM3TZs2ND80eWwShi1PXp65HXsfHgiE77YDrFywI+b68bWc8WKFb6/KXjytv5+MLlFQAREQASyT8Aacxr23XbbzXKLGWpB2Y7uvwpKKhD4f8yVAvd0KQIiIAKVRWCbbbahueRIL7KNhQziNXv57/DZ784773RCOQtnTYtvL/jss88i3Ls2OvDWNkvAxKvzxzofw31U+2zFw4QDK33N1hNzfBcmzMHi4Ndff91/OqsUeHpgEiAsuvxFQAREQASyTGDffffFgNPfJs51PTGzHd1/xUwkbzDJ/XmxyFMERKBSCWy77bams8ccn5aX7XfY4QddC5tysuEmu226F2P/BPZWQ/HPaV8s0mUmF+sdd9d3cEoAi25Zeov5PoMKVnQRhfSR9THsYRkWidgjHn/8caYCNmzYQHRuYfTPwIADxfzUWF7M+ISdfDDcJ+KkSZMeeOCBnj17srGPH0xuERABERCBLBCgGUc35P/YOy4iYyhxWKHLdswPP/wwWh5UTizrigife6vW/is3Skyf/J1czMgKJgIiIAJZI4AVPm00mnhscsaMGcMCXFvI26pVq8suu8wM6Mkz26sdcMABbK780UcfIaAj9LP3QsS7kM4111zDvsuEx1iIRpmNGhhXMHgYMWLEcccdhye7MWBWNGDAAMx+8ORAMSYQ2EKUxPv37+8SJ2MsCbjyyivZIAjbfTT9TB2QExdADhEQAREQgewQyD1pi3332QUuIofs7MwhLTfccMP69evZ6JmTWPr06WPTwhGx3K3o/ssFK8LxyZ5xWjTmwNGLp0sj9Qw4FFlwpE4j9QxkoRRcHlKnQQYQ6F1+4juwy+ecLKzqXZSrr76ajfkRvrnFHj4s6nV2/y5MXgfDCZT3u+yyi20ZZGFIHFt/lnBZm06CiPJ+gLxJ4cmOQL4BaFiwvP6cD5BiY5V6ZcjLJC3P1GmknoG0yOd9buo0Us9AXixpeaZOgwwU13HUhdimTZto25nXZRaXXeboDtjMh8nnZ555JmxWOexxuf1XWMg4/nQcsvOJA0phREAEKpgAihNf6PffhFtswhNT6CcijTjhAzI94j6eTpHDaoJAAP+Jvpt5hrAVBX4wuUVABERABCqLAEe4YBqKdobugDEAJ8BwPkyhQj+vHNF/FQdEdj7FcVMsERABERABERABERABEQgSQJc0dOhQDD45pZENQJle5tR239ozGKGM15L7ywhbjxIBEcgGgXPPPbfWXfazkVPlQgREQAREoPIIoN1nUe/LL7+MoQ7LfJs3bx5/Yrmkbyu5v6R4lbgIiEAWCUQcoZLF7CpPIiACIiAClUYA40/s6bOWa9n3Z61ElB8REAEREAEREAEREAERSJ6A5P7kmSpFERABERABERABERABEcgaAcn9WSsR5UcEREAEREAEREAEREAEkicguT95pkpRBERABERABERABERABLJGQHJ/1kpE+REBERABERABERABERCB5AlI7k+eqVIUAREQAREQAREQAREQgawRkNyftRJRfkRABERABERABERABEQgeQKS+5NnqhRFQAREQAREQAREQAREIGsEJPdnrUSUHxEQAREQAREQAREQARFInoDk/uSZKkUREAEREAEREAEREAERyBoByf1ZKxHlRwREQAREQAREQAREQASSJyC5P3mmSlEEREAEREAEREAEREAEskZAcn/WSkT5EQEREAEREAEREAEREIHkCUjuT56pUhQBERABERABERABERCBrBGQ3J+1ElF+REAEREAEREAEREAERCB5ApL7k2eqFEVABERABERABERABEQgawQk92etRJQfERABERABERABERABEUiegOT+5JkqRREQAREQAREQAREQARHIGgHJ/VkrEeVHBERABERABERABERABJInILk/eaZKUQREQAREQAREQAREQASyRkByf9ZKRPkRAREQAREQAREQAREQgeQJSO5PnqlSFAEREAEREAEREAEREIGsEZDcn7USUX5EQAREQAREQAREQAREIHkCW/HbvHlz8glXZorQ2LRpU4p5r1evnorD8VdxOBRZcKReHGQgCxyyk4cU2wq1VH41SP3TUHGoOHwCmXKn/nWo4wjUh/8DcqN+GmcQbMEAAAAASUVORK5CYII=" alt="switch" data-path="psa_pipeline.png" data-linkid="switch" style="width:100%"><span data-line="82"></span>
</p>
<hr  class="figureline madoko" data-line="83" style="display:block">

<div class="p noindent" data-line="84"><span data-line="84"></span><fig-caption class="figure-caption"><span class="caption-before"><strong class="strong-star2">Figure&#160;<span class="figure-label">1</span>.</strong>&#160;</span><span class="caption-text">Portable Switch Pipeline</span></fig-caption></div></figure>
<p class="p noindent" data-line="86"><span data-line="86"></span>A programmer targeting the PSA is required to instantiate objects for
the programmable blocks that conform to these APIs. Note that the
programmable block APIs are templatized on user defined headers and
metadata. In PSA, the user can define a single metadata type for all
controls.
</p>
<p class="p indent" data-line="92"><span data-line="92"></span>When instantiating the <span data-line="92"></span><code class="code code1 language-p4 lang-p4 p4 colorized">main</code><span data-line="92"></span> <span data-line="92"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">package</span></code><span data-line="92"></span> object, the instances
corresponding to the programmable blocks are passed as arguments.
</p><h2 id="sec-naming-conventions" class="h1" data-line="95" data-heading-depth="1" style="display:block"><span data-line="95"></span><span class="heading-before"><span class="heading-label">2</span>.&#8194;</span><span data-line="95"></span>Naming conventions</h2>
<p class="p noindent" data-line="97"><span data-line="97"></span>In this document we use the following naming conventions:
</p>
<ul class="ul list-dash compact" data-line="99">
<li class="li ul-li list-dash-li compact-li" data-line="99"><span data-line="99"></span>Types are named using CamelCase followed by <span data-line="99"></span><code class="code code1 language-p4 lang-p4 p4 colorized">_t</code><span data-line="99"></span>. For example, <span data-line="99"></span><code class="code code1 language-p4 lang-p4 p4 colorized">PortId_t</code><span data-line="99"></span>.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="100"><span data-line="100"></span>Control types and extern object types are named using CamelCase. For
example <span data-line="101"></span><code class="code code1 language-p4 lang-p4 p4 colorized">IngressParser</code><span data-line="101"></span>.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="102"><span data-line="102"></span>Struct types are named using lower case words separated by <span data-line="102"></span><code class="code code1 language-p4 lang-p4 p4 colorized">_</code><span data-line="102"></span>
followed by <span data-line="103"></span><code class="code code1 language-p4 lang-p4 p4 colorized">_t</code><span data-line="103"></span>. For example <span data-line="103"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_ingress_input_metadata_t</code><span data-line="103"></span>.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="104"><span data-line="104"></span>Actions, extern methods, extern functions, headers, structs, and
instances of controls and externs start with lower case and words
are separated using <span data-line="106"></span><code class="code code1 language-p4 lang-p4 p4 colorized">_</code><span data-line="106"></span>. For example <span data-line="106"></span><code class="code code1 language-p4 lang-p4 p4 colorized">send_to_port</code><span data-line="106"></span>.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="107"><span data-line="107"></span>Enum members, const definitions, and <span data-line="107"></span>#<span data-line="107"></span>define constants are all
caps, with words separated by <span data-line="108"></span><code class="code code1 language-p4 lang-p4 p4 colorized">_</code><span data-line="108"></span>. For example <span data-line="108"></span>&#8216;PORT_CPU&#8217;<span data-line="108"></span>.
</li></ul>

<p class="p noindent" data-line="110"><span data-line="110"></span>Architecture specific metadata (e.g. structs) are prefixed by <span data-line="110"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_</code><span data-line="110"></span>.
</p><h2 id="sec-psa-data-types" class="h1" data-line="112" data-heading-depth="1" style="display:block"><span data-line="112"></span><span class="heading-before"><span class="heading-label">3</span>.&#8194;</span><span data-line="112"></span>PSA Data types</h2><h3 id="sec-psa-type-definitions" class="h2" data-line="114" data-heading-depth="2" style="display:block"><span data-line="114"></span><span class="heading-before"><span class="heading-label">3.1</span>.&#8194;</span><span data-line="114"></span>PSA type definitions</h3>
<p class="p noindent" data-line="116"><span data-line="116"></span>Each PSA implementation will have specific bit widths for the
following types.  These widths should be defined in the target
specific implementation of the PSA file.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="120" data-line-first="121;psa.p4:58" style="display:block"><code data-line="121;psa.p4:58"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;unspecified&gt; PortId_t;
<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;unspecified&gt; MulticastGroup_t;
<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;unspecified&gt; PacketLength_t;
<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;unspecified&gt; EgressInstance_t;
<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;unspecified&gt; Timestamp_t;

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">const</span>   PortId_t         PORT_CPU = unspecified;</code></pre><h3 id="sec-psa-supported-metadata-types" class="h2" data-line="124" data-heading-depth="2" style="display:block"><span data-line="124"></span><span class="heading-before"><span class="heading-label">3.2</span>.&#8194;</span><span data-line="124"></span>PSA supported metadata types</h3>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="126" data-line-first="127;psa.p4:126" style="display:block"><code data-line="127;psa.p4:126"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">enum</span> InstanceType_t {
    NORMAL,     <span style="color:darkgreen">/// Packet is &quot;normal&quot;, i.e. none of the other cases below</span>
    CLONE,      <span style="color:darkgreen">/// Packet was created via a clone operation</span>
    RESUBMIT,   <span style="color:darkgreen">/// Packet arrival is the result of a resubmit operation</span>
    RECIRCULATE <span style="color:darkgreen">/// Packet arrival is the result of a recirculate operation</span>
}

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> psa_ingress_parser_input_metadata_t {
  PortId_t                 ingress_port;
  InstanceType_t           instance_type;
}

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> psa_egress_parser_input_metadata_t {
  PortId_t                 egress_port;
  InstanceType_t           instance_type;
}

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> psa_parser_output_metadata_t {
  ParserError_t            parser_error;
}

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> psa_ingress_input_metadata_t {
  <span style="color:darkgreen">// All of these values are initialized by the architecture before</span>
  <span style="color:darkgreen">// the Ingress control block begins executing.</span>
  PortId_t                 ingress_port;
  InstanceType_t           instance_type;
  Timestamp_t              ingress_timestamp;
  ParserError_t            parser_error;
}

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> psa_ingress_output_metadata_t {
  <span style="color:darkgreen">// The comment after each field specifies its initial value when the</span>
  <span style="color:darkgreen">// Ingress control block begins executing.</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     clone;            <span style="color:darkgreen">// false</span>
  PortId_t                 clone_port;       <span style="color:darkgreen">// undefined</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     drop;             <span style="color:darkgreen">// true</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     resubmit;         <span style="color:darkgreen">// false</span>
  MulticastGroup_t         multicast_group;  <span style="color:darkgreen">// 0</span>
  PortId_t                 egress_port;      <span style="color:darkgreen">// undefined</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     truncate;         <span style="color:darkgreen">// false</span>
  PacketLength_t           truncate_payload_bytes;  <span style="color:darkgreen">// undefined</span>
}

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> psa_egress_input_metadata_t {
  PortId_t                 egress_port;
  InstanceType_t           instance_type;
  EgressInstance_t         instance;       <span style="color:darkgreen">/// instance coming from PRE</span>
  Timestamp_t              egress_timestamp;
  ParserError_t            parser_error;
}

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> psa_egress_output_metadata_t {
  <span style="color:darkgreen">// The comment after each field specifies its initial value when the</span>
  <span style="color:darkgreen">// Egress control block begins executing.</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     clone;         <span style="color:darkgreen">// false</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     drop;          <span style="color:darkgreen">// false</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     recirculate;   <span style="color:darkgreen">// false</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     truncate;      <span style="color:darkgreen">// false</span>
  PacketLength_t           truncate_payload_bytes;  <span style="color:darkgreen">// undefined</span>
}
</code></pre><h3 id="sec-match-kinds" class="h2" data-line="130" data-heading-depth="2" style="display:block"><span data-line="130"></span><span class="heading-before"><span class="heading-label">3.3</span>.&#8194;</span><span data-line="130"></span>Match kinds</h3>
<p class="p noindent" data-line="132"><span data-line="132"></span>Additional supported match<span data-line="132"></span>_<span data-line="132"></span>kind types
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="134" data-line-first="135;psa.p4:133" style="display:block"><code data-line="135;psa.p4:133"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">match_kind</span> {
    range,   <span style="color:darkgreen">/// Used to represent min..max intervals</span>
    selector <span style="color:darkgreen">/// Used for implementing dynamic_action_selection</span>
}</code></pre><h2 id="sec-psa-externs" class="h1" data-line="139" data-heading-depth="1" style="display:block"><span data-line="139"></span><span class="heading-before"><span class="heading-label">4</span>.&#8194;</span><span data-line="139"></span>PSA Externs</h2><h3 id="sec-extern-restrictions" class="h2" data-line="141" data-heading-depth="2" style="display:block"><span data-line="141"></span><span class="heading-before"><span class="heading-label">4.1</span>.&#8194;</span><span data-line="141"></span>Restrictions on where externs may be used</h3>
<p class="p noindent" data-line="143"><span data-line="143"></span>All instantiations in a P4<span data-line="143"></span><sub>16</sub><span data-line="143"></span> program occur at compile time, and can
be arranged in a tree structure we will call the instantiation tree.
The root of the tree <span data-line="145"></span><code class="code code1 language-p4 lang-p4 p4 colorized">T</code><span data-line="145"></span> represents the top level of the program.  Its
children are the node for the package <span data-line="146"></span><code class="code code1 language-p4 lang-p4 p4 colorized">PSA_Switch</code><span data-line="146"></span> described in
Section<span data-line="147"></span>&nbsp;<a href="#sec-programmable-blocks" title="5.&#8194;Programmable blocks" class="localref" style="target-element:h1"><span class="heading-label">5</span></a><span data-line="147"></span>, and any externs instantiated at the top
level of the program.  The children of the <span data-line="148"></span><code class="code code1 language-p4 lang-p4 p4 colorized">PSA_Switch</code><span data-line="148"></span> node are the
parsers and controls passed as parameters to the <span data-line="149"></span><code class="code code1 language-p4 lang-p4 p4 colorized">PSA_Switch</code><span data-line="149"></span>
instantiation.  If any of those parsers or controls instantiate other
parsers, controls, and/or externs, the instantiation tree contains
child nodes for them, continuing until the instantiation tree is
complete.
</p>
<p class="p indent" data-line="155"><span data-line="155"></span>For every instance whose node is a descendant of the <span data-line="155"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Ingress</code><span data-line="155"></span> node in
this tree, call it an <span data-line="156"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Ingress</code><span data-line="156"></span> instance.  Similarly for the other
parameters of package <span data-line="157"></span><code class="code code1 language-p4 lang-p4 p4 colorized">PSA_Switch</code><span data-line="157"></span>.  All other instances are top level
instances.
</p>
<p class="p indent" data-line="160"><span data-line="160"></span>A PSA implementation is allowed to reject programs that instantiate
externs, or attempt to call their methods, from anywhere other than
the places mentioned in the table below.
</p>
<p class="p indent" data-line="164"><span data-line="164"></span>For example, <span data-line="164"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Counter</code><span data-line="164"></span> being restricted to <span data-line="164"></span>&#8220;Ingress, Egress&#8221;<span data-line="164"></span> means
that every <span data-line="165"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Counter</code><span data-line="165"></span> instance must be instantiated within either the
Ingress control block or the Egress control block, or be a descendant
of one of those nodes in the instantiation tree.  If a <span data-line="167"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Counter</code><span data-line="167"></span>
instance is instantiated in Ingress, for example, then it cannot be
referenced, and thus its methods cannot be called, from any
non-Ingress control block.
</p>
<figure id="table-extern-usage" class="tablefigure floating align-center float" data-line="172" style="text-align:center;float-env:table;float-name:Table"><table class="madoko block" data-line="173">
<thead><tr><th class="thead tr-even col cell-border-left cell-line col-odd col-first" data-line="173" data-row="0" data-col="1" style="text-align:left"></th><th class="thead tr-even col cell-border-left cell-border-right cell-line col-even col-last" data-line="173" data-row="0" data-col="2" style="text-align:left"></th></tr>
<tr><th class="col cell-border-left thead tr-odd tr-last tr-first col-odd col-first" data-line="174" data-row="1" data-col="1" style="font-weight:bold;text-align:left"><span data-line="174"></span> Extern type       </th><th class="col cell-border-left cell-border-right thead tr-odd tr-last tr-first col-even col-last" data-line="174" data-row="1" data-col="2" style="font-weight:bold;text-align:left"><span data-line="174"></span> Where it may be instantiated and called from </th></tr></thead>
<tbody><tr><td class="tbody tr-even col cell-border-left cell-line col-odd col-first" data-row="0" data-col="1" style="text-align:left"></td><td class="tbody tr-even col cell-border-left cell-border-right cell-line col-even col-last" data-row="0" data-col="2" style="text-align:left"></td></tr>
<tr><td class="tbody tr-odd tr-first col cell-border-left col-odd col-first" data-line="176" data-row="1" data-col="1" style="text-align:left"><span data-line="176"></span> <span data-line="176"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ActionProfile</code><span data-line="176"></span>   </td><td class="tbody tr-odd tr-first col cell-border-left cell-border-right col-even col-last" data-line="176" data-row="1" data-col="2" style="text-align:left"><span data-line="176"></span> Ingress, Egress </td></tr>
<tr><td class="tbody tr-even col cell-border-left col-odd col-first" data-line="177" data-row="2" data-col="1" style="text-align:left"><span data-line="177"></span> <span data-line="177"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ActionSelector</code><span data-line="177"></span>  </td><td class="tbody tr-even col cell-border-left cell-border-right col-even col-last" data-line="177" data-row="2" data-col="2" style="text-align:left"><span data-line="177"></span> Ingress, Egress </td></tr>
<tr><td class="tbody tr-odd col cell-border-left col-odd col-first" data-line="178" data-row="3" data-col="1" style="text-align:left"><span data-line="178"></span> <span data-line="178"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Checksum</code><span data-line="178"></span>        </td><td class="tbody tr-odd col cell-border-left cell-border-right col-even col-last" data-line="178" data-row="3" data-col="2" style="text-align:left"><span data-line="178"></span> IngressParser, EgressParser, Deparser </td></tr>
<tr><td class="tbody tr-even col cell-border-left col-odd col-first" data-line="179" data-row="4" data-col="1" style="text-align:left"><span data-line="179"></span> <span data-line="179"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Counter</code><span data-line="179"></span>         </td><td class="tbody tr-even col cell-border-left cell-border-right col-even col-last" data-line="179" data-row="4" data-col="2" style="text-align:left"><span data-line="179"></span> Ingress, Egress </td></tr>
<tr><td class="tbody tr-odd col cell-border-left col-odd col-first" data-line="180" data-row="5" data-col="1" style="text-align:left"><span data-line="180"></span> <span data-line="180"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Digest</code><span data-line="180"></span>          </td><td class="tbody tr-odd col cell-border-left cell-border-right col-even col-last" data-line="180" data-row="5" data-col="2" style="text-align:left"><span data-line="180"></span> Ingress, Egress </td></tr>
<tr><td class="tbody tr-even col cell-border-left col-odd col-first" data-line="181" data-row="6" data-col="1" style="text-align:left"><span data-line="181"></span> <span data-line="181"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Hash</code><span data-line="181"></span>            </td><td class="tbody tr-even col cell-border-left cell-border-right col-even col-last" data-line="181" data-row="6" data-col="2" style="text-align:left"><span data-line="181"></span> Ingress, Egress </td></tr>
<tr><td class="tbody tr-odd col cell-border-left col-odd col-first" data-line="182" data-row="7" data-col="1" style="text-align:left"><span data-line="182"></span> <span data-line="182"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Meter</code><span data-line="182"></span>           </td><td class="tbody tr-odd col cell-border-left cell-border-right col-even col-last" data-line="182" data-row="7" data-col="2" style="text-align:left"><span data-line="182"></span> Ingress, Egress </td></tr>
<tr><td class="tbody tr-even col cell-border-left col-odd col-first" data-line="183" data-row="8" data-col="1" style="text-align:left"><span data-line="183"></span> <span data-line="183"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="183"></span>   </td><td class="tbody tr-even col cell-border-left cell-border-right col-even col-last" data-line="183" data-row="8" data-col="2" style="text-align:left"><span data-line="183"></span> Ingress, Egress </td></tr>
<tr><td class="tbody tr-odd col cell-border-left col-odd col-first" data-line="184" data-row="9" data-col="1" style="text-align:left"><span data-line="184"></span> <span data-line="184"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectMeter</code><span data-line="184"></span>     </td><td class="tbody tr-odd col cell-border-left cell-border-right col-even col-last" data-line="184" data-row="9" data-col="2" style="text-align:left"><span data-line="184"></span> Ingress, Egress </td></tr>
<tr><td class="tbody tr-even col cell-border-left col-odd col-first" data-line="185" data-row="10" data-col="1" style="text-align:left"><span data-line="185"></span> <span data-line="185"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Random</code><span data-line="185"></span>          </td><td class="tbody tr-even col cell-border-left cell-border-right col-even col-last" data-line="185" data-row="10" data-col="2" style="text-align:left"><span data-line="185"></span> Ingress, Egress </td></tr>
<tr><td class="tbody tr-odd col cell-border-left col-odd col-first" data-line="186" data-row="11" data-col="1" style="text-align:left"><span data-line="186"></span> <span data-line="186"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Register</code><span data-line="186"></span>        </td><td class="tbody tr-odd col cell-border-left cell-border-right col-even col-last" data-line="186" data-row="11" data-col="2" style="text-align:left"><span data-line="186"></span> Ingress, Egress </td></tr>
<tr><td class="tbody tr-even tr-last col cell-border-left col-odd col-first" data-line="187" data-row="12" data-col="1" style="text-align:left"><span data-line="187"></span> <span data-line="187"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ValueSet</code><span data-line="187"></span>        </td><td class="tbody tr-even tr-last col cell-border-left cell-border-right col-even col-last" data-line="187" data-row="12" data-col="2" style="text-align:left"><span data-line="187"></span> IngressParser, EgressParser </td></tr>
<tr><td class="tbody tr-even col cell-border-left cell-line col-odd col-first" data-line="188" data-row="12" data-col="1" style="text-align:left"></td><td class="tbody tr-even col cell-border-left cell-border-right cell-line col-even col-last" data-line="188" data-row="12" data-col="2" style="text-align:left"></td></tr></tbody></table>
<hr  class="figureline madoko" data-line="189" style="display:block">

<div class="p noindent" data-line="190"><span data-line="190"></span><fig-caption class="figure-caption"><span class="caption-before"><strong class="strong-star2">Table&#160;<span class="table-label">1</span>.</strong>&#160;</span><span class="caption-text">Summary of controls that can instantiate and invoke externs.</span></fig-caption></div></figure>
<p class="p indent" data-line="192"><span data-line="192"></span>PSA implementations need not support instantiating these externs at
the top level.  PSA implementations are allowed to accept programs
that use these externs in other places, but they need not.  Thus P4
programmers wishing to maximize the portability of their programs
should restrict their use of these externs to the places indicated in
the table.
</p>
<p class="p indent" data-line="199"><span data-line="199"></span><code class="code code1 language-p4 lang-p4 p4 colorized">emit</code><span data-line="199"></span> method calls for the type <span data-line="199"></span><code class="code code1 language-p4 lang-p4 p4 colorized">packet_out</code><span data-line="199"></span> are restricted to be
within deparser control blocks in PSA, because those are the only
places where an instance of type <span data-line="201"></span><code class="code code1 language-p4 lang-p4 p4 colorized">packet_out</code><span data-line="201"></span> is visible.  Similarly
all methods for type <span data-line="202"></span><code class="code code1 language-p4 lang-p4 p4 colorized">packet_in</code><span data-line="202"></span>, e.g. <span data-line="202"></span><code class="code code1 language-p4 lang-p4 p4 colorized">extract</code><span data-line="202"></span> and <span data-line="202"></span><code class="code code1 language-p4 lang-p4 p4 colorized">advance</code><span data-line="202"></span>, are
restricted to be within parsers in PSA programs.  P4<span data-line="203"></span><sub>16</sub><span data-line="203"></span> restricts all
<span data-line="204"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">verify</span></code><span data-line="204"></span> method calls to be within parsers, whether they are for the
PSA architecture or not.
</p>
<p class="p indent" data-line="207"><span data-line="207"></span>TBD: The rationale for these restrictions is: (1) it is expected that
the highest performance PSA implementations will not be able to update
the same extern instance from both ingress and egress, nor from more
than one of the top level parsers or controls instantiated by the
<span data-line="211"></span><code class="code code1 language-p4 lang-p4 p4 colorized">PSA_Switch</code><span data-line="211"></span> package.  (2) In a multi-pipeline device, there are
effectively multiple instantiations of the ingress pipeline and of the
egress pipeline.  The primary motivation to create a multi-pipeline
device is the practical difficulty in allowing the same stateful
object (e.g. table, counter, etc.) to be accessed at a packet rate
higher than that of a single pipeline.  Thus each stateful object
should be accessed from only a single pipeline on such a device.
</p><h3 id="sec-pre" class="h2" data-line="220" data-heading-depth="2" style="display:block"><span data-line="220"></span><span class="heading-before"><span class="heading-label">4.2</span>.&#8194;</span><span data-line="220"></span>Packet Replication Engine</h3>
<p class="p noindent" data-line="222"><span data-line="222"></span>The <span data-line="222"></span><code class="code code3 language-p4 lang-p4 p4 colorized">PacketReplicationEngine</code><span data-line="222"></span> extern (abbreviated PRE) represents
a part of the PSA pipeline that is not programmable via writing P4
code.
</p>
<p class="p indent" data-line="226"><span data-line="226"></span>Even though the PRE can not be programmed using P4, it can be
configured both directly using control plane APIs and by setting
intrinsic metadata.  The <span data-line="228"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa.p4</code><span data-line="228"></span> include file provides some actions
to help set these metadata fields for some common use cases, described
later.
</p>
<p class="p indent" data-line="232"><span data-line="232"></span>The PRE extern object has no constructor, and thus it cannot be
instantiated in the user<span data-line="233"></span>&#39;<span data-line="233"></span>s P4 program. The architecture instantiates
it exactly once, without requiring the user<span data-line="234"></span>&#39;<span data-line="234"></span>s P4 program to
instantiate it.
The PRE is made available to the Ingress programmable block using the
same mechanism as <span data-line="237"></span><code class="code code1 language-p4 lang-p4 p4 colorized">packet_in</code><span data-line="237"></span>.  A corresponding Buffering and Queuing
Engine (BQE) extern is defined for the Egress pipeline (see
<span data-line="239"></span><a href="#sec-bqe" title="4.3.&#8194;Buffering Queuing Engine" class="localref" style="target-element:h2"><span class="heading-label">4.3</span></a><span data-line="239"></span>).
</p><h4 id="sec-after-ingress" class="h3" data-line="242" data-heading-depth="3" style="display:block"><span data-line="242"></span><span class="heading-before"><span class="heading-label">4.2.1</span>.&#8194;</span><span data-line="242"></span>Behavior of packets after Ingress processing is complete</h4>
<p class="p noindent" data-line="244"><span data-line="244"></span>The pseudocode below defines where copies of packets will be made
after the Ingress control block has completed executing, based upon
the contents of several metadata fields in the struct
<span data-line="247"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_ingress_output_metadata_t</code><span data-line="247"></span>.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="249" data-line-first="250;psa.p4:107" style="display:block"><code data-line="250;psa.p4:107"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> psa_ingress_output_metadata_t {
  <span style="color:darkgreen">// The comment after each field specifies its initial value when the</span>
  <span style="color:darkgreen">// Ingress control block begins executing.</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     clone;            <span style="color:darkgreen">// false</span>
  PortId_t                 clone_port;       <span style="color:darkgreen">// undefined</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     drop;             <span style="color:darkgreen">// true</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     resubmit;         <span style="color:darkgreen">// false</span>
  MulticastGroup_t         multicast_group;  <span style="color:darkgreen">// 0</span>
  PortId_t                 egress_port;      <span style="color:darkgreen">// undefined</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     truncate;         <span style="color:darkgreen">// false</span>
  PacketLength_t           truncate_payload_bytes;  <span style="color:darkgreen">// undefined</span>
}

    psa_ingress_output_metadata_t ostd;

    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (truncate) {
        Truncate the payload to at most truncate_payload_bytes long.
            This affects any copies made below.
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (ostd.clone) {
        create a copy of the packet and send it to the packet buffer,
            after which it will start egress processing with
            egress_port=ostd.clone_port (which might be PORT_CPU to
            send the clone to the <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> CPU).
        The contents of the packet will be the same as the packet as
           it began ingress parsing, prepended with any headers
           created by clone.emit() calls <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> the ingress deparser <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">apply</span>
           block.
    }
    <span style="color:darkgreen">// Continue below, regardless of whether a clone was created or not.</span>
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (ostd.drop) {
        drop the packet
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">return</span>;   <span style="color:darkgreen">// Do not continue below.</span>
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (ostd.resubmit) {
        resubmit the packet, i.e. it will go back to starting with the
            ingress <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">parser</span>;
        <span style="color:darkgreen">// TBD: Specify if anything is different about the resubmitted</span>
        <span style="color:darkgreen">// packet vs. other copies that might be made below.</span>
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">return</span>;   <span style="color:darkgreen">// Do not continue below.</span>
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (ostd.multicast_group != <span class="constant" style="color:purple">0</span>) {
        Make <span class="constant" style="color:purple">0</span> or more copies of the packet according to the <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span>
            plane configuration of multicast group ostd.multicast_group.
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">return</span>;   <span style="color:darkgreen">// Do not continue below.</span>
    }
    enqueue one packet for output port ostd.egress_port</code></pre>
<p class="p noindent para-continued" data-line="288"><span data-line="288"></span>TBD: Need text defining, for each possible copy, exactly what the
contents of the packet will be.
</p>
<p class="p indent" data-line="291"><span data-line="291"></span>TBD: Should it be possible to truncate a cloned or resubmitted packet
differently than the normal packet that goes out?
</p>
<p class="p indent" data-line="294"><span data-line="294"></span>TBD: If it is planned to be possible at the end of ingress to send a
packet to be replicated via a multicast<span data-line="295"></span>_<span data-line="295"></span>group, and also have a copy go
to the control CPU, give an example showing this case (after showing
some simpler common cases).  Ideally it should be possible for the
copy going to the control CPU to have a software-defined header
(defined in the P4 program) that is different than any headers on the
packet copies going to the Egress control block.
</p><h4 id="sec-after-egress" class="h3" data-line="303" data-heading-depth="3" style="display:block"><span data-line="303"></span><span class="heading-before"><span class="heading-label">4.2.2</span>.&#8194;</span><span data-line="303"></span>Behavior of packets after Egress processing is complete</h4>
<p class="p noindent" data-line="306"><span data-line="306"></span>The pseudocode below defines where copies of packets will be made
after the Egress control block has completed executing, based upon
the contents of several metadata fields in the struct
<span data-line="309"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_egress_output_metadata_t</code><span data-line="309"></span>.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="311" data-line-first="312;psa.p4:125" style="display:block"><code data-line="312;psa.p4:125"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> psa_egress_output_metadata_t {
  <span style="color:darkgreen">// The comment after each field specifies its initial value when the</span>
  <span style="color:darkgreen">// Egress control block begins executing.</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     clone;         <span style="color:darkgreen">// false</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     drop;          <span style="color:darkgreen">// false</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     recirculate;   <span style="color:darkgreen">// false</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span>                     truncate;      <span style="color:darkgreen">// false</span>
  PacketLength_t           truncate_payload_bytes;  <span style="color:darkgreen">// undefined</span>
}

    psa_egress_input_metadata_t  istd;
    psa_egress_output_metadata_t ostd;

    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (truncate) {
        Truncate the payload to at most truncate_payload_bytes long.
            This affects any copies made below.
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (ostd.clone) {
        create a copy of the packet and send it to the packet buffer,
            after which it will start egress processing with
            egress_port=ostd.clone_port (which might be PORT_CPU to
            send the clone to the <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> CPU).
        The contents of the packet will be the same as the packet as
           it comes <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> of the egress deparser, prepended with any
           headers created by clone.emit() calls <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> the egress
           deparser <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">apply</span> block.
    }
    <span style="color:darkgreen">// Continue below, regardless of whether a clone was created or not.</span>
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (ostd.drop) {
        drop the packet
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">return</span>;   <span style="color:darkgreen">// Do not continue below.</span>
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (ostd.recirculate) {
        recirculate the packet, i.e. it will go back to starting with the
            ingress <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">parser</span>;
        <span style="color:darkgreen">// TBD: Specify if anything is different about the recirculated</span>
        <span style="color:darkgreen">// packet vs. other copies that might be made below.</span>
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">return</span>;   <span style="color:darkgreen">// Do not continue below.</span>
    }

    <span style="color:darkgreen">// The value istd.egress_port below is the same one that the</span>
    <span style="color:darkgreen">// packet began its Egress processing with, as decided during</span>
    <span style="color:darkgreen">// Ingress processing for this packet.  The Egress control block</span>
    <span style="color:darkgreen">// is not allowed to change it.</span>
    enqueue one packet for output port istd.egress_port</code></pre>
<p class="p noindent para-continued" data-line="351"><span data-line="351"></span>TBD: Need text defining, for each possible copy, exactly what the
contents of the packet will be, and any differences between the values
of the fields in the structs <span data-line="353"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_parser_input_metadata_t</code><span data-line="353"></span> and
<span data-line="354"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_egress_input_metadata_t</code><span data-line="354"></span>, in the copy, as compared to the values
seen for the packet that caused those copies to be made.
</p>
<p class="p indent" data-line="357"><span data-line="357"></span>TBD: Should it be possible to truncate a cloned or recirculated packet
differently than the normal packet that goes out?
</p><h4 id="sec-ingress-actions" class="h3" data-line="360" data-heading-depth="3" style="display:block"><span data-line="360"></span><span class="heading-before"><span class="heading-label">4.2.3</span>.&#8194;</span><span data-line="360"></span>Actions for directing packets during ingress</h4>
<p class="p noindent" data-line="362"><span data-line="362"></span>All of these actions modify one or more metadata fields in the struct
with type <span data-line="363"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_ingress_output_metadata_t</code><span data-line="363"></span> that is an <span data-line="363"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span></code><span data-line="363"></span> parameter
of the <span data-line="364"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Ingress</code><span data-line="364"></span> control block.  None of these actions has any other
immediate effect.  What happens to the packet is determined by the
value of all fields in that struct when ingress processing is
complete, not at the time one of these actions is called.  See Section
<span data-line="368"></span><a href="#sec-after-ingress" title="4.2.1.&#8194;Behavior of packets after Ingress processing is complete" class="localref" style="target-element:h3"><span class="heading-label">4.2.1</span></a><span data-line="368"></span>.
</p>
<p class="p indent" data-line="370"><span data-line="370"></span>These actions are provided for convenience in making changes to these
metadata fields.  Their effects are expected to be common kinds of
changes one will want to make in a P4 program.  If they do not suit
your use cases, you are of course welcome to modify the metadata
fields directly in your P4 programs however you prefer, perhaps within
actions you define yourself.
</p><h5 id="sec-unicast-operation" class="h4" data-line="378" data-heading-depth="4" style="display:block"><span data-line="378"></span><span class="heading-before"><span class="heading-label">4.2.3.1</span>.&#8194;</span><span data-line="378"></span>Unicast operation</h5>
<p class="p noindent" data-line="380"><span data-line="380"></span>Sends packet to a port.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="382" data-line-first="383;psa.p4:159" style="display:block"><code data-line="383;psa.p4:159"><span style="color:darkgreen">/// Modify ingress output metadata to cause one packet to be sent to</span>
<span style="color:darkgreen">/// egress processing, and then to the output port egress_port, unless</span>
<span style="color:darkgreen">/// it is dropped during egress processing.</span>

<span style="color:darkgreen">/// This action does not change whether a clone or resubmit operation</span>
<span style="color:darkgreen">/// will occur.</span>

<span style="color:darkgreen">/// The one copy it causes to be sent to egress processing will have</span>
<span style="color:darkgreen">/// its struct of type psa_egress_input_metadata_t filled in as</span>
<span style="color:darkgreen">/// follows:</span>

<span style="color:darkgreen">/// egress_port - equal to the egress_port parameter of this action</span>
<span style="color:darkgreen">/// instance_type - InstanceType_t.NORMAL</span>
<span style="color:darkgreen">/// instance - undefined</span>
<span style="color:darkgreen">/// egress_timestamp - the time the packet begins egress processing</span>

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">action</span> send_to_port(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_ingress_output_metadata_t meta,
                    <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> PortId_t egress_port)
{
    meta.drop = <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">false</span>;
    meta.multicast_group = <span class="constant" style="color:purple">0</span>;
    meta.egress_port = egress_port;
}</code></pre><h5 id="sec-multicast-operation" class="h4" data-line="386" data-heading-depth="4" style="display:block"><span data-line="386"></span><span class="heading-before"><span class="heading-label">4.2.3.2</span>.&#8194;</span><span data-line="386"></span>Multicast operation</h5>
<p class="p noindent" data-line="388"><span data-line="388"></span>Sends packet to a multicast group or a port.
</p>
<p class="p indent" data-line="390"><span data-line="390"></span>The multicast<span data-line="390"></span>_<span data-line="390"></span>group parameter is the multicast group id. The control
plane must program the multicast groups through a separate mechanism.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="393" data-line-first="394;psa.p4:192" style="display:block"><code data-line="394;psa.p4:192"><span style="color:darkgreen">/// Modify ingress output metadata to cause 0 or more copies of the</span>
<span style="color:darkgreen">/// packet to be sent to egress processing.</span>

<span style="color:darkgreen">/// This action does not change whether a clone or resubmit operation</span>
<span style="color:darkgreen">/// will occur.</span>

<span style="color:darkgreen">/// The control plane must program each multicast_group to create the</span>
<span style="color:darkgreen">/// desired copies of the packet.  For a particular multicast group,</span>
<span style="color:darkgreen">/// the control plane specifies a list of 0 or more copy</span>
<span style="color:darkgreen">/// specifications:</span>

<span style="color:darkgreen">/// (egress_port[0], instance[0]),</span>
<span style="color:darkgreen">/// (egress_port[1], instance[1]),</span>
<span style="color:darkgreen">/// ...,</span>
<span style="color:darkgreen">/// (egress_port[N-1], instance[N-1])</span>

<span style="color:darkgreen">/// Copy number i sent to egress processing will have its struct of</span>
<span style="color:darkgreen">/// type psa_egress_input_metadata_t filled in as follows:</span>

<span style="color:darkgreen">/// egress_port - equal to the egress_port[i]</span>
<span style="color:darkgreen">/// instance_type - InstanceType_t.NORMAL</span>
<span style="color:darkgreen">/// instance - instance[i]</span>
<span style="color:darkgreen">/// egress_timestamp - the time the packet begins egress processing</span>

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">action</span> multicast(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_ingress_output_metadata_t meta,
                 <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> MulticastGroup_t multicast_group)
{
    meta.drop = <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">false</span>;
    meta.multicast_group = multicast_group;
}</code></pre><h5 id="sec-drop-operation" class="h4" data-line="397" data-heading-depth="4" style="display:block"><span data-line="397"></span><span class="heading-before"><span class="heading-label">4.2.3.3</span>.&#8194;</span><span data-line="397"></span>Drop operation</h5>
<p class="p noindent" data-line="399"><span data-line="399"></span>Do not send a copy of the packet for normal egress processing.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="401" data-line-first="402;psa.p4:205" style="display:block"><code data-line="402;psa.p4:205"><span style="color:darkgreen">/// Modify ingress output metadata to cause no packet to be sent for</span>
<span style="color:darkgreen">/// normal egress processing.</span>

<span style="color:darkgreen">/// This action does not change whether a clone will occur.  It will</span>
<span style="color:darkgreen">/// prevent a packet from being resubmitted.</span>

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">action</span> ingress_drop(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_ingress_output_metadata_t meta)
{
    meta.drop = <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">true</span>;
}</code></pre><h5 id="sec-ingress-truncate" class="h4" data-line="405" data-heading-depth="4" style="display:block"><span data-line="405"></span><span class="heading-before"><span class="heading-label">4.2.3.4</span>.&#8194;</span><span data-line="405"></span>Truncate operation</h5>
<p class="p noindent" data-line="407"><span data-line="407"></span>For all copies of the packet made at the end of Ingress processing,
truncate the payload to be at most the specified number of bytes.
Specifying 0 is legal, and causes only packet headers to be sent, with
no payload.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="412" data-line-first="413;psa.p4:218" style="display:block"><code data-line="413;psa.p4:218"><span style="color:darkgreen">/// For any copies made of this packet at the end of Ingress</span>
<span style="color:darkgreen">/// processing, truncate the payload to at most payload_bytes bytes in</span>
<span style="color:darkgreen">/// length.</span>

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">action</span> ingress_truncate(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_ingress_output_metadata_t meta,
                        <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> PacketLength_t payload_bytes)
{
    meta.truncate = <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">true</span>;
    meta.truncate_payload_bytes = payload_bytes;
}</code></pre><h4 id="sec-clone-recirculate-resubmit" class="h3" data-line="416" data-heading-depth="3" style="display:block"><span data-line="416"></span><span class="heading-before"><span class="heading-label">4.2.4</span>.&#8194;</span><span data-line="416"></span>Clone, Recirculate, Resubmit</h4>
<figure id="fig-clone" class="figure floating align-center float" data-line="418" style="text-align:center;float-env:figure;float-name:Figure;page-align:here">
<p class="p noindent" data-line="419"><span data-line="419"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA7YAAAGKCAIAAAC3v0owAAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAAAdVpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpDb21wcmVzc2lvbj41PC90aWZmOkNvbXByZXNzaW9uPgogICAgICAgICA8dGlmZjpQaG90b21ldHJpY0ludGVycHJldGF0aW9uPjI8L3RpZmY6UGhvdG9tZXRyaWNJbnRlcnByZXRhdGlvbj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CrDjMt0AAEAASURBVHgB7Z13oBTV3b8DIqCCKCj2iiKWYG9YEnsEaxRLrNHXgiiigmLsJTH6iyVq7BijMTbsHTX2EhuKWLAhYEHASlGK8Hv0vM672d3Zu3fL3dmdZ/+498yZM2fO9zlTPvOd7znTau7cub/wJwEJSEACEpCABCQgAQn8TKD1zwn/S0ACEpCABCQgAQlIQAI/ElAiexxIQAISkIAEJCABCUjgvwgokf8LhwsSkIAEJCABCUhAAhJQInsMSEACEpCABCQgAQlI4L8IKJH/C4cLEpCABCQgAQlIQAISUCJ7DEhAAhKQgAQkIAEJSOC/CCiR/wuHCxKQgAQkIAEJSEACElAiewxIID+B//znPw8//HD+deZKQAISkIAEJNDQBJTIDd29zTTuueeea9Wq1ZgxY5q5XWzxpZZa6rzzzotd/dOK995777777itcphprBw4cuN5664Wac9vw/vvv77TTToMGDbrzzjursXfrlIAEJCABCUggyQSUyEnunZZuW5cuXXbbbbcFFligJXd87733HnzwwS25x7CvtdZaa6uttgrp3DacdtpptOqYY4459thjZ8+e3fLNc48SkIAEJCABCdSQQJsa7ttdJ43AKqusMmzYsKS1qkrtOfDAA+NqfuONN+64444PPvigc+fOJ5xwAuk99tgjrrD5EpCABCQgAQk0HgG9yI3Tpw899NA222zz/fff9+vXr1u3bhg2Y8YMQgVWWmklAh7233//Tz/9NLJ25MiRvXv3xm28+OKLIxY/++wzVpG5/vrrh2JseO6557722ms777zzoYceGtbmbkJ+r1697rnnnqjmoUOHskm0GCWuvfbaX/7yl/PNN9/CCy+8++67f/HFF6zCaX3RRRd9+eWX7PfCCy8MhW+99dYNN9xwoYUW2m677R588MGohqxE3mJPPfXUJptsMm7cuB122AGBS7Uvv/zy6NGjqWrBBRfs3r37LbfcEuq54IILYEI6tw00ifJLLrlk+/bt99lnn2uuuSZr1y5KQAISkIAEJNDYBJTIjdO/iM4RI0YMGDAArbzppptiGDIRDyhi96yzzmIVAvrbb78lf9SoUejIb775BhF81FFHPfLII5T84Ycfpk6diqBEWFOGYFz08W9/+9vJkycTsxu3CSVfeeUVypAIP9Q2Uvvnpf/9j3OauAWE79///vczzzyTPQ4ePJh1W2yxxWqrrdauXbsdd9yRBDlXXnnlfvvtRwjEFVdcseiii+66665PPPHE/9aS8S+u2FdffcUwu9/85je0+W9/+9usWbOQ43369Fl66aWpMDwqfP7559SEjH7rrbdI5LYBLzJiOuwNz/ozzzwzc+bMjJ2blIAEJCABCUig0QnM9dcoBP75z38y2A5xOW3aNGy66667cIIy9i7Yh6d2kUUWueyyy1jcc889V1555e+++y6sCiPSGKv37LPPcrx/+OGH5OMJpjZcraFM3Casbdu2LZ7jUIy/yPHll18+LOKIRYWTxheLZo3K9O/ff8011wyL559/fteuXUMaBY9j++KLL45K7rXXXkjYaLHJYliNCVdffXUoGQYCIsfDIkKftY8++iiLRx999LrrrhvyM9tADv7mSy65JKwKNbz44oth0b8SkIAEJCABCaSBQJvWrVtjZ6M/CDSmfbkdR86pp546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s7bnnnuuVatWY8aMoZ7vvvvu9ttvnzx5cpl1xm2+1FJLnXfeeXE72n333V9//fVNN930q6++iqvBfAlIQAISkIAEJJBFQImcBcTFChDo0qXLbrvttsACC1AX4hid+tZbb1Wg3nxV9OnTJ3iIc3d01113ff311/369VtnnXXOOuusfFubJwEJSEACEpCABPIQUCLngWJWmQRWWWWVYcOGde3atcx6itn8qquu2mWXXXJLzpkz55RTThk4cCD+bP5ec801U6ZMyS1mjgQkIAEJSEACEsgloETOZZL0nNmzZ6+//vovv/wysm+jjTbCV0qLb7311g033HChhRbabrvtHnzwwciGCy+8cOWVV27fvv1yyy130kknIRxZ9dRTT1HD9OnTo2K/+93vLrnkkmjxzjvvXHfddTt16rT55pvff//9UX6vXr2eeOKJQYMGLf/Tj8pnzpzZv3//JZdcknhfEj/88AOFR44cSf2ffvrpZZddtsMOO5Bz6KGH4u6N6okSM2bMoLaVVlqJeIn999+fTcKqU0899bTTTrvjjjuop3Pnzvihv//++xtuuGGttdbq0KHDlltu+d5774WSvXv3vv7663N39Mgjj7zzzjsHHHAAxWCy4IIL3nLLLdF+TUhAAhKQgAQkIIECBJTIBeAkdBUyF32Mm/bYY49dfPHFEatXXnnlfvvtt9VWW11xxRVI1V133RUhS+vRlIMHD957771vvvlmxCIxuxdccAH5BOZSQ5CzwchRo0Z9/PHHIf3222+jaImUuPTSSzt27Ljzzjvfd999YdUrr7zCqrFjx55zzjns7rjjjvvVr35FEAVhDAceeCA69dprr6Xk1KlTqR/526NHj6233poctHVIhHqivwhodDAqmRpGjBixzTbbfPvtt6z98MMPaTwq+ZBDDuEvon+LLbYg0bdvX0x44403jjjiiFAJocYTJkzI3REyHdk9//zzUwxHMsEYjz76aLRfExKQgAQkIAEJSKAJAnOT8Zs4cWITDU3r6qz+QXpCAhfvm2++ySo0JbG/F198cVRsr732QlCyeNhhh62wwgpRPl7kAQMGsBgcz2wYrfrlL395/PHHh02oHBdsWIWMpqo111wzLLZt23bbbbcN6VmzZuGazax/1VVXZY+sffbZZ6kEmUuaCSVIP/nkk2GrzL80A/c2o/pC5pdffrnIIougs1ncZ599ULc4lcOq4Ax+6aWXwiJaGddySOPAPvfcc0ln7ejggw/GBR7K8Jca8KNHi1GCtvlLPgEecqIuMyEBCUigwQhwEW4wixrDnARN+vb555+vvvrquDOTf8NOQgtxG6+22mq05NVXX/3iiy+IpsDFGxpGjAR6l5FqzOSAgxnFfNBBB22yySZnn312MS1H9UYe39atW+PHJQyDB5gQWxwF/rZp0waP9Y477hjVucQSSwT5HuUUTgwfPpyoZRrPL5RkXB26mQF2LG6wwQZUGPLRwUsvvfR6660XFskn7iKk4/4SZYEh0dpll10WZ3O0GCU4jaO0icQSQCIntm02TAISkIAEGpJAgiQy8QMIsoakXA2j1lhjjVDtBx98QGL77bfP2stnn3227777IpT/+te/EoYbHMDEWuDrzSqZtYi3NTOHQA4WCa4IErldu3bRWoQLjuTMxShdTAI3M2ESkfANm0R24WCOKmFHhHxEi8UkaDAiOyoZ5DsKPrP90VoTEpCABCQgAQlIIJOAEjmTRj2lF1544dDcxRZbjMTo0aMZq5dpAKEILB750+/999+/99570ce4h0NAQmZJ0plD9wh4yFwbZhQOtWXml5+m5czBTFB1ZlXzzDNP5mLJaQJRMt3GkyZNQuKrj0vm6YYSkIAEJCCBVBFIkNeWsNdKyaNUdSGBwnBDIiMBwy9MOkHmCSecQIwyNJgy4phjjmGMHdG9SGQmhSAzmj4CKYnPNYJGrEvm4kMPPYTcJFAhKlCpBGEVDPVj+uSfG971zDPPZPReRepnIGOmFaQZ0leRmq1EAhKQgAQkIIGGJ5AgiWygRWlHG0G6xAoz4Rpj7Air4C/TAG+88cYEJ/A7/fTTCfnlE3fo4IcffhjfM3EUxFoQSUxoMt9nRlsT1hxmfogawHQWzC+BO/m6665jlgwG+c0777zR2mYlwgdEmGaOKSbYkMYwcduNN95ImghpWsiEG7SB5jFVxdChQ3MjRorcXdaOmENDiVwkOotJQAISkIAEJJBFQImcBaQuFy+//HImmthpp51QwMzkgMBljB2WoI9RnExIjAImGJfA37vvvpuAb0a/EXRBgDK+YSYeZsPMgGDmWmacH7MsM1EGYRpHH300sxSXzIUIDWZqQ44zgTGVIOJpRvgeNc5sHN6IYyQ7TaI9fAcExV/avrJ2BBCisb/55htqY0zeu+++izQvrWa3koAEJCABCUggbQR+HCeekEH9zz//PBP98jdtfVApe4lUIXZimWWWyapw2rRp5DPcjdiDzFV89YN8VHLeUZLMbcwcI0wKkXdtZj3lp9kXfm7mxyi/qswaevbsiYOcmaEfeOABnhwY15jlLM8sbDrJBHjbkJDLVJIp2TYJSKBOCXiJS2bHJciLbCxymYcIwce5+pg6iUBgSrgsfUw+c1wwW0WcAsbF261bt7i1ZTY1a3P2VXF9zC4IxeaTgXyMkBCOk08+WX2chd1FCUhAAhKQgATiCCRIIhuLHNdJ5pdGgBBtPrB3/vnn83USPgpYWiVuJQEJSEACEpBACgk46VsKOz0tJvPqihALPnry+9//vuThhmmBpZ0SkIAEJCABCWQQUCJnwDDZcAQYv8iv4czSIAlIQAISkIAEqksgQYEWxiJXt6utXQISkIAEJCABCUigOAIJksjGIhfXZZaSgAQkIAEJSEACEqguASVydflauwQkIAEJSEACEpBA3RFQItddl9lgCUhAAhKQgAQkIIHqEkiQRDYWubpdbe0SkIAEJCABCUhAAsURSJBENha5uC6zlAQkIAEJSEACEpBAdQkokavL19olIAEJSEACEpCABOqOgBK57rrMBktAAhKQgAQkIAEJVJdAgiSyscjV7Wprl4AEJCABCUhAAhIojkCCJLKxyMV1maUkIAEJSEACEpCABKpLQIlcXb7WLgEJSEACEpCABCRQdwSUyHXXZTZYAhKQgAQkIAEJSKC6BBIkkY1Frm5XW7sEJCABCUhAAhKQQHEEEiSRjUUursssJQEJSEACEpCABCRQXQJK5OrytXYJSEACEpCABCQggbojoESuuy6zwRKQgAQkIAEJSEAC1SWQIIlsLHJ1u9raJSABCUhAAhKQgASKI5AgiWwscnFdZikJSEACEpCABCQggeoSUCJXl6+1S0ACEpCABCQgAQnUHQElct11mQ2WgAQkIAEJSEACEqgugQRJZGORq9vV1i4BCUhAAhKQgAQkUByBBElkY5GL6zJLSUACEpCABCQgAQlUl4ASubp8rV0CEpCABCQgAQlIoO4IKJHrrstssAQkIAEJSEACEpBAdQm0qW71xdV+2WWXUfD555+fNWvWNddcM8888xx44IGtWrUqbmtLSUACEpCABCQgAQlIoJIEai+Rhw0b1r9///nmm2/u3LnI4qeeeqpNmzZt27bdZ599KmmodUlAAhKQgAQkIAEJSKA4Aj96atGmxRWuSqnp06d37tx5xowZUe3t2rWbOHHiggsuGOWYkIAE0kyAh+faXqbSDF/bJSCBahPwEldtwqXVX/tY5Pnnn3+HHXaIwipI9O7dW31cWne6lQQkIAEJSEACEpBA+QRqL5Gx4fDDD+/QoUMwZoEFFhgwYED5hlmDBCQgAQlIQAISkIAESiNQ+0AL2s2MyF26dPn6669Jd+3adcKECZFTuTSr3EoCEmgkAr6FbKTe1BYJSCCLgJe4LCAJWUyEF7l169ZMYTHvvPO2b9/+iCOOUB8n5OCwGRKQgAQkIAEJSCCdBBLhRQb9m2++uf766+NO/uCDD5Zaaql0doZWS0ACeQnoYsmLxUwJSKAxCHiJS2Y/JkUiQ4dYi6WXXvr1119PJilbJQEJ1IqA949akXe/EpBACxDwEtcCkEvYRe3nRY4a/dprrzEdcrRoQgISkIAEJCABCUhAAjUhUGOJPG3atNGjRzM+j9+nn37asWPHxX/6LbbYYj169KgJEXcqAQlIQAISkIAEJJByArUJtHjrrbcefvjhe+655+WXX15mmWX4dAg/ZPGUKVO+/On3xRdf8DFqJkjeeeedf/3rXzMTXNL6iSGGafuWAW+CCBaveUdIvlZdIPlaka/Gfu3NalAtrU77ojRu1djKvqgG1fqts6UlMtEUQ4YMIeB4o4022nTTTfnLLBZ58Y0ZM+aZZ5557rnnPvzww+OPP/6oo47iI9V5S9YkM4WRQwkxOSHNaMmjLiEmJ6QZKSRfDZPtzWpQLa1O+6I0btXYyr6oBtX6rbPlJPLbb7990kknPf300wcddFDfvn05EIuk9vHHH19yySUjR44cPHjwcccdx0NekRtWtZgnUlXxFqhc8gXgVHWV5KuKt4UrtzdbGHiB3dkXBeC08Cr7ooWBJ3x3LSSR77jjjkMOOWTffffdY4894tzGhUkRsnzZZZfhSL7tttsWWmihwoVbYK0nUgtAzrsLyefF0gKZkm8ByC22C3uzxVA3uSP7oklELVbAvmgx1HWxo5aQyKeccsrQoUMvvPDClVZaqRwoxP5SyfPPP//EE08su+yy5VRV/raeSOUzLK0GyZfGrfytJF8+w+TUYG/aFzUkkNjDL7ENq15npdDk4mFWXSLvtNNO77///l//+lcG5BXfrAIl7733XmojUrm2vuQUHlUJMTkhzShwiFZ8VUJMTkgzKo63QIUNbHIDmxbXoYk1ObENiyNZfn5iTU5sw8pnHldDCk2OQ5GbX91J3/7whz+gaPH78nHp3H2XlrPjjjtOnz69e/fuzIZRc19yaSa4lQQkIAEJSEACEpBAkglUUSLffPPN11133aOPPlpBfRxQ7rnnnrNnz+7Tp88LL7yQwPngktzftk0CEpCABCQgAQlIoEkC1Zod4tVXXz3yyCMvv/zyKoVD7LPPPquvvvrZZ5/dpIUWkIAEJCABCUhAAhKQQLMIVCsWma9+rLbaanvvvXezWtOswjNmzNhtt93uuuuuDTfcsFkbVqRwCsN3EmJyQppRkaOoyEoSYnJCmlEktIoUa2CTG9i0uK5PrMmJbVgcyfLzE2tyYhtWPvO4GlJochyK3PyqeJH55AcfB9l9991z91fBnHbt2jGRHDMlV7BOq5KABCQgAQlIQAISkEBVJPKgQYMOO+ywiocg5/bWDjvs8Omnn/It69xV5khAAhKQgAQkIAEJSKA0ApWXyCNGjJgwYQJj6UprULO2mmeeef7nf/7noosuatZWFpaABCQgAQlIQAISkEABApWXyPfff//GG29cYJeVXdWrV6+nnnrq+++/r2y11iYBCUhAAhKQgAQkkFoClZfId99992abbdYkUGKI+/btG4rdeuut62X8Nthgg6233nrIkCFTp05tsp6OHTuuuuqq//73v5ssaQEJSEACEpCABCQgAQkUQ6DC8yJPnDiRb+khd4vZd1YZZnDr1KkTmbNmzXr33Xf5ZjVzVvDF6axiuYtbbLEF81owh0buKnMkIAEJSEACEpCABCTQXAIVlsgfffTR0ksvTYhwc9tBeYT1IossEjbcfPPNv/nmm2HDhs2cObNt27aFa+Mbe0jkwmWau3bOnDnsF9ndv3//bbbZpnXryrvbm9sky0tAAhKQgAQkIAEJtAyBCiu/zz77rEuXLhVpOiKVL+cVMy0Gwpr9VmSnUSXs/YcffuDr2USDYBFhIaNHj47WmpCABCQgAQlIQAISaGACSZTIxFe89NJLDz30ENNiMKl1k/SRyJ9//nmTxZpbIOx6ypQpX3/99SWXXLL22mvzPT++F4h7u7lVWV4CEpCABCQgAQlIoI4IVDjQguneSvYi8ym+EM+AKiW+gqkqjjnmmGJQdu7c+csvvyxGTBdTW94yhEfze+uttwYPHnzaaacRcp23mJkSkIAEJCABCUhAAg1AoMISeYkllhg5cmRpXHbeeWciK9iWIAcCJ4YPH84nSP785z+3adNEI9HHqOQvvviitP3m3Wr27NnEIs+dOzesJd6DAOtu3bodddRRVf2qdt7GmCkBCUhAAhKQgAQk0JIEmlCfzW3K4osvjmBt7lah/F577RUN1yPnN7/5zeGHH/7qq68yB1zhCidPnrzYYosVLlPC2qCPmVQOcXzwwQcfeuih3bt3L6EeN5GABCQgAQlIQAISqC8CFZbIeJEr5c1dc801iZ0oUiKz38pyJ+QDZUwwNDNaMEmzM1pUFq+1SUACEpCABCQggSQTqLBEXn755T/++GPmgiht3rdMUv/5z3/w42b6lTPXZqbHjRtHCERmTvlpNDGxFuXXYw0SkIAEJCABCUhAAnVHoMISuWvXriuttNLLL7+84YYbNpcFW4VPh6CMR40axVTHCy+88HbbbddkPY8//viZZ57ZZDELSEACEpCABCQgAQlIoBgCFZbI7JJRd08//XQJEvnkk0+OWoxW7tmzJzNaEAocZeZNfPvtt++8886WW26Zd62ZEpCABCQgAQlIQAISaC6BH2cdjuZtaO7GecuPGDFi1113vf322/OurXjmww8/jCJ/8MEHK15z4QqJk64st8K7S8LahJickGa0ZI8kxOSENCOF5Kthsr1ZDaql1WlflMatGlvZF9WgWr91VvjTIYDgExvMa3H//fe3ABSCnq+55pqBAwe2wL7chQQkIAEJSEACEpBASghUXiID7vzzz7/iiiv41ka1IfKB6KWWWqqYeOVqt8T6JSABCUhAAhKQgAQahkBVJPImm2yy1lprDRs2rKqY+E41LuS//OUvVd2LlUtAAhKQgAQkIAEJpI1AVSQyEM8+++zrrruOCeCqB/Tiiy/eeOONSxgXWL0mWbMEJCABCUhAAhKQQG0JVGS0WOWH60VQbr755mOPPfaGG25YaKGFosxKJa6//vp///vfL7zwQvhmdaWqLb4eg/qLZ1XZkpKvLM/ia5N88aySX9LeTE4f2Rf2RQ0JNMbh99577xF5y/c0PvvsswkTJkycOHH69OldunTh08t8Wo6IXL4Et80223To0KFZqKsokWnHH/7wh7vvvnvo0KHz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s4919DVfSEUfEy/4xBNPFOnyaVQsLW9XOOMy91vxb/NmVm46undPnDjxtddeO/PMMxFkL7zwArOSCaeyBHAhNzkR8ssvv3zssceusMIKf/nLX9ZYYw0eY5566qkrr7wSNUUOj46hSbvttluoas6cOZT55z//2b9/f77unPUhvcz2I/xOPvlkPvOsRM7E8n9pnkLgO2PGDHzJPM0wppLJ+fr16we4/ytUaooPB6IewtZMwscHY+jmJ598kkegUqt0OwnUnsAWW2yBcyW048gjj8TFMmTIEI5wPoxU+8bZgsoRWHjhhaMrWO/evbk84uy5/vrrlciVY1xUTZlnXFEbWKg8Apn37v32248jf4MNNvjDH/5wxRVXlFexW2cTePPNN3kUz87NWEbvnnfeeSuuuCLw27dvzxokLy8wl1tuOe47+Gi23nrrUJyr08YbbxxtyiYHHXQQ8joqEK2KEjiwqYfX+z9K5NNPPz1aESUiAR7lhERK8vGORIbj6yXNDYCvhPOJ7OOOO44PvURry09sueWWVMI8I/xlX5xvd955Jw+pqI1DDz30pJNOIv+hhx46//zzee7h6y+8v/7ggw8Y7MlxwIcZOTi4M1144YX0aGgM7aQwX/becMMNBw4cuP3225NPmxdddFFubKeddtpiiy121VVXhcIJ/IsjpFOnTli34447tm3btoIt7NWr1znnnPPggw+CaOrUqdzd+Y4OfRp2cdlll9HLcKPY2WefDXwc/EsvvTRnF65QfAbXXHMNreINwPvvv89TzXPPPcdanlB53AznBb1AJePHj4fwvvvue9ZZZ7Vu/WMsU1x+BU2rSFXE/GAmtqNry59nh2P14osvvvTSS4NE5oGTg5kZLr/77jtyeCO85JJL0mwSHM/0BfsF7JprrnnCCSf06dMnWDRixIgTTzzxxRdfZCv8BMjucL7kHs9xkOP2m1tDRRgmpxJuA1wxwLvHHntEB3k1mrfsssuutNJKH3/8caj82muvpS/oSi5NdDROHd4tzJ49O+s84jUdJ9EDDzwwffr0VVddlesS53uoIe/5lXsNrIYt1ajz22+/5YKGkwXfFVZXYxe5dea9mqEVcg/7vLSpMO4WE5ef24YE5uCKwqHIlRl1u9RSS5XZQq5IBx54IEf4X//61/CeOe/NlzctRxxxxNVXX82l7D//+Q93du4a6K5wd6je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Oeuss6J8ExKQgAQkkEICSuQUdromSyClBFZZZZVhw4Z17do11/45c+accsopAwcOxM3M32uuuWbKlCm5xcyRgAQkIIGUEFAip6SjNVMCFSAwcuTI3r1744tdfPHFDzzwwM8++yy30nfffXeXXXahwHLLLbfffvtNnDgxlHnqqac22WSTTz75ZOedd+7cufPKK6982WWXRZu///77O+200yKLLLLWWmvhwZ07d260KjMxY8aMQYMGrbTSSoR27L///p9++mlY26tXryeeeIJVy//0u/DCC2fOnNm/f/8ll1ySwGISP/zwAyVp//rrr89W7HqHHXYg59BDD+3Tpw+JRx555J133jnggANIb7fddgsuuOAtt9xC2p8EJCABCaSTgBI5nf2u1RJoNoFRo0ahcb/55ptzzz33qKOOQlOiMoP0jOoaPXo0GvSjjz7605/+dPzxxz/55JPrrrsu0QsUILr3xRdf3HHHHVddddWLL764W7duKNdXXnmFVQQHr7feeiTIJ/iBsObjjjsuqjMzwR7vuOMOpDAyesSIEdtss823335LAepB7I4dO/acc87Zaqut2PxXv/oVQRQUQ8ojiK+99lqKTZ069eWXX0Zn9+jRY+uttyYHbR0SqGdk9/zzz08mjmSG6z366KOk/UlAAhKQQHoJ4LDxJwEJSKAwgT333BPXL6PcQrE777yTiyYD4FjEWYtuJkEZhCZKNJRBs7Zv354ABhaJ9KX8+eefH1YhbVmFGmZxn3322WyzzUI+fxHB88wzz4QJE6KckKAGNkFPh8Uvv/wSrzPyl8W2bdtuu+22IX/WrFn4gFdYYYWwyF9E+WGHHUbi2WefpQ0ffvghaWauII2ID8UOPvjgzTffPKT5izsZL3i02MIJGtbCe3R3EpBADQl4ytcQfoFd60XmyPQnAQk0TQC38d57741IDUWJpsA9HLy/0caUQVyG8XBkLrvssvh9yYwK7LrrriHdsWNHBHeYUGL48OEbbLABnuDwQ2S3bt363nvvjbYKCYoRTPzFF1+EYihdxtUF5U0B2hOKtWnThuAKwjmizZdYYgk8x9Fi3gRRFrQ2WkUajR4tmpCABCQggbQRcF7ktPW49kqgFAI4hvHaEuibuXGnTp0yFxnfRpkVV1wxM5PFZ555JsrB7xulQ4KaJ02ahHeZX+aqKM44ykQTMyNblihfY401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jz564IEHzjvvvGnTpl166aXBlsMPP3yXXXYJ6fHjx6OPf//733fo0GH33XfPLRByFlxwwZDwrwQkIAEJSKAcAkrkcui5rQQkUBaBLbbYYokllghVHHbYYRtvvPH1118fSeQePXpst9120Q723HPPrl273nrrrZFEzioQlTQhAQlIQAISKJOAgRZlAnRzCUigYgS22mqrKVOmfPvtt3lr7Nix48orr0xIRt61ZkpAAhKQgAQqSECJXEGYViUBCZRF4MEHH+zUqVNcsMR77703evTozTffvKx9uLEEJCABCUigCAL6Y4qAZBEJSKA6BIYPHx5ikceMGXPvvfe++uqrAwYMiHZ13333ff755yzy4esJEybcfffdxCLziwqceuqpf/7zn6NFEhdffHHfvn0zc0xLQAISkIAESiCgRC4BmptIQAKVIXDggQdGFeE/7tev35/+9Kco5/XXXx83blxY/OKLL77//nsCLdq1axcVwKPcq1evaJHEqquumrloWgISkIAEJFAaASVyadzcSgISqACBUaNGLb744lREhDESOavGk0466eijj44yTznllEGDBqGJGdUXMrfeeuvMAlFJExKQgAQkIIEyCRiLXCZAN5eABEon0LlzZwIt+OXq49xKjzvuODKfffbZ3FXmSEACEpCABCpLQIlcWZ7WJgEJVIvAQgsthMuZj4ZUawfWKwEJSEACEviZgIEWP5PwvwQkkHgCeJ0Ztxc185133nn44YejRRLzzz//ZpttlpljWgISkIAEJFACASVyCdDcRAISqA2B5ZZb7vHHH585c2bY/RU//TKb0r17dyaGy8wxLQEJSEACEiiBQCu2YUKlErZ0EwlIIFUEWrVqlbZrRQpNTtUhrbESSAgBLzUJ6YisZhiLnAXERQlIQAISkIAEJCCBtBNQIqf9CNB+CUhAAhKQgAQkIIEsAkrkLCAuSkACEpCABCQgAQmknYASOe1HgPZLQAISkIAEJCABCWQRUCJnAXFRAhKQgAQkIAEJSCDtBJTIaT8CtF8CEpCABCQgAQlIIIuAEjkLiIsSkIAEJCABCUhAAmknoERO+xGg/RKQgAQkIAEJSEACWQSUyFlAXJSABCQgAQlIQAISSDsBJXLajwDtl4AEJCABCUhAAhLIIqBEzgLiogQkIAEJSEACEpBA2gkokdN+BGi/BCQgAQlIQAISkEAWASVyFhAXJSABCUhAAhKQgATSTkCJnPYjQPslIAEJSEACEpCABLIIKJGzgLgoAQlIQAISkIAEJJB2AkrktB8B2i8BCUhAAhKQgAQkkEVAiZwFxEUJSEACEpBAswl8//3399xzz7vvvtvsLd1AAhJIJAElciK7xUZJQAISSAeBpZZa6rzzzqsLW6Omfvfdd7fffvvkyZMzm33JJZdcc801m2666VdffZWZb1oCEqhTAkrkOu04my0BCUhAAi1KoE+fPt27d2eXiOPdd9/9rbfeinb/7bffnnvuuWecccY666xz1llnRfkmJCCB+iWgRK7fvrPlEpCABCTQcgSuuuqqXXbZJe/+Lrjggp49e6699toDBw7ElzxlypS8xcyUgATqiIASuY46y6ZKQAK1JzBnzpyHH354p512mnfeeUnXvkF10oKRI0f27t27S5cuiy+++IEHHvjZZ5/lNpxw3uOOO27VVVddeOGFt9pqq8cffzyUeeqppzbZZJNPPvlk55137ty588orr3zZZZdFm8+YMWPQoEErrbQSgRD777//p59+Gq3KTMQVO/XUU0877bQ77rhj/fXXp3LcwzTjhhtuWGuttTp06LDlllu+9957oR7af/3117PrHXbYgZxDDz0UvzIJDoOLLrro4IMPJr3ddtstuOCCt9xyS9jEvxKQQP0SUCLXb9/ZcglIoEUJjB49GgGHyOvbt++99947e/bsH374oUVbULc7GzVqFBr3m2++IRrhqKOOeuSRR1CZWfTmzp277bbb4qndb7/9Lr300rZt226zzTb33XcfRhPd++KLL+64446o54svvrhbt279+/d/5ZVXAg+qQuCikolwGDFiBFsR9pCLKq7Yhx9+iCBGJR9yyCH8ffDBB7fYYgsS9DK+4TfeeOOII44Itb3++usTJkzo0aPH1ltvTU6vXr1CYty4cZgWYjBatWpF4tFHH81tgDkSkED9EeDC5E8CEpBAYQJc2goXaLy1weSvv/768ssvX2211eabbz48x9ElHjE0c+bMxrO6GhbtueeeuH4Z5RYqv/POO8H43HPPsbjkkkuim0kMGzaMzOHDh4cyuGZ//etfo4lJ3HXXXaw6//zzwyoUcPv27RnkxyKrSI8ZMyas+vLLLxdZZBEcvWEx+lug2D777DP//PPjew6FDzjgAPb10ksvhUW0Mq7lkI6aiiamzJNPPhnyH3roIRZRz1ENyy23XEj7VwLFEOD4KaaYZVqYQBuu8vzoHn8SkIAEJJBLAKfgtJ9+uavwdOZmmsNtLAsCbuMjjzwSLRvyiejlwQNhmlmMMshofMAhkxtTv3790NbEV4ScXXfdNSQ6duxIyTChBJJ6lVVW+eKnX1jLgDkEMduGxfC3cLENNthgiSWWCCXRwUsvvfR6660XFskn7iKzqtz0O++8g2ldu3YNq5Zddlnkcm4xb7W5TMwJBDw2knkktDGWLpkdY6skkDQCqb2IM9PtzTffzJReH3zwAbEBs2bNiroGL3KmXznKN5FJYOrUqTh3l19++czMTp06ZS6S/uijj1ZcccXMzLBIfsjEPZy5NqQJkyD+IVK0IXONNdbIKlm4WKTd2YrjHAmetXnhRZzKtC06QVDVxD3za9euXeaGuU8OmWtNS0ACSSNgLHLSesT2SEACySKAmDvssMOIpkWKDRgwYKGFFgoSSsVTZD+FAJWsSR4I7MaRnFnDoosumjXTcFjMq4yjDRdbbLHNNtvs8//+PfHEE1GBkCiyWNZWRS4yPm/ixImRv2nSpEl4lLP0cZFVWUwCEkgOASVycvrClkhAAokmQMTFX/7yF17pEzXLjBZt2rSZZ555Et3iZDQOSgxxI44iag5RvOTwyBHlkGDGNMbGjR07NspkrB7PJ1mu5WhtSBBWwfzECyywAKo0/M4880xG75VWLGurIheZo4P3CVFwBSZgXZHbWkwCEkgsASVyYrvGhklAAkkk0Lp1ayZeuPvuu4m4IJ3EJiavTcwEcv/99zPADg/rY489dsIJJxBAzIwQmS1lDjU89MwjgXQmMINJLZjd4vjjjy8c8H3QQQcR4bD33nvjlkakMgfF0KFDt99+e2om/piJ22688UbSBYpltqHINIqckkxFx0x2JIIhkbhXIheJ0WISSDgBr+8J7yCbJwEJSKDuCTBdMeL1nHPOwdHLRGnEqDCpRVYYN5MQP/300whiHMPMrHfyySczm8SQIUMKG89WhFUgjpn7gpF2TEiMsGa8HVsRyIHaDtEaBYoVrj/vWua4QMqfffbZzJRMAUKf2fXbb79NGtMIXkea593QTAlIoI4ItDKcro56y6ZKoIYE8NWl7XKRQpOrfYCNHz8eFywSs8COpk+fjq5lXogCZXJXMSiQSeUIaM5dlZlTZLHMTYpJMyUzU2UzefMDDzzAN0QY2Zk1X0cxlVhGAhJIFIHU3fMSRd/GSKCOCKRQL6bQ5Do6IBPVVDQ9HzQhmOT0009ncjq+bJKo5tkYCUigBAJK5BKguYkE0kgghXoxhSan8ciukM182QQXMlPUMU1yVgxJhfZgNRKQQIsSUCK3KG53JoH6JZBCvZhCk+v3+Kx5y/kgOaHPyyyzDPHWNW+MDZCABMonoEQun6E1SCAVBFKoF1NocioOZY2UgAQkUAQBZ7QoApJFJCABCUhAAhKQgATSRECJnKbe1lYJSEACEpCABCQggSIIKJGLgGQRCUhAAhKQgAQkIIE0EVAip6m3tVUCEpCABCQgAQlIoAgCSuQiIFlEAhKQgAQkIAEJSCBNBJTIaeptbZWABCQgAQlIQAISKIKAErkISBaRgAQkIAEJSEACEkgTASVymnpbWyUgAQlIQAISkIAEiiCgRC4CkkUkIAEJSEACEpCABNJEQImcpt7WVglIQAISkIAEJCCBIggokYuAZBEJSEACEpCABCQggTQRUCKnqbe1VQISkIAEJCABCUigCAJtiihjEQlIQAK/aPXTL1UgsDhV9mqsBCQgAQlEBP4/TvDSmYvgU9sAAAAASUVORK5CYII=" alt="clone" data-path="clone_recirc_resubmit.png" data-linkid="clone" style="width:90%"><span data-line="419"></span>
</p>
<hr  class="figureline madoko" data-line="420" style="display:block">

<div class="p noindent" data-line="421"><span data-line="421"></span><fig-caption class="figure-caption"><span class="caption-before"><strong class="strong-star2">Figure&#160;<span class="figure-label">2</span>.</strong>&#160;</span><span class="caption-text">Clone, recirculate, and resubmit in PSA</span></fig-caption></div></figure>
<p class="p noindent" data-line="423"><span data-line="423"></span>Figure<span data-line="423"></span>&nbsp;<a href="#fig-clone" title="Clone, recirculate, and resubmit in PSA" class="localref" style="target-element:figure"><span class="figure-label">2</span></a><span data-line="423"></span> shows the proposed architectures for clone,
recirculate, and resubmit in PSA.
</p><h5 id="sec-clone" class="h4" data-line="426" data-heading-depth="4" style="display:block"><span data-line="426"></span><span class="heading-before"><span class="heading-label">4.2.4.1</span>.&#8194;</span><span data-line="426"></span>Clone</h5>
<p class="p noindent" data-line="428"><span data-line="428"></span>A PSA implementation provides a cloning mechanism to create copies of
the original packet as independent packet instances. A cloned
packet may be a duplicate of the original packet or a copy of the
deparsed packet after egress pipeline. The cloning mechanism submit
the cloned packet to either the ingress parser or the buffering mechanism.
In a PSA implementation, the cloning mechanism is logically implemented in
the PRE, that is, even if targets chose to implement it as part of other
controls, the observable behavior should follow the semantics of cloning in
the PRE.
</p>
<p class="p indent" data-line="438"><span data-line="438"></span>The cloning mechanism can optionally attach metadata to the cloned
packet. A PSA implementation provides the <span data-line="439"></span><code class="code code1 language-p4 lang-p4 p4 colorized">clone</code><span data-line="439"></span> extern to specify
the attached metadata. The <span data-line="440"></span><code class="code code1 language-p4 lang-p4 p4 colorized">clone</code><span data-line="440"></span> extern provides a <span data-line="440"></span><code class="code code1 language-p4 lang-p4 p4 colorized">emit</code><span data-line="440"></span> method
which accepts the attached metadata of generic type <span data-line="441"></span><code class="code code1 language-p4 lang-p4 p4 colorized">T</code><span data-line="441"></span>. In PSA,
the metadata is prepended to the cloned packet. It is
the responsibility of the programmer to parse the cloned packet
such that it correctly extracts the attached metadata.
The attached metadata may
be of type <span data-line="446"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">header</span></code><span data-line="446"></span>, <span data-line="446"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">header</span> stack</code><span data-line="446"></span>, <span data-line="446"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">header</span> union</code><span data-line="446"></span> or <span data-line="446"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span></code><span data-line="446"></span> of the
above types. Invoking the <span data-line="447"></span><code class="code code1 language-p4 lang-p4 p4 colorized">emit</code><span data-line="447"></span> method multiple times will attach all
specified metadata to the same cloned packet. The PSA architecture
instantiates the <span data-line="449"></span><code class="code code1 language-p4 lang-p4 p4 colorized">clone</code><span data-line="449"></span> extern in the ingress and egress deparser. A
P4 program can use it in ingress and egress deparser only. It is an
error to instantiate the <span data-line="451"></span><code class="code code1 language-p4 lang-p4 p4 colorized">clone</code><span data-line="451"></span> extern in the P4 control or parser
block.
</p>
<p class="p indent" data-line="454"><span data-line="454"></span>A PSA implementation provides two configuration metadata, <span data-line="454"></span><code class="code code1 language-p4 lang-p4 p4 colorized">clone</code><span data-line="454"></span>
and <span data-line="455"></span><code class="code code1 language-p4 lang-p4 p4 colorized">clone_port</code><span data-line="455"></span>, to the PRE to control the cloning mechanism. When
<span data-line="456"></span><code class="code code1 language-p4 lang-p4 p4 colorized">clone</code><span data-line="456"></span> is set to true, the cloning mechanism generates a
cloned packet with the
optional attached metadata. When <span data-line="458"></span><code class="code code1 language-p4 lang-p4 p4 colorized">clone</code><span data-line="458"></span> is set to false,
cloning is disabled and a cloned packet is
not generated even if the <span data-line="460"></span><code class="code code1 language-p4 lang-p4 p4 colorized">emit</code><span data-line="460"></span> method is invoked in the deparser.
The <span data-line="461"></span><code class="code code1 language-p4 lang-p4 p4 colorized">clone_port</code><span data-line="461"></span> controls the destination of the cloned packet. A
common use case is to the send the cloned packet to the control CPU,
in which case the <span data-line="463"></span><code class="code code1 language-p4 lang-p4 p4 colorized">clone_port</code><span data-line="463"></span> should be set to the value that
represents the control CPU port.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="466" data-line-first="467;psa.p4:266" style="display:block"><code data-line="467;psa.p4:266"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> clone {
  <span style="color:darkgreen">/// Write @hdr into the ingress/egress clone engine.</span>
  <span style="color:darkgreen">/// @T can be a header type, a header stack, a header union, or a struct</span>
  <span style="color:darkgreen">/// containing fields with such types.</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> emit&lt;T&gt;(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> T hdr);
}</code></pre><h5 id="sec-resubmit" class="h4" data-line="470" data-heading-depth="4" style="display:block"><span data-line="470"></span><span class="heading-before"><span class="heading-label">4.2.4.2</span>.&#8194;</span><span data-line="470"></span>Resubmit</h5>
<p class="p noindent" data-line="472"><span data-line="472"></span>A PSA implementation provides a resubmission mechanism to resend the
original packet to ingress parser for recursive processing. The
resubmitted packet is the original packet as seen on the ingress
pipeline. The resubmission mechanism sends the original packet to the
ingress parser. The resubmission mechanism does not make copies of
the original packet. In a PSA implementation, the resubmission mechanism is
logically implemented in
the PRE, that is, even if targets chose to implement it as part of other
controls, the observable behavior should follow the semantics of resubmitting
in the PRE.
</p>
<p class="p indent" data-line="483"><span data-line="483"></span>The resubmission mechanism can optionally attach metadata to the
resubmitted packet. A PSA implementation provides the <span data-line="484"></span><code class="code code1 language-p4 lang-p4 p4 colorized">resubmit</code><span data-line="484"></span>
extern to specify the attached metadata. The <span data-line="485"></span><code class="code code1 language-p4 lang-p4 p4 colorized">resubmit</code><span data-line="485"></span> extern
provides a <span data-line="486"></span><code class="code code1 language-p4 lang-p4 p4 colorized">emit</code><span data-line="486"></span> method which accepts the attached metadata of
generic type <span data-line="487"></span><code class="code code1 language-p4 lang-p4 p4 colorized">T</code><span data-line="487"></span>. In a PSA implementation, the metadata is prepended
to the resubmitted packet. It is the responsibility of the programmer
to parse the resubmitted packet correctly to extract the attached
metadata. The attached metadata can be of type <span data-line="490"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">header</span></code><span data-line="490"></span>, <span data-line="490"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">header</span>
stack</code><span data-line="491"></span>, <span data-line="491"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">header</span> union</code><span data-line="491"></span> or <span data-line="491"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span></code><span data-line="491"></span> of the above types. Invoking the
<span data-line="492"></span><code class="code code1 language-p4 lang-p4 p4 colorized">emit</code><span data-line="492"></span> method multiple times will attach all specified metadata to the
same resubmitted packet. The PSA architecture instantiates the
<span data-line="494"></span><code class="code code1 language-p4 lang-p4 p4 colorized">resubmit</code><span data-line="494"></span> extern in the ingress deparser. A P4 program can use it in
ingress deparser only. It is an error to instantiate the <span data-line="495"></span><code class="code code1 language-p4 lang-p4 p4 colorized">resubmit</code><span data-line="495"></span>
extern in the P4 control or parser block.
</p>
<p class="p indent" data-line="498"><span data-line="498"></span>A PSA implementation provides a configuration bit <span data-line="498"></span><code class="code code1 language-p4 lang-p4 p4 colorized">resubmit</code><span data-line="498"></span> to
the PRE to enable the resubmission mechanism. If <span data-line="499"></span><code class="code code1 language-p4 lang-p4 p4 colorized">resubmit</code><span data-line="499"></span> is
set to true, the resubmission mechanism resends the original packet with the
optional attached metadata. If <span data-line="501"></span><code class="code code1 language-p4 lang-p4 p4 colorized">resubmit</code><span data-line="501"></span> is set to false,
the resubmission mechanism is disabled and the original
packet is not resubmitted even if the <span data-line="503"></span><code class="code code1 language-p4 lang-p4 p4 colorized">emit</code><span data-line="503"></span> method is invoked in the
deparser.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="506" data-line-first="507;psa.p4:276" style="display:block"><code data-line="507;psa.p4:276"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> resubmit {
  <span style="color:darkgreen">/// Write @hdr into the ingress packet buffer.</span>
  <span style="color:darkgreen">/// @T can be a header type, a header stack, a header union or a struct</span>
  <span style="color:darkgreen">/// containing fields with such types.</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> emit&lt;T&gt;(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> T hdr);
}</code></pre><h5 id="sec-recirculate" class="h4" data-line="510" data-heading-depth="4" style="display:block"><span data-line="510"></span><span class="heading-before"><span class="heading-label">4.2.4.3</span>.&#8194;</span><span data-line="510"></span>Recirculate</h5>
<p class="p noindent" data-line="512"><span data-line="512"></span>A PSA implementation provides a recirculation mechanism to send a
deparsed packet from egress pipeline to ingress parser for recursive
processing. The recirculated packet is the deparsed packet after the
egress pipeline. The recirculation mechanism does not make copies of
the original packet. It sends the deparsed packet from egress back to
the ingress parser. In a PSA implementation, the recirculation
mechanism is logically implemented in
the PRE, that is, even if targets chose to implement it as part of other
controls, the observable behavior should follow the semantics of recirculating
in the PRE.
</p>
<p class="p indent" data-line="524"><span data-line="524"></span>The recirculation mechanism can optionally attach metadata to the
recirculated packet. A PSA implementation provides the <span data-line="525"></span><code class="code code1 language-p4 lang-p4 p4 colorized">recirculate</code><span data-line="525"></span>
extern to specify the attached metadata. The <span data-line="526"></span><code class="code code1 language-p4 lang-p4 p4 colorized">emit</code><span data-line="526"></span> method in the
<span data-line="527"></span><code class="code code1 language-p4 lang-p4 p4 colorized">recirculate</code><span data-line="527"></span> extern accepts an attached metadata of generic type <span data-line="527"></span><code class="code code1 language-p4 lang-p4 p4 colorized">T</code><span data-line="527"></span>.
In a PSA implementation, the metadata is prepended to the recirculated
packet. It is the responsibility of the programmer to parse the
recirculated packet correctly to extract the attached metadata. The
attached metadata can be of type <span data-line="531"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">header</span></code><span data-line="531"></span>, <span data-line="531"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">header</span> stack</code><span data-line="531"></span>, <span data-line="531"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">header</span>
union</code><span data-line="532"></span> or <span data-line="532"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span></code><span data-line="532"></span> of the above types. Invoking the <span data-line="532"></span><code class="code code1 language-p4 lang-p4 p4 colorized">emit</code><span data-line="532"></span> method
multiple times will attach all specified metadata to the same
recirculated packet. The PSA architecture instantiates the
<span data-line="535"></span><code class="code code1 language-p4 lang-p4 p4 colorized">recirculate</code><span data-line="535"></span> extern in the ingress deparser. A P4 program can use it
in egress deparser only. It is an error to instantiate the
<span data-line="537"></span><code class="code code1 language-p4 lang-p4 p4 colorized">recirculate</code><span data-line="537"></span> extern in a P4 control or parser block.
</p>
<p class="p indent" data-line="539"><span data-line="539"></span>A PSA implementation provides a configuration bit <span data-line="539"></span><code class="code code1 language-p4 lang-p4 p4 colorized">recirculate</code><span data-line="539"></span> to the
PRE to enable the recirculation mechanism. If <span data-line="540"></span><code class="code code1 language-p4 lang-p4 p4 colorized">recirculate</code><span data-line="540"></span> is
set to true, the recirculation mechanism sends back the deparsed packet with
the optional attached metadata to the ingress parser. If
<span data-line="543"></span><code class="code code1 language-p4 lang-p4 p4 colorized">recirculate</code><span data-line="543"></span> is set to false, the recirculation mechanism
is disabled and the deparsed packet is not recirculated even if the
<span data-line="545"></span><code class="code code1 language-p4 lang-p4 p4 colorized">emit</code><span data-line="545"></span> method is invoked in the deparser.
</p>
<p class="p indent" data-line="547"><span data-line="547"></span>One possible implementation of the <span data-line="547"></span><code class="code code1 language-p4 lang-p4 p4 colorized">recirculate</code><span data-line="547"></span> bit is to set the
<span data-line="548"></span><code class="code code1 language-p4 lang-p4 p4 colorized">egress_port</code><span data-line="548"></span> metadata to a dedicated recirculation port number. A PSA
implementation sends the deparsed packet to the dedicated
recirculation port to recirculate the packet.
</p>
<p class="p indent" data-line="552"><span data-line="552"></span>A PSA implementation provides a metadata bit <span data-line="552"></span><code class="code code1 language-p4 lang-p4 p4 colorized">is_recirc</code><span data-line="552"></span> as the input
metadata to the parser to indicate if a packet is a recirculation
packet. The <span data-line="554"></span><code class="code code1 language-p4 lang-p4 p4 colorized">is_recirc</code><span data-line="554"></span> bit is true if the packet is a recirculation
packet.
</p>
<p class="p indent" data-line="557"><span data-line="557"></span>One possible implementation of the <span data-line="557"></span><code class="code code1 language-p4 lang-p4 p4 colorized">is_recirc</code><span data-line="557"></span> bit is to set the bit
based on the <span data-line="558"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ingress_port</code><span data-line="558"></span> metadata of the received packet. If the
<span data-line="559"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ingress_port</code><span data-line="559"></span> metadata is equal to the dedicated recirculation port
number, then the <span data-line="560"></span><code class="code code1 language-p4 lang-p4 p4 colorized">is_recirc</code><span data-line="560"></span> bit is set.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="562" data-line-first="563;psa.p4:285" style="display:block"><code data-line="563;psa.p4:285"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> recirculate {
  <span style="color:darkgreen">/// Write @hdr into the egress packet.</span>
  <span style="color:darkgreen">/// @T can be a header type, a header stack, a header union or a struct</span>
  <span style="color:darkgreen">/// containing fields with such types.</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> emit&lt;T&gt;(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> T hdr);
}</code></pre><h3 id="sec-bqe" class="h2" data-line="567" data-heading-depth="2" style="display:block"><span data-line="567"></span><span class="heading-before"><span class="heading-label">4.3</span>.&#8194;</span><span data-line="567"></span>Buffering Queuing Engine</h3>
<p class="p noindent" data-line="569"><span data-line="569"></span>The BufferingQueueingEngine extern (abbreviated BQE) represents
another part of the PSA pipeline, after Egress, that is not
programmable via writing P4 code.
</p>
<p class="p indent" data-line="573"><span data-line="573"></span>Even though the BQE can not be programmed using P4, it can be
configured both directly using control plane APIs and by setting
intrinsic metadata.
</p>
<p class="p indent" data-line="577"><span data-line="577"></span>The BQE extern object has no constructor, and thus it cannot be
instantiated in the user<span data-line="578"></span>&#39;<span data-line="578"></span>s P4 program. The architecture instantiates
it exactly once, without requiring the user<span data-line="579"></span>&#39;<span data-line="579"></span>s P4 program to
instantiate it.
The BQE is made available to the Egress programmable block
using the same mechanism as packet<span data-line="582"></span>_<span data-line="582"></span>in. A corresponding Packet
Replication Engine (PRE) extern is defined for the Ingress pipeline
(see<span data-line="584"></span>&nbsp;<a href="#sec-pre" title="4.2.&#8194;Packet Replication Engine" class="localref" style="target-element:h2"><span class="heading-label">4.2</span></a><span data-line="584"></span>).
</p><h4 id="sec-egress-actions" class="h3" data-line="587" data-heading-depth="3" style="display:block"><span data-line="587"></span><span class="heading-before"><span class="heading-label">4.3.1</span>.&#8194;</span><span data-line="587"></span>Actions for directing packets during egress</h4><h5 id="sec-bqe-drop" class="h4" data-line="589" data-heading-depth="4" style="display:block"><span data-line="589"></span><span class="heading-before"><span class="heading-label">4.3.1.1</span>.&#8194;</span><span data-line="589"></span>Drop operation</h5>
<p class="p noindent" data-line="591"><span data-line="591"></span>Do not send the packet out of the device after egress processing is
complete.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="594" data-line-first="595;psa.p4:231" style="display:block"><code data-line="595;psa.p4:231"><span style="color:darkgreen">/// Modify egress output metadata to cause no packet to be sent out of</span>
<span style="color:darkgreen">/// the device.</span>

<span style="color:darkgreen">/// This action does not change whether a clone will occur.  It will</span>
<span style="color:darkgreen">/// prevent a packet from being recirculated.</span>

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">action</span> egress_drop(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_egress_output_metadata_t meta)
{
    meta.drop = <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">true</span>;
}</code></pre><h5 id="sec-egress-truncate" class="h4" data-line="598" data-heading-depth="4" style="display:block"><span data-line="598"></span><span class="heading-before"><span class="heading-label">4.3.1.2</span>.&#8194;</span><span data-line="598"></span>Truncate operation</h5>
<p class="p noindent" data-line="600"><span data-line="600"></span>For all copies of the packet made at the end of Egress processing,
truncate the payload to be at most the specified number of bytes.
Specifying 0 is legal, and causes only packet headers to be sent, with
no payload.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="605" data-line-first="606;psa.p4:244" style="display:block"><code data-line="606;psa.p4:244"><span style="color:darkgreen">/// For any copies made of this packet at the end of Egress</span>
<span style="color:darkgreen">/// processing, truncate the payload to at most payload_bytes bytes in</span>
<span style="color:darkgreen">/// length.</span>

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">action</span> egress_truncate(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_ingress_output_metadata_t meta,
                       <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> PacketLength_t payload_bytes)
{
    meta.truncate = <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">true</span>;
    meta.truncate_payload_bytes = payload_bytes;
}</code></pre><h3 id="sec-hash-algorithms" class="h2" data-line="610" data-heading-depth="2" style="display:block"><span data-line="610"></span><span class="heading-before"><span class="heading-label">4.4</span>.&#8194;</span><span data-line="610"></span>Hashes</h3>
<p class="p noindent" data-line="612"><span data-line="612"></span>Supported hash algorithms:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="613" data-line-first="614;psa.p4:298" style="display:block"><code data-line="614;psa.p4:298"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">enum</span> HashAlgorithm_t {
  IDENTITY,
  CRC<span class="constant" style="color:purple">32</span>,
  CRC<span class="constant" style="color:purple">32</span>_CUSTOM,
  CRC<span class="constant" style="color:purple">16</span>,
  CRC<span class="constant" style="color:purple">16</span>_CUSTOM,
  ONES_COMPLEMENT16,  <span style="color:darkgreen">/// One&#39;s complement 16-bit sum used for IPv4 headers,</span>
                      <span style="color:darkgreen">/// TCP, and UDP.</span>
  TARGET_DEFAULT      <span style="color:darkgreen">/// target implementation defined</span>
}</code></pre><h4 id="sec-hash-function" class="h3" data-line="617" data-heading-depth="3" style="display:block"><span data-line="617"></span><span class="heading-before"><span class="heading-label">4.4.1</span>.&#8194;</span><span data-line="617"></span>Hash function</h4>
<p class="p noindent" data-line="619"><span data-line="619"></span>Example usage:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="621" data-line-first="622" style="display:block"><code data-line="622"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">parser</span> P() {
  Hash&lt;<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">16</span>&gt;&gt;(HashAlgorithm_t.CRC<span class="constant" style="color:purple">16</span>) h;
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">16</span>&gt; hash_value = h.get_hash(buffer);
}</code></pre>
<p class="p noindent para-continued" data-line="628"><span data-line="628"></span>Parameters:
</p>
<ul class="ul list-dash compact" data-line="630">
<li class="li ul-li list-dash-li compact-li" data-line="630"><span data-line="630"></span>algo The algorithm to use for computation (see<span data-line="630"></span>&nbsp;<a href="#sec-hash-algorithms" title="4.4.&#8194;Hashes" class="localref" style="target-element:h2"><span class="heading-label">4.4</span></a><span data-line="630"></span>).
</li>
<li class="li ul-li list-dash-li compact-li" data-line="631"><span data-line="631"></span>O    The type of the return value of the hash.
</li></ul>

<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="633" data-line-first="634;psa.p4:319" style="display:block"><code data-line="634;psa.p4:319"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> Hash&lt;O&gt; {
  <span style="color:darkgreen">/// Constructor</span>
  Hash(HashAlgorithm_t algo);

  <span style="color:darkgreen">/// Compute the hash for data.</span>
  <span style="color:darkgreen">/// @param data The data over which to calculate the hash.</span>
  <span style="color:darkgreen">/// @return The hash value.</span>
  O get_hash&lt;D&gt;(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> D data);

  <span style="color:darkgreen">/// Compute the hash for data, with modulo by max, then add base.</span>
  <span style="color:darkgreen">/// @param base Minimum return value.</span>
  <span style="color:darkgreen">/// @param data The data over which to calculate the hash.</span>
  <span style="color:darkgreen">/// @param max The hash value is divided by max to get modulo.</span>
  <span style="color:darkgreen">///        An implementation may limit the largest value supported,</span>
  <span style="color:darkgreen">///        e.g. to a value like 32, or 256.</span>
  <span style="color:darkgreen">/// @return (base + (h % max)) where h is the hash value.</span>
  O get_hash&lt;T, D&gt;(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> T base, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> D data, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> T max);
}</code></pre>
<p class="p noindent para-continued" data-line="637"><span data-line="637"></span>TBD: Should there be a <span data-line="637"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">const</span></code><span data-line="637"></span> defined that specifies the maximum
allowed value of <span data-line="638"></span><code class="code code1 language-p4 lang-p4 p4 colorized">max</code><span data-line="638"></span> parameter?
</p><h3 id="sec-checksum-computation" class="h2" data-line="641" data-heading-depth="2" style="display:block"><span data-line="641"></span><span class="heading-before"><span class="heading-label">4.5</span>.&#8194;</span><span data-line="641"></span>Checksum computation</h3>
<p class="p noindent" data-line="643"><span data-line="643"></span>Checksums and hash value generators are examples of functions that
operate on a stream of bytes from a packet to produce an integer. The
integer may be used, for example, as an integrity check for a packet
or as a means to generate a pseudo-random value in a given range on a
packet-by-packet or flow-by-flow basis.
</p>
<p class="p indent" data-line="649"><span data-line="649"></span>Parameters:
</p>
<ul class="ul list-dash compact" data-line="651">
<li class="li ul-li list-dash-li compact-li" data-line="651"><span data-line="651"></span>W    The width of the checksum
</li></ul>

<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="653" data-line-first="654;psa.p4:329" style="display:block"><code data-line="654;psa.p4:329"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> Checksum&lt;W&gt; {
  Checksum(HashAlgorithm_t hash);          <span style="color:darkgreen">/// constructor</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> clear();              <span style="color:darkgreen">/// prepare unit for computation</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> update&lt;T&gt;(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> T data); <span style="color:darkgreen">/// add data to checksum</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> remove&lt;T&gt;(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> T data); <span style="color:darkgreen">/// remove data from existing checksum</span>
  W    get();               <span style="color:darkgreen">/// get the checksum for data added since last clear</span>
}</code></pre><h4 id="sec-checksum-example" class="h3" data-line="657" data-heading-depth="3" style="display:block"><span data-line="657"></span><span class="heading-before"><span class="heading-label">4.5.1</span>.&#8194;</span><span data-line="657"></span>Checksum example</h4>
<p class="p noindent" data-line="659"><span data-line="659"></span>The partial P4 program below demonstrates one way to use the
<span data-line="660"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Checksum</code><span data-line="660"></span> extern to verify whether the checksum field in a parsed
IPv4 header is correct, and set a parser error if it is wrong.  It
also demonstrates checking for parser errors in the ingress control
block, dropping the packet if any errors occurred during parsing.  PSA
programs may choose to handle packets with parser errors in other ways
than shown in this example<span data-line="665"></span> <span data-line="665"></span>&#8211;<span data-line="665"></span> it is up to the P4 program author to
choose and write the desired behavior.
</p>
<p class="p indent" data-line="668"><span data-line="668"></span>Neither P4<span data-line="668"></span><sub>16</sub><span data-line="668"></span> nor the PSA provide any special mechanisms to record
the location within a packet that a parser error occurred.  A P4
program author can choose to record such location information
explicitly.  For example, one may define metadata fields specifically
for that purpose, e.g. to hold an encoded value representing the last
parser state reached, or the number of bytes extracted so far.  Then,
assign values to those fields within parser state code.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="676" data-line-first="677;examples/psa-example-parser-checksum.p4:192" style="display:block"><code data-line="677;examples/psa-example-parser-checksum.p4:192"><span style="color:darkgreen">// Define additional error values, one of them for packets with</span>
<span style="color:darkgreen">// incorrect IPv4 header checksums.</span>
<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span> {
    UnhandledIPv4Options,
    BadIPv4HeaderChecksum
}

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt; PacketCounter_t;
<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">8</span>&gt;  ErrorIndex_t;

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">const</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">9</span>&gt; NUM_ERRORS = <span class="constant" style="color:purple">256</span>;

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">parser</span> IngressParserImpl(packet_in buffer,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> headers parsed_hdr,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> metadata user_meta,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> psa_ingress_parser_input_metadata_t istd,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> psa_parser_output_metadata_t ostd)
{
    Checksum&lt;<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">16</span>&gt;&gt;(HashAlgorithm_t.ONES_COMPLEMENT16) ck;
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> start {
        buffer.extract(parsed_hdr.ethernet);
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">select</span>(parsed_hdr.ethernet.etherType) {
            <span class="constant" style="color:purple">0x0800</span>: parse_ipv4;
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">default</span>: accept;
        }
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> parse_ipv4 {
        buffer.extract(parsed_hdr.ipv4);
        <span style="color:darkgreen">// TBD: It would be good to enhance this example to</span>
        <span style="color:darkgreen">// demonstrate checking of IPv4 header checksums for IPv4</span>
        <span style="color:darkgreen">// headers with options, but this example does not handle such</span>
        <span style="color:darkgreen">// packets.</span>
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">verify</span>(parsed_hdr.ipv4.ihl == <span class="constant" style="color:purple">5</span>, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.UnhandledIPv4Options);
        <span style="color:darkgreen">// TBD: Update the code below for checking the IPv4 header</span>
        <span style="color:darkgreen">// checksum with whatever the API we decide upon for a PSA</span>
        <span style="color:darkgreen">// checksum extern.</span>
        ck.clear();
        ck.update({ parsed_hdr.ipv4.version,
                parsed_hdr.ipv4.ihl,
                parsed_hdr.ipv4.diffserv,
                parsed_hdr.ipv4.totalLen,
                parsed_hdr.ipv4.identification,
                parsed_hdr.ipv4.flags,
                parsed_hdr.ipv4.fragOffset,
                parsed_hdr.ipv4.ttl,
                parsed_hdr.ipv4.protocol,
                <span style="color:darkgreen">//parsed_hdr.ipv4.hdrChecksum, // intentionally leave this out</span>
                parsed_hdr.ipv4.srcAddr,
                parsed_hdr.ipv4.dstAddr });
        <span style="color:darkgreen">// The verify statement below will cause the parser to enter</span>
        <span style="color:darkgreen">// the reject state, and thus terminate parsing immediately,</span>
        <span style="color:darkgreen">// if the IPv4 header checksum is wrong.  It will also record</span>
        <span style="color:darkgreen">// the error error.BadIPv4HeaderChecksum, which will be</span>
        <span style="color:darkgreen">// available in a metadata field in the ingress control block.</span>
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">verify</span>(ck.get() == parsed_hdr.ipv4.hdrChecksum,
               <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.BadIPv4HeaderChecksum);
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">select</span>(parsed_hdr.ipv4.protocol) {
            <span class="constant" style="color:purple">6</span>: parse_tcp;
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">default</span>: accept;
        }
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> parse_tcp {
        buffer.extract(parsed_hdr.tcp);
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> accept;
    }
}

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> ingress(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> headers hdr,
                <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> metadata user_meta,
                PacketReplicationEngine pre,
                <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span>    psa_ingress_input_metadata_t  istd,
                <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_ingress_output_metadata_t ostd)
{
    <span style="color:darkgreen">// Table parser_error_count_and_convert below shows one way to</span>
    <span style="color:darkgreen">// count the number of times each parser error was encountered.</span>
    <span style="color:darkgreen">// Although it is not used in this example program, it also shows</span>
    <span style="color:darkgreen">// how to convert the error value into a unique bit vector value</span>
    <span style="color:darkgreen">// &#39;error_idx&#39;, which can be useful if you wish to put a bit</span>
    <span style="color:darkgreen">// vector encoding of an error into a packet header, e.g. for a</span>
    <span style="color:darkgreen">// packet sent to the control CPU.</span>

    DirectCounter&lt;PacketCounter_t&gt;(CounterType_t.PACKETS) parser_error_counts;
    ErrorIndex_t error_idx;

    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">action</span> set_error_idx (ErrorIndex_t idx) {
        error_idx = idx;
        parser_error_counts.count();
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">table</span> parser_error_count_and_convert {
        key = {
            istd.parser_error : exact;
        }
        actions = {
            set_error_idx;
        }
        default_action = set_error_idx(<span class="constant" style="color:purple">0</span>);
        <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">const</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">entries</span> = {
            <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.NoError               : set_error_idx(<span class="constant" style="color:purple">1</span>);
            <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.PacketTooShort        : set_error_idx(<span class="constant" style="color:purple">2</span>);
            <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.NoMatch               : set_error_idx(<span class="constant" style="color:purple">3</span>);
            <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.StackOutOfBounds      : set_error_idx(<span class="constant" style="color:purple">4</span>);
            <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.HeaderTooShort        : set_error_idx(<span class="constant" style="color:purple">5</span>);
            <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.ParserTimeout         : set_error_idx(<span class="constant" style="color:purple">6</span>);
            <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.BadIPv4HeaderChecksum : set_error_idx(<span class="constant" style="color:purple">7</span>);
            <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.UnhandledIPv4Options  : set_error_idx(<span class="constant" style="color:purple">8</span>);
        }
        psa_direct_counters = { parser_error_counts };
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">apply</span> {
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (istd.parser_error != <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">error</span>.NoError) {
            <span style="color:darkgreen">// Example code showing how to count number of times each</span>
            <span style="color:darkgreen">// kind of parser error was seen.</span>
            parser_error_count_and_convert.<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">apply</span>();
            ingress_drop(ostd);
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">exit</span>;
        }
        <span style="color:darkgreen">// Do normal packet processing here.</span>
    }
}</code></pre>
<p class="p noindent para-continued" data-line="680"><span data-line="680"></span>The partial program below demonstrates one way to use the <span data-line="680"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Checksum</code><span data-line="680"></span>
extern to calculate and then fill in a correct IPv4 header checksum in
the <span data-line="682"></span><code class="code code1 language-p4 lang-p4 p4 colorized">computeChecksum</code><span data-line="682"></span> control block, just before the deparser.  In
this example, the checksum is calculated fresh, so the outgoing
checksum will be correct regardless of what changes might have been
made to the IPv4 header fields in the ingress (or egress) control
block that precedes it.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="688" data-line-first="689;examples/psa-example-parser-checksum.p4:237" style="display:block"><code data-line="689;examples/psa-example-parser-checksum.p4:237"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> computeChecksum(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> headers hdr, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> metadata meta) {
    Checksum&lt;<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">16</span>&gt;&gt;(HashAlgorithm_t.ONES_COMPLEMENT16) ck;
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">apply</span> {
        <span style="color:darkgreen">// TBD: Update the code below for checking the IPv4 header</span>
        <span style="color:darkgreen">// checksum with whatever the API we decide upon for a PSA</span>
        <span style="color:darkgreen">// checksum extern.</span>
        ck.clear();
        ck.update({ hdr.ipv4.version,
                hdr.ipv4.ihl,
                hdr.ipv4.diffserv,
                hdr.ipv4.totalLen,
                hdr.ipv4.identification,
                hdr.ipv4.flags,
                hdr.ipv4.fragOffset,
                hdr.ipv4.ttl,
                hdr.ipv4.protocol,
                <span style="color:darkgreen">//hdr.ipv4.hdrChecksum, // intentionally leave this out</span>
                hdr.ipv4.srcAddr,
                hdr.ipv4.dstAddr });
        hdr.ipv4.hdrChecksum = ck.get();
    }
}</code></pre>
<p class="p noindent para-continued" data-line="692"><span data-line="692"></span>TBD: It would be good if the Checksum extern can handle a case of
doing a <span data-line="693"></span>&#8216;delta&#8217;<span data-line="693"></span> correction of a TCP header checksum when an IPv4 or
IPv6 source or destination address is changed, e.g. due to
implementing a feature like NAT.  This should be possible without
having to redo the TCP checksum over the entire TCP payload, by
assuming that the incoming TCP header checksum was correct.  With the
proposed <span data-line="698"></span><code class="code code1 language-p4 lang-p4 p4 colorized">remove</code><span data-line="698"></span> and <span data-line="698"></span><code class="code code1 language-p4 lang-p4 p4 colorized">update</code><span data-line="698"></span> methods, this should be possible by
calling <span data-line="699"></span><code class="code code1 language-p4 lang-p4 p4 colorized">remove</code><span data-line="699"></span> on the old source/destination addresses, and then
<span data-line="700"></span><code class="code code1 language-p4 lang-p4 p4 colorized">update</code><span data-line="700"></span> on the new source/destination addresses.  It would also be
good to have a short example program demonstrating one way to do this,
ideally with a one-packet test case to verify it works when it is
implemented.
</p><h3 id="sec-counters" class="h2" data-line="706" data-heading-depth="2" style="display:block"><span data-line="706"></span><span class="heading-before"><span class="heading-label">4.6</span>.&#8194;</span><span data-line="706"></span>Counters</h3>
<p class="p noindent" data-line="708"><span data-line="708"></span>Counters are a mechanism for keeping statistics.  The control plane
can read counter values.  A P4 program cannot read counter values,
only update them.  If you wish to implement a feature involving
sequence numbers in packets, for example, use Registers instead
(Section<span data-line="712"></span>&nbsp;<a href="#sec-registers" title="4.8.&#8194;Registers" class="localref" style="target-element:h2"><span class="heading-label">4.8</span></a><span data-line="712"></span>).
</p>
<p class="p indent" data-line="714"><span data-line="714"></span>Direct counters are counters associated with a particular P4 table,
and are implemented by the extern <span data-line="715"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="715"></span>.  There are also
indexed counters, which are implemented by the extern <span data-line="716"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Counter</code><span data-line="716"></span>.  The
primary differences between direct counters and indexed counters are:
</p>
<ul class="ul list-dash compact" data-line="719">
<li class="li ul-li list-dash-li compact-li" data-line="719"><span data-line="719"></span>Number of independently updatable counter values:

<ul class="ul list-dash compact" data-line="720">
<li class="li ul-li list-dash-li compact-li" data-line="720"><span data-line="720"></span>A single instantiation of a direct counter always contains as many
independent counter values as the number of entries in the table
with which it is associated (TBD: see below for what this means
for tables that use action profiles).
</li>
<li class="li ul-li list-dash-li compact-li" data-line="724"><span data-line="724"></span>You must specify the number of independent counter values for an
indexed counter when instantiating it.  This number of counters
need not be the same as the size of any table.
</li></ul></li>
<li class="li ul-li list-dash-li compact-li" data-line="727"><span data-line="727"></span>Where counter updates are allowed in the P4 program:

<ul class="ul list-dash compact" data-line="728">
<li class="li ul-li list-dash-li compact-li" data-line="728"><span data-line="728"></span>For a direct counter, you may only invoke its <span data-line="728"></span><code class="code code1 language-p4 lang-p4 p4 colorized">count</code><span data-line="728"></span> method from
inside the actions of the table with which it is associated, and
this always updates the counter value associated with the matching
table entry.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="732"><span data-line="732"></span>For an indexed counter, you may invoke its <span data-line="732"></span><code class="code code1 language-p4 lang-p4 p4 colorized">count</code><span data-line="732"></span> method
anywhere in the P4 program where extern object method invocations
are permitted (e.g. inside actions, or directly inside a control<span data-line="734"></span>&#39;<span data-line="734"></span>s
<span data-line="735"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">apply</span></code><span data-line="735"></span> block), and every such invocation must specify the index
of the counter value to be updated.
</li></ul></li></ul>

<p class="p noindent" data-line="738"><span data-line="738"></span>Counters are only intended to support packet counters and byte
counters, or a combination of both called <span data-line="739"></span><code class="code code1 language-p4 lang-p4 p4 colorized">PACKETS_AND_BYTES</code><span data-line="739"></span>.  The
byte counts are always increased by some measure of the packet length,
where the packet length used might vary from one PSA implementation to
another.  For example, one implementation might use the Ethernet frame
length, including the Ethernet header and FCS bytes, as the packet
arrived on a physical port.  Another might not include the FCS bytes
in its definition of the packet length.  Another might only include
the Ethernet payload length.  Each PSA implementation should document
how it determines the packet length used for byte counter updates.
</p>
<p class="p indent" data-line="749"><span data-line="749"></span>If you wish to keep counts of other quantities, or to have more
precise control over the packet length used in a byte counter, you may
use Registers to achieve that (Section<span data-line="751"></span>&nbsp;<a href="#sec-registers" title="4.8.&#8194;Registers" class="localref" style="target-element:h2"><span class="heading-label">4.8</span></a><span data-line="751"></span>).
</p><h4 id="sec-counter-types" class="h3" data-line="754" data-heading-depth="3" style="display:block"><span data-line="754"></span><span class="heading-before"><span class="heading-label">4.6.1</span>.&#8194;</span><span data-line="754"></span>Counter types</h4>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="756" data-line-first="757;psa.p4:337" style="display:block"><code data-line="757;psa.p4:337"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">enum</span> CounterType_t {
    PACKETS,
    BYTES,
    PACKETS_AND_BYTES
}</code></pre><h4 id="sec-counter" class="h3" data-line="760" data-heading-depth="3" style="display:block"><span data-line="760"></span><span class="heading-before"><span class="heading-label">4.6.2</span>.&#8194;</span><span data-line="760"></span>Counter</h4>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="762" data-line-first="763;psa.p4:369" style="display:block"><code data-line="763;psa.p4:369"><span style="color:darkgreen">/// Indirect counter with n_counters independent counter values, where</span>
<span style="color:darkgreen">/// every counter value has a data plane size specified by type W.</span>

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> Counter&lt;W, S&gt; {
  Counter(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt; n_counters, CounterType_t type);
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> count(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> S index);

  <span style="color:darkgreen">/*</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> The control plane API uses 64-bit wide counter values.  It is</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> not intended to represent the size of counters as they are</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> stored in the data plane.  It is expected that control plane</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> software will periodically read the data plane counter values,</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> and accumulate them into larger counters that are large enough</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> to avoid reaching their maximum values for a suitably long</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> operational time.  A 64-bit byte counter increased at maximum</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> line rate for a 100 gigabit port would take over 46 years to</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> wrap.</span>

<span style="color:darkgreen">  @ControlPlaneAPI</span>
<span style="color:darkgreen">  {</span>
<span style="color:darkgreen">    bit&lt;64&gt; read      (in S index);</span>
<span style="color:darkgreen">    bit&lt;64&gt; sync_read (in S index);</span>
<span style="color:darkgreen">    void set          (in S index, in bit&lt;64&gt; seed);</span>
<span style="color:darkgreen">    void reset        (in S index);</span>
<span style="color:darkgreen">    void start        (in S index);</span>
<span style="color:darkgreen">    void stop         (in S index);</span>
<span style="color:darkgreen">  }</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">*/</span>
}</code></pre>
<p class="p noindent para-continued" data-line="766"><span data-line="766"></span>See below for pseudocode of an example implementation for the Counter
extern.
</p>
<p class="p indent" data-line="769"><span data-line="769"></span>The example implementation for <span data-line="769"></span><code class="code code1 language-p4 lang-p4 p4 colorized">next_counter_value</code><span data-line="769"></span> is not intended to
restrict PSA implementations.  In particular, the storage format for
<span data-line="771"></span><code class="code code1 language-p4 lang-p4 p4 colorized">PACKETS_AND_BYTES</code><span data-line="771"></span> type counters is just one example of how it could
be done.  Implementations are free to store state in other ways, as
long as the control plane API returns the correct packet and byte
count values.
</p>
<p class="p indent" data-line="776"><span data-line="776"></span>Two common techniques for counter implementations in the data plane are:
</p>
<ul class="ul list-dash compact" data-line="778">
<li class="li ul-li list-dash-li compact-li" data-line="778"><span data-line="778"></span>wrap around counters
</li>
<li class="li ul-li list-dash-li compact-li" data-line="779"><span data-line="779"></span>saturating counters, that <span data-line="779"></span>&#8216;stick&#8217;<span data-line="779"></span> at their maximum possible value,
without wrapping around.
</li></ul>

<p class="p noindent" data-line="782"><span data-line="782"></span>This specification does not mandate any particular approach in the
data plane.  Implementations should strive to avoid losing information
in counters.  One common implementation technique is to implement an
atomic <span data-line="785"></span>&#8220;read and clear&#8221;<span data-line="785"></span> operation in the data plane that can be
invoked by the control plane software.  The control plane software
invokes this operation frequently enough to prevent counters from ever
wrapping or saturating, and adds the values read to larger counters in
driver memory.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="791" data-line-first="792" style="display:block"><code data-line="792">Counter(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt; n_counters, CounterType_t type) {
    this.num_counters = n_counters;
    this.counter_vals = new array of size n_counters, each element with type W;
    this.type = type;
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (this.type == CounterType_t.PACKETS_AND_BYTES) {
        <span style="color:darkgreen">// Packet and byte counts share storage in the same counter</span>
        <span style="color:darkgreen">// state.  Should we have a separate constructor with an</span>
        <span style="color:darkgreen">// additional argument indicating how many of the bits to use</span>
        <span style="color:darkgreen">// for the byte counter?</span>
        W shift_amount = TBD;
        this.shifted_packet_count = ((W) <span class="constant" style="color:purple">1</span>) &lt;&lt; shift_amount;
        this.packet_count_mask = (~((W) <span class="constant" style="color:purple">0</span>)) &lt;&lt; shift_amount;
        this.byte_count_mask = ~this.packet_count_mask;
    }
}

W next_counter_value(W cur_value, CounterType_t type) {
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (type == CounterType_t.PACKETS) {
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">return</span> (cur_value + <span class="constant" style="color:purple">1</span>);
    }
    <span style="color:darkgreen">// Exactly which packet bytes are included in packet_len is</span>
    <span style="color:darkgreen">// implementation-specific.</span>
    PacketLength_t packet_len = &lt;packet length <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> bytes&gt;;
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (type == CounterType_t.BYTES) {
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">return</span> (cur_value + packet_len);
    }
    <span style="color:darkgreen">// type must be CounterType_t.PACKETS_AND_BYTES</span>
    <span style="color:darkgreen">// In type W, the least significant bits contain the byte</span>
    <span style="color:darkgreen">// count, and most significant bits contain the packet count.</span>
    <span style="color:darkgreen">// This is merely one example storage format.  Implementations</span>
    <span style="color:darkgreen">// are free to store packets_and_byte state in other ways, as</span>
    <span style="color:darkgreen">// long as the control plane API returns the correct separate</span>
    <span style="color:darkgreen">// packet and byte count values.</span>
    W next_packet_count = ((cur_value + this.shifted_packet_count) &amp;
                           this.packet_count_mask);
    W next_byte_count = (cur_value + packet_len) &amp; this.byte_count_mask;
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">return</span> (next_packet_count | next_byte_count);
}

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> count(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> S index) {
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (index &lt; this.num_counters) {
        this.counter_vals[index] = next_counter_value(this.counter_vals[index],
                                                      this.type);
    } <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">else</span> {
        <span style="color:darkgreen">// No counter_vals updated if index is out of range.</span>
        <span style="color:darkgreen">// See below for optional debug information to record.</span>
    }
}</code></pre>
<p class="p noindent para-continued" data-line="842"><span data-line="842"></span>Optional debugging information that may be kept if an <span data-line="842"></span><code class="code code1 language-p4 lang-p4 p4 colorized">index</code><span data-line="842"></span> value is
out of range includes:
</p>
<ul class="ul list-dash compact" data-line="845">
<li class="li ul-li list-dash-li compact-li" data-line="845"><span data-line="845"></span>Number of times this occurs.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="846"><span data-line="846"></span>A FIFO of the first N out-of-range index values that occur, where N
is implementation-defined (e.g. it might only be 1).  Extra
information to identify which <span data-line="848"></span><code class="code code1 language-p4 lang-p4 p4 colorized">count()</code><span data-line="848"></span> method call in the P4
program had the out-of-range <span data-line="849"></span><code class="code code1 language-p4 lang-p4 p4 colorized">index</code><span data-line="849"></span> value is also recommended.
</li></ul>
<h4 id="sec-direct-counter" class="h3" data-line="852" data-heading-depth="3" style="display:block"><span data-line="852"></span><span class="heading-before"><span class="heading-label">4.6.3</span>.&#8194;</span><span data-line="852"></span>Direct Counter</h4>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="854" data-line-first="855;psa.p4:388" style="display:block"><code data-line="855;psa.p4:388"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> DirectCounter&lt;W&gt; {
  DirectCounter(CounterType_t type);
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> count();

  <span style="color:darkgreen">/*</span>
<span style="color:darkgreen">  @ControlPlaneAPI</span>
<span style="color:darkgreen">  {</span>
<span style="color:darkgreen">    W    read&lt;W&gt;      (in TableEntry key);</span>
<span style="color:darkgreen">    W    sync_read&lt;W&gt; (in TableEntry key);</span>
<span style="color:darkgreen">    void set          (in W seed);</span>
<span style="color:darkgreen">    void reset        (in TableEntry key);</span>
<span style="color:darkgreen">    void start        (in TableEntry key);</span>
<span style="color:darkgreen">    void stop         (in TableEntry key);</span>
<span style="color:darkgreen">  }</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">*/</span>
}</code></pre>
<p class="p noindent para-continued" data-line="858"><span data-line="858"></span>A <span data-line="858"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="858"></span> instance must appear in the list of values of the
<span data-line="859"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_direct_counters</code><span data-line="859"></span> table attribute for exactly one table.  We call
this table the <span data-line="860"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="860"></span> instance<span data-line="860"></span>&#39;<span data-line="860"></span>s <span data-line="860"></span>&#8220;owner&#8221;<span data-line="860"></span>.  It is an error to
call the <span data-line="861"></span><code class="code code1 language-p4 lang-p4 p4 colorized">count</code><span data-line="861"></span> method for a <span data-line="861"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="861"></span> instance anywhere except
inside an action of its owner table.
</p>
<p class="p indent" data-line="864"><span data-line="864"></span>The counter value updated by an invocation of <span data-line="864"></span><code class="code code1 language-p4 lang-p4 p4 colorized">count</code><span data-line="864"></span> is always the
one associated with the table entry that matched.
</p>
<p class="p indent" data-line="867"><span data-line="867"></span>TBD: How to describe which counter value is updated for tables with
action profiles and direct counters?  Or should this combination even
be allowed?
</p>
<p class="p indent" data-line="871"><span data-line="871"></span>An action of an owner table need not have <span data-line="871"></span><code class="code code1 language-p4 lang-p4 p4 colorized">count</code><span data-line="871"></span> method calls for all
of the <span data-line="872"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="872"></span> instances that the table owns.  You must use an
explicit <span data-line="873"></span><code class="code code1 language-p4 lang-p4 p4 colorized">count()</code><span data-line="873"></span> method call on a <span data-line="873"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="873"></span> to update it,
otherwise its state will not change.
</p>
<p class="p indent" data-line="876"><span data-line="876"></span>An example implementation for the <span data-line="876"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="876"></span> extern is
essentially the same as the one for <span data-line="877"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Counter</code><span data-line="877"></span>.  Since there is no
<span data-line="878"></span><code class="code code1 language-p4 lang-p4 p4 colorized">index</code><span data-line="878"></span> parameter to the <span data-line="878"></span><code class="code code1 language-p4 lang-p4 p4 colorized">count</code><span data-line="878"></span> method, there is no need to check for
whether it is in range.
</p>
<p class="p indent" data-line="881"><span data-line="881"></span>The rules here mean that an action that calls <span data-line="881"></span><code class="code code1 language-p4 lang-p4 p4 colorized">count</code><span data-line="881"></span> on a
<span data-line="882"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="882"></span> instance may only be an action of that instance<span data-line="882"></span>&#39;<span data-line="882"></span>s one
owner table.  If you want to have a single action <span data-line="883"></span><code class="code code1 language-p4 lang-p4 p4 colorized">A</code><span data-line="883"></span> that can be
invoked by multiple tables, you can still do so by having a unique
action for each such table with a <span data-line="885"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="885"></span>, where each such
action in turn calls action <span data-line="886"></span><code class="code code1 language-p4 lang-p4 p4 colorized">A</code><span data-line="886"></span>, in addition to any <span data-line="886"></span><code class="code code1 language-p4 lang-p4 p4 colorized">count</code><span data-line="886"></span>
invocations they have.
</p>
<p class="p indent" data-line="889"><span data-line="889"></span>A <span data-line="889"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="889"></span> instance must have a counter value associated with
its owner table that is updated when there is a default action
assigned to the table, and a search of the table results in a miss.
If there is no default action assigned to the table, then there need
not be any counter updated when a search of the table results in a
miss.
</p>
<p class="p indent" data-line="896"><span data-line="896"></span>By <span data-line="896"></span>&#8220;a default action is assigned to a table&#8221;<span data-line="896"></span>, we mean that either the
table has a <span data-line="897"></span><code class="code code1 language-p4 lang-p4 p4 colorized">default_action</code><span data-line="897"></span> table property with an action assigned to
it in the P4 program, or the control plane has made an explicit call
to assign the table a default action.  If neither of these is true,
then there is no default action assigned to the table.
</p>
<p class="p indent" data-line="902"><span data-line="902"></span>TBD: Verify that the method of reading this default action counter
state is documented for the control plane API.  I believe that Antonin
Bas said that it can be accessed using the same API call used to read
a <span data-line="905"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="905"></span> value associated with a table entry, except that the
key in the API call should be empty.
</p>
<p class="p indent" data-line="908"><span data-line="908"></span>TBD: Should a single table be restricted to have at most one
DirectCounter associated with it, or should it be allowed to have more
than one?
</p><h4 id="sec-example-program-using-counters" class="h3" data-line="913" data-heading-depth="3" style="display:block"><span data-line="913"></span><span class="heading-before"><span class="heading-label">4.6.4</span>.&#8194;</span><span data-line="913"></span>Example program using counters</h4>
<p class="p noindent" data-line="915"><span data-line="915"></span>The following partial P4 program demonstrates the instantiation and
updating of <span data-line="916"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Counter</code><span data-line="916"></span> and <span data-line="916"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="916"></span> externs.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="918" data-line-first="919;examples/psa-example-counters.p4:62" style="display:block"><code data-line="919;examples/psa-example-counters.p4:62"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">48</span>&gt; ByteCounter_t;
<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt; PacketCounter_t;
<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">80</span>&gt; PacketByteCounter_t;

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">const</span> PortId_t NUM_PORTS = <span class="constant" style="color:purple">512</span>;

<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> headers {
    ethernet_t       ethernet;
    ipv4_t           ipv4;
}

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> ingress(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> headers hdr,
                <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> metadata user_meta,
                PacketReplicationEngine pre,
                <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span>    psa_ingress_input_metadata_t  istd,
                <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_ingress_output_metadata_t ostd)
{
    Counter&lt;ByteCounter_t, PortId_t&gt;((<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt;) NUM_PORTS, CounterType_t.BYTES)
        port_bytes_in;
    DirectCounter&lt;PacketByteCounter_t&gt;(CounterType_t.PACKETS_AND_BYTES)
        per_prefix_pkt_byte_count;

    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">action</span> next_hop(PortId_t oport) {
        per_prefix_pkt_byte_count.count();
        send_to_port(ostd, oport);
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">action</span> default_route_drop() {
        per_prefix_pkt_byte_count.count();
        ingress_drop(ostd);
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">table</span> ipv4_da_lpm {
        key = { hdr.ipv4.dstAddr: lpm; }
        actions = {
            next_hop;
            default_route_drop;
        }
        default_action = default_route_drop;
        psa_direct_counters = {
            <span style="color:darkgreen">// table ipv4_da_lpm owns this DirectCounter instance</span>
            per_prefix_pkt_byte_count
        };
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">apply</span> {
        port_bytes_in.count(istd.ingress_port);
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (hdr.ipv4.isValid()) {
            ipv4_da_lpm.<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">apply</span>();
        }
    }
}

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> egress(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> headers hdr,
               <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> metadata user_meta,
               BufferingQueueingEngine bqe,
               <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span>    psa_egress_input_metadata_t  istd,
               <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_egress_output_metadata_t ostd)
{
    Counter&lt;ByteCounter_t, PortId_t&gt;((<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt;) NUM_PORTS, CounterType_t.BYTES)
        port_bytes_out;
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">apply</span> {
        <span style="color:darkgreen">// By doing these stats updates on egress, then because</span>
        <span style="color:darkgreen">// multicast replication happens before egress processing,</span>
        <span style="color:darkgreen">// this update will occur once for each copy made, which in</span>
        <span style="color:darkgreen">// this example is intentional.</span>
        port_bytes_out.count(istd.egress_port);
    }
}</code></pre><h3 id="sec-meters" class="h2" data-line="924" data-heading-depth="2" style="display:block"><span data-line="924"></span><span class="heading-before"><span class="heading-label">4.7</span>.&#8194;</span><span data-line="924"></span>Meters</h3>
<p class="p noindent" data-line="926"><span data-line="926"></span>Meters (RFC 2698) are a more complex mechanism for keeping statistics
about packets, most often used for dropping
or <span data-line="928"></span>&#8220;marking&#8221;<span data-line="928"></span> packets that exceed an average packet or bit rate.  To
mark a packet means to change one or more of its quality of service
values in packet headers such as the 802.1Q PCP (priority code point)
or DSCP (differentiated service code point) bits within the IPv4 or
IPv6 type of service byte.  The meters specified in the PSA are
3-color meters.
</p>
<p class="p indent" data-line="935"><span data-line="935"></span>PSA meters do not require any particular drop or marking actions, nor
do they automatically implement those behaviors for you.  Meters keep
enough state, and update their state during <span data-line="937"></span><code class="code code1 language-p4 lang-p4 p4 colorized">execute()</code><span data-line="937"></span> method calls,
in such a way that they return a <span data-line="938"></span><code class="code code1 language-p4 lang-p4 p4 colorized">GREEN</code><span data-line="938"></span> (also known as conform),
<span data-line="939"></span><code class="code code1 language-p4 lang-p4 p4 colorized">YELLOW</code><span data-line="939"></span> (exceed), or <span data-line="939"></span><code class="code code1 language-p4 lang-p4 p4 colorized">RED</code><span data-line="939"></span> (violate) result.  See RFC 2698 for details on the
conditions under which one of these three results is returned.  The P4
program is responsible for examining that returned result, and making
changes to packet forwarding behavior as a result.
</p>
<p class="p indent" data-line="944"><span data-line="944"></span>RFC 2698 describes <span data-line="944"></span>&#8220;color aware&#8221;<span data-line="944"></span> and <span data-line="944"></span>&#8220;color blind&#8221;<span data-line="944"></span> variations of
meters.  The <span data-line="945"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Meter</code><span data-line="945"></span> and <span data-line="945"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectMeter</code><span data-line="945"></span> externs implement both.  The
only difference is in which <span data-line="946"></span><code class="code code1 language-p4 lang-p4 p4 colorized">execute</code><span data-line="946"></span> method you use when updating
them.  See the comments on the <span data-line="947"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span></code><span data-line="947"></span> definitions below.
</p>
<p class="p indent" data-line="949"><span data-line="949"></span>Similar to counters, there are two flavors of meters: indexed and
direct.  (Indexed) meters are addressed by index, while direct meters
always update a meter state corresponding to the matched table entry
or action, and from the control plane API are addressed using
P4Runtime table entry as key.
</p>
<p class="p indent" data-line="955"><span data-line="955"></span>There are many other similarities between counters and meters,
including:
</p>
<ul class="ul list-dash compact" data-line="958">
<li class="li ul-li list-dash-li compact-li" data-line="958"><span data-line="958"></span>The number of independently updatable meter values.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="959"><span data-line="959"></span>Where meter updates are allowed in a P4 program.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="960"><span data-line="960"></span>For <span data-line="960"></span><code class="code code1 language-p4 lang-p4 p4 colorized">BYTES</code><span data-line="960"></span> type meters, the packet length used in the update is
determined by the PSA implementation, and can vary from one PSA
implementation to another.
</li></ul>

<p class="p noindent" data-line="964"><span data-line="964"></span>Further similarities between direct counters and direct meters
include:
</p>
<ul class="ul list-dash compact" data-line="967">
<li class="li ul-li list-dash-li compact-li" data-line="967"><span data-line="967"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectMeter</code><span data-line="967"></span> <span data-line="967"></span><code class="code code1 language-p4 lang-p4 p4 colorized">execute</code><span data-line="967"></span> method calls must be performed within
actions invoked by the table that owns the <span data-line="968"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectMeter</code><span data-line="968"></span> instance.
It is optional for such an action to call the <span data-line="969"></span><code class="code code1 language-p4 lang-p4 p4 colorized">execute</code><span data-line="969"></span> method.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="970"><span data-line="970"></span>There must be a meter state associated with a <span data-line="970"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectMeter</code><span data-line="970"></span>
instance<span data-line="971"></span>&#39;<span data-line="971"></span>s owner table, that can be updated when the table result is
a miss.  As for a <span data-line="972"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectCounter</code><span data-line="972"></span>, this state only needs to exist if
a default action is assigned to the table.
</li></ul>

<p class="p noindent" data-line="975"><span data-line="975"></span>The table attribute to specify that a table owns a <span data-line="975"></span><code class="code code1 language-p4 lang-p4 p4 colorized">DirectMeter</code><span data-line="975"></span>
instance is <span data-line="976"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_direct_meters</code><span data-line="976"></span>.  The value of this table attribute is
a list of meter instances.
</p>
<p class="p indent" data-line="979"><span data-line="979"></span>As for counters, if you call the <span data-line="979"></span><code class="code code1 language-p4 lang-p4 p4 colorized">execute(idx)</code><span data-line="979"></span> method on an indexed
meter and <span data-line="980"></span><code class="code code1 language-p4 lang-p4 p4 colorized">idx</code><span data-line="980"></span> is at least the number of meter states, so <span data-line="980"></span><code class="code code1 language-p4 lang-p4 p4 colorized">idx</code><span data-line="980"></span> is
out of range, no meter state is updated.  The <span data-line="981"></span><code class="code code1 language-p4 lang-p4 p4 colorized">execute</code><span data-line="981"></span> call still
returns a value of type <span data-line="982"></span><code class="code code1 language-p4 lang-p4 p4 colorized">MeterColor_t</code><span data-line="982"></span>, but the value is undefined<span data-line="982"></span> <span data-line="982"></span>&#8211;<span data-line="982"></span>
programs that wish to have predictable behavior across implementations
must not use the undefined value in a way that affects the output
packet or other side effects.  The example code below shows one way to
achieve predictable behavior.  Note that this undefined behavior
cannot occur if the value of <span data-line="987"></span><code class="code code1 language-p4 lang-p4 p4 colorized">n_meters</code><span data-line="987"></span> of an indexed meter is <span data-line="987"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADUAAAAjCAYAAAA0aUL2AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACy0lEQVRYw9VY7XGbQBB9y6QAxiWgDpBTgUkHuITIHSiTEnAH2CVQguwOjDqAdBCpg82f1cxqzcEelmJ8MzeSjne626+3u4CZcekJoAbAoTmA347hAWQDe8oA9oBrCCWHZgB26rBG1tIRfKXwOwB5CK/2NIJvARTMjKsJJYdu1CVLB75Q+Mp5RgWg1WvfcN3Rq++ZA/83Bk9EqbjhWq8nVxZKX3LlwD+r76kDXwGomfn4P4XSlrqZ0Hop+KPHUkSUSww9vnt4zZgSnz/FSDuCSQF06nOQJc2eFkA+9CwZ0EBBRA0RHYiIZR5krfyAtTKnG/WOWNoA6Jl5Pwgw2jpRcC3MVchne5YHhDqdlmrHNC+03QVyXDZm1eCZCtzJBVIHPbsoWvY1ak8aELoIJOIi8H+bsTMTMWcjhruzTKIs+gRAB2UjwTqb1pUbvajl4wg+F+s9TR2ai1Zyh9ZTY612bgIOuZFJwFvzrPPcMwHwINq5lWQWHGJFraWciLKZCXUwxxjLrpSVtgBeguRgRmdIII3Q/DttBojgrPSx5DDiDTsvOVhL3ZgsXkwo4c38Xs2IqWcA9yPeMISvQvFuRzJwyf6SJYW9pJDD24Qbne5wQ0SFlxxgtNGK61WOwLd9jGfPQbm3x8V1y+Iih7MqnZl7W+VOjO/m985J67m494PDjfRzNznMrv0MsXSRCbiN6JEYwGFOvRlVpZ/8Wy3dR9Z/P534LhI/31KmBmwiW/syAp9OlUKj+yMOKm3+WOokubCnbf4jGtwz8xoLHt6YehWBegB3WPhIHFaqhY73ANberP6pYyKOtl8hhtxEoYih/koCBYVSPU3loOp88ULJRb01XT3VenzGTAaouwXwyMy/HCF5e+mq/uJEIeVJFZH1B9/4LCb5EtFOtdmeduWHlD60SEuZ11gxs1si+yXyQqOcqZN+qRXF7w/s3y9RqH9Od68MIChgRQAAAABJRU5ErkJggg==" alt="$2^W$" class="math-inline math-render-png math" style="height:0.9106em"><span data-line="987"></span>,
and the type <span data-line="988"></span><code class="code code1 language-p4 lang-p4 p4 colorized">S</code><span data-line="988"></span> used to construct the meter is <span data-line="988"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;W&gt;</code><span data-line="988"></span>, since the
index value could never be out of range.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="991" data-line-first="992" style="display:block"><code data-line="992"><span style="color:navy">#</span><span style="color:navy">define</span><span style="color:maroon"> METER1_SIZE 100</span>
Meter&lt;<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">7</span>&gt;&gt;(METER<span class="constant" style="color:purple">1</span>_SIZE, MeterType_t.BYTES) meter1;
<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">7</span>&gt; idx;
MeterColor_t color1;

<span style="color:darkgreen">// ... later ...</span>

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (idx &lt; METER<span class="constant" style="color:purple">1</span>_SIZE) {
    color1 = meter1.execute(idx, MeterColor_t.GREEN);
} <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">else</span> {
    <span style="color:darkgreen">// If idx is out of range, use a default value for color1.  One</span>
    <span style="color:darkgreen">// may also choose to store an error flag in some metadata field.</span>
    color1 = MeterColor_t.RED;
}</code></pre>
<p class="p noindent para-continued" data-line="1008"><span data-line="1008"></span>Any implementation will have a finite range that can be specified for
the Peak Burst Size and Committed Burst Size.  An implementation
should document the maximum burst sizes they support, and if the
implementation internally truncates the values that the control plane
requests to something more coarse than any number of bytes, that
should also be documented.  It is recommended that the maximum burst
sizes be allowed as large as the number of bytes that can be
transmitted across the implementation<span data-line="1015"></span>&#39;<span data-line="1015"></span>s maximum speed port in 100
milliseconds.
</p>
<p class="p indent" data-line="1018"><span data-line="1018"></span>Implementations will also have finite ranges and precisions that they
support for the Peak Information Rate and Committed Information Rate.
An implementation should document the maximum rate it supports, as
well as the precision it supports for implementing requested rates.
It is recommended that the maximum rate supported be at least the rate
of the implementation<span data-line="1023"></span>&#39;<span data-line="1023"></span>s fastest port, and that the actual implemented
rate should always be within plus or minus 0.1% of the requested rate.
</p><h4 id="sec-meter-types" class="h3" data-line="1026" data-heading-depth="3" style="display:block"><span data-line="1026"></span><span class="heading-before"><span class="heading-label">4.7.1</span>.&#8194;</span><span data-line="1026"></span>Meter types</h4>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1028" data-line-first="1029;psa.p4:395" style="display:block"><code data-line="1029;psa.p4:395"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">enum</span> MeterType_t {
    PACKETS,
    BYTES
}</code></pre><h4 id="sec-meter-colors" class="h3" data-line="1032" data-heading-depth="3" style="display:block"><span data-line="1032"></span><span class="heading-before"><span class="heading-label">4.7.2</span>.&#8194;</span><span data-line="1032"></span>Meter colors</h4>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1034" data-line-first="1035;psa.p4:399" style="display:block"><code data-line="1035;psa.p4:399"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">enum</span> MeterColor_t { RED, GREEN, YELLOW };</code></pre><h4 id="sec-meter" class="h3" data-line="1038" data-heading-depth="3" style="display:block"><span data-line="1038"></span><span class="heading-before"><span class="heading-label">4.7.3</span>.&#8194;</span><span data-line="1038"></span>Meter</h4>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1040" data-line-first="1041;psa.p4:426" style="display:block"><code data-line="1041;psa.p4:426"><span style="color:darkgreen">// Indexed meter with n_meters independent meter states.</span>

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> Meter&lt;S&gt; {
  Meter(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt; n_meters, MeterType_t type);

  <span style="color:darkgreen">// Use this method call to perform a color aware meter update (see</span>
  <span style="color:darkgreen">// RFC 2698). The color of the packet before the method call was</span>
  <span style="color:darkgreen">// made is specified by the color parameter.</span>
  MeterColor_t execute(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> S index, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> MeterColor_t color);

  <span style="color:darkgreen">// Use this method call to perform a color blind meter update (see</span>
  <span style="color:darkgreen">// RFC 2698).  It may be implemented via a call to execute(index,</span>
  <span style="color:darkgreen">// MeterColor_t.GREEN), which has the same behavior.</span>
  MeterColor_t execute(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> S index);

  <span style="color:darkgreen">/*</span>
<span style="color:darkgreen">  @ControlPlaneAPI</span>
<span style="color:darkgreen">  {</span>
<span style="color:darkgreen">    reset(in MeterColor_t color);</span>
<span style="color:darkgreen">    setParams(in S index, in MeterConfig config);</span>
<span style="color:darkgreen">    getParams(in S index, out MeterConfig config);</span>
<span style="color:darkgreen">  }</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">*/</span>
}</code></pre><h4 id="sec-direct-meter" class="h3" data-line="1044" data-heading-depth="3" style="display:block"><span data-line="1044"></span><span class="heading-before"><span class="heading-label">4.7.4</span>.&#8194;</span><span data-line="1044"></span>Direct Meter</h4>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1046" data-line-first="1047;psa.p4:444" style="display:block"><code data-line="1047;psa.p4:444"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> DirectMeter {
  DirectMeter(MeterType_t type);
  <span style="color:darkgreen">// See the corresponding methods for extern Meter.</span>
  MeterColor_t execute(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> MeterColor_t color);
  MeterColor_t execute();

  <span style="color:darkgreen">/*</span>
<span style="color:darkgreen">  @ControlPlaneAPI</span>
<span style="color:darkgreen">  {</span>
<span style="color:darkgreen">    reset(in TableEntry entry, in MeterColor_t color);</span>
<span style="color:darkgreen">    void setConfig(in TableEntry entry, in MeterConfig config);</span>
<span style="color:darkgreen">    void getConfig(in TableEntry entry, out MeterConfig config);</span>
<span style="color:darkgreen">  }</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">*/</span>
}</code></pre><h3 id="sec-registers" class="h2" data-line="1050" data-heading-depth="2" style="display:block"><span data-line="1050"></span><span class="heading-before"><span class="heading-label">4.8</span>.&#8194;</span><span data-line="1050"></span>Registers</h3>
<p class="p noindent" data-line="1052"><span data-line="1052"></span>Registers are stateful memories whose values can be read and written
during packet forwarding under the control of the P4 program.  They
are similar to counters and meters in that their state can be modified
as a result of processing packets, but they are far more general in
the behavior they can implement.
</p>
<p class="p indent" data-line="1058"><span data-line="1058"></span>Although you may not use register contents directly in table match
keys, you may use the <span data-line="1059"></span><code class="code code1 language-p4 lang-p4 p4 colorized">read()</code><span data-line="1059"></span> method call on the right-hand side of
an assignment statement, which retrieves the current value of the
register.  You may copy the register value into metadata, and it is
then available for matching in subsequent tables.
</p>
<p class="p indent" data-line="1064"><span data-line="1064"></span>A simple usage example might be to verify that a <span data-line="1064"></span>&#8220;first packet&#8221;<span data-line="1064"></span> was
seen for a particular type of flow.  A register cell would be
allocated to the flow, initialized to <span data-line="1066"></span>&#8220;clear&#8221;<span data-line="1066"></span>.  When the protocol
signaled a <span data-line="1067"></span>&#8220;first packet&#8221;<span data-line="1067"></span>, the table would match on this value and
update the flow<span data-line="1068"></span>&#39;<span data-line="1068"></span>s cell to <span data-line="1068"></span>&#8220;marked&#8221;<span data-line="1068"></span>.  Subsequent packets in the flow
could would be mapped to the same cell; the current cell value would
be stored in metadata for the packet and a subsequent table could
check that the flow was marked as active.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1073" data-line-first="1074;psa.p4:461" style="display:block"><code data-line="1074;psa.p4:461"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> Register&lt;T, S&gt; {
  Register(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt; size);
  T    read  (<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> S index);
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> write (<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> S index, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> T value);

  <span style="color:darkgreen">/*</span>
<span style="color:darkgreen">  @ControlPlaneAPI</span>
<span style="color:darkgreen">  {</span>
<span style="color:darkgreen">    T    read&lt;T&gt;      (in S index);</span>
<span style="color:darkgreen">    void set          (in S index, in T seed);</span>
<span style="color:darkgreen">    void reset        (in S index);</span>
<span style="color:darkgreen">  }</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">*/</span>
}</code></pre>
<p class="p noindent para-continued" data-line="1077"><span data-line="1077"></span>Another example using registers is given below.  It implements a
packet and byte counter, where the byte counter can be updated by a
packet length specified in the P4 program, rather than one chosen by
the PSA implementation.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1082" data-line-first="1083;examples/psa-example-register2.p4:82" style="display:block"><code data-line="1083;examples/psa-example-register2.p4:82"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">const</span> PortId_t NUM_PORTS = <span class="constant" style="color:purple">512</span>;

<span style="color:darkgreen">// It would be more convenient to use a struct type to represent the</span>
<span style="color:darkgreen">// state of a combined packet and byte count, and many other compound</span>
<span style="color:darkgreen">// values one might wish to store in a Register instance.  However,</span>
<span style="color:darkgreen">// the latest p4test as of 2017-Aug-13 does not allow a struct type to</span>
<span style="color:darkgreen">// be returned from a method call like Register.read().</span>

<span style="color:navy">#</span><span style="color:navy">define</span><span style="color:maroon"> PACKET_COUNT_WIDTH 32</span>
<span style="color:navy">#</span><span style="color:navy">define</span><span style="color:maroon"> BYTE_COUNT_WIDTH 48</span>
<span style="color:darkgreen">//#define PACKET_BYTE_COUNT_WIDTH (PACKET_COUNT_WIDTH + BYTE_COUNT_WIDTH)</span>
<span style="color:navy">#</span><span style="color:navy">define</span><span style="color:maroon"> PACKET_BYTE_COUNT_WIDTH 80</span>

<span style="color:navy">#</span><span style="color:navy">define</span><span style="color:maroon"> PACKET_COUNT_RANGE (PACKET_BYTE_COUNT_WIDTH-1):BYTE_COUNT_WIDTH</span>
<span style="color:navy">#</span><span style="color:navy">define</span><span style="color:maroon"> BYTE_COUNT_RANGE (BYTE_COUNT_WIDTH-1):0</span>

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">typedef</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;PACKET_BYTE_COUNT_WIDTH&gt; PacketByteCountState_t;

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">action</span> update_pkt_ip_byte_count (<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> PacketByteCountState_t s,
                                 <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">16</span>&gt; ip_length_bytes)
{
    s[PACKET_COUNT_RANGE] = s[PACKET_COUNT_RANGE] + <span class="constant" style="color:purple">1</span>;
    s[BYTE_COUNT_RANGE] = (s[BYTE_COUNT_RANGE] +
                           (<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;BYTE_COUNT_WIDTH&gt;) ip_length_bytes);
}

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> ingress(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> headers hdr,
                <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> metadata user_meta,
                PacketReplicationEngine pre,
                <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span>    psa_ingress_input_metadata_t  istd,
                <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_ingress_output_metadata_t ostd)
{
    Register&lt;PacketByteCountState_t, PortId_t&gt;((<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt;) NUM_PORTS)
        port_pkt_ip_bytes_in;

    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">apply</span> {
        ostd.egress_port = <span class="constant" style="color:purple">0</span>;
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">if</span> (hdr.ipv4.isValid()) {
<span style="color:navy">            @</span><span style="color:navy">atomic</span><span style="color:maroon"> {</span>
                PacketByteCountState_t tmp;
                tmp = port_pkt_ip_bytes_in.read(istd.ingress_port);
                update_pkt_ip_byte_count(tmp, hdr.ipv4.totalLen);
                port_pkt_ip_bytes_in.write(istd.ingress_port, tmp);
            }
        }
    }
}</code></pre>
<p class="p noindent para-continued" data-line="1088"><span data-line="1088"></span>Note the use of the <span data-line="1088"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:navy">@</span><span style="color:navy">atomic</span></code><span data-line="1088"></span> annotation in the block enclosing the
<span data-line="1089"></span><code class="code code1 language-p4 lang-p4 p4 colorized">read()</code><span data-line="1089"></span> and <span data-line="1089"></span><code class="code code1 language-p4 lang-p4 p4 colorized">write()</code><span data-line="1089"></span> method calls on the <span data-line="1089"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Register</code><span data-line="1089"></span> instance.  It is
expected to be common that register accesses will need the <span data-line="1090"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:navy">@</span><span style="color:navy">atomic</span></code><span data-line="1090"></span>
annotation around portions of your program in order to behave as you
desire.  As stated in the P4<span data-line="1092"></span>_<span data-line="1092"></span>16 specification, without the <span data-line="1092"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:navy">@</span><span style="color:navy">atomic</span></code><span data-line="1092"></span>
annotation in this example, an implementation is allowed to process
two packets <span data-line="1094"></span><code class="code code1 language-p4 lang-p4 p4 colorized">P<span class="constant" style="color:purple">1</span></code><span data-line="1094"></span> and <span data-line="1094"></span><code class="code code1 language-p4 lang-p4 p4 colorized">P<span class="constant" style="color:purple">2</span></code><span data-line="1094"></span> in parallel, and perform the register access
operations in this order:
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1097" data-line-first="1098" style="display:block"><code data-line="1098">    <span style="color:darkgreen">// Possible order of operations for the example program if the</span>
    <span style="color:darkgreen">// @atomic annotation is _not_ used.</span>

    tmp = port_pkt_ip_bytes_in.read(istd.ingress_port);  <span style="color:darkgreen">// for packet P1</span>
    tmp = port_pkt_ip_bytes_in.read(istd.ingress_port);  <span style="color:darkgreen">// for packet P2</span>

    <span style="color:darkgreen">// At this time, if P1 and P2 came from the same ingress_port,</span>
    <span style="color:darkgreen">// each of their values of tmp are identical.</span>

    update_pkt_ip_byte_count(tmp, hdr.ipv4.totalLen);    <span style="color:darkgreen">// for packet P1</span>
    update_pkt_ip_byte_count(tmp, hdr.ipv4.totalLen);    <span style="color:darkgreen">// for packet P2</span>

    port_pkt_ip_bytes_in.write(istd.ingress_port, tmp);  <span style="color:darkgreen">// for packet P1</span>
    port_pkt_ip_bytes_in.write(istd.ingress_port, tmp);  <span style="color:darkgreen">// for packet P2</span>
    <span style="color:darkgreen">// The write() from packet P1 is lost.</span></code></pre>
<p class="p noindent para-continued" data-line="1115"><span data-line="1115"></span>Since different implementations may have different upper limits on the
complexity of code that they will accept within an <span data-line="1116"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:navy">@</span><span style="color:navy">atomic</span></code><span data-line="1116"></span> block, we
recommend you keep them as small as possible, subject to maintaining
your desired correct behavior.
</p>
<p class="p indent" data-line="1120"><span data-line="1120"></span>Individual counter and meter method calls need not be enclosed in
<span data-line="1121"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:navy">@</span><span style="color:navy">atomic</span></code><span data-line="1121"></span> blocks to be safe<span data-line="1121"></span> <span data-line="1121"></span>&#8211;<span data-line="1121"></span> they guarantee atomic behavior of their
individual method calls, without losing any updates.
</p>
<p class="p indent" data-line="1124"><span data-line="1124"></span>As for indexed counters and meters, access to an index of a register
that is at least the size of the register is out of bounds.  An out of
bounds write has no effect on the state of the system.  An out of
bounds read returns an undefined value.  See the example in Section
<span data-line="1128"></span><a href="#sec-meters" title="4.7.&#8194;Meters" class="localref" style="target-element:h2"><span class="heading-label">4.7</span></a><span data-line="1128"></span> for one way to write code to guarantee avoiding this
undefined behavior.  Out of bounds register accesses are impossible
for a register instance with type <span data-line="1130"></span><code class="code code1 language-p4 lang-p4 p4 colorized">S</code><span data-line="1130"></span> declared as <span data-line="1130"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;W&gt;</code><span data-line="1130"></span> and size
<span data-line="1131"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADUAAAAjCAYAAAA0aUL2AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACy0lEQVRYw9VY7XGbQBB9y6QAxiWgDpBTgUkHuITIHSiTEnAH2CVQguwOjDqAdBCpg82f1cxqzcEelmJ8MzeSjne626+3u4CZcekJoAbAoTmA347hAWQDe8oA9oBrCCWHZgB26rBG1tIRfKXwOwB5CK/2NIJvARTMjKsJJYdu1CVLB75Q+Mp5RgWg1WvfcN3Rq++ZA/83Bk9EqbjhWq8nVxZKX3LlwD+r76kDXwGomfn4P4XSlrqZ0Hop+KPHUkSUSww9vnt4zZgSnz/FSDuCSQF06nOQJc2eFkA+9CwZ0EBBRA0RHYiIZR5krfyAtTKnG/WOWNoA6Jl5Pwgw2jpRcC3MVchne5YHhDqdlmrHNC+03QVyXDZm1eCZCtzJBVIHPbsoWvY1ak8aELoIJOIi8H+bsTMTMWcjhruzTKIs+gRAB2UjwTqb1pUbvajl4wg+F+s9TR2ai1Zyh9ZTY612bgIOuZFJwFvzrPPcMwHwINq5lWQWHGJFraWciLKZCXUwxxjLrpSVtgBeguRgRmdIII3Q/DttBojgrPSx5DDiDTsvOVhL3ZgsXkwo4c38Xs2IqWcA9yPeMISvQvFuRzJwyf6SJYW9pJDD24Qbne5wQ0SFlxxgtNGK61WOwLd9jGfPQbm3x8V1y+Iih7MqnZl7W+VOjO/m985J67m494PDjfRzNznMrv0MsXSRCbiN6JEYwGFOvRlVpZ/8Wy3dR9Z/P534LhI/31KmBmwiW/syAp9OlUKj+yMOKm3+WOokubCnbf4jGtwz8xoLHt6YehWBegB3WPhIHFaqhY73ANberP6pYyKOtl8hhtxEoYih/koCBYVSPU3loOp88ULJRb01XT3VenzGTAaouwXwyMy/HCF5e+mq/uJEIeVJFZH1B9/4LCb5EtFOtdmeduWHlD60SEuZ11gxs1si+yXyQqOcqZN+qRXF7w/s3y9RqH9Od68MIChgRQAAAABJRU5ErkJggg==" alt="$2^W$" class="math-inline math-render-png math" style="height:0.9106em"><span data-line="1131"></span> entries.
</p><h3 id="sec-random" class="h2" data-line="1134" data-heading-depth="2" style="display:block"><span data-line="1134"></span><span class="heading-before"><span class="heading-label">4.9</span>.&#8194;</span><span data-line="1134"></span>Random</h3>
<p class="p noindent" data-line="1136"><span data-line="1136"></span>The <span data-line="1136"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Random</code><span data-line="1136"></span> extern provides generation of pseudo-random numbers in a
specified range with a uniform distribution.  If one wishes to
generate numbers with a non-uniform distribution, you may do so by
first generating a uniformly distributed random value, and then using
appropriate table lookups and/or arithmetic on the resulting value to
achieve the desired distribution.
</p>
<p class="p indent" data-line="1143"><span data-line="1143"></span>An implementation is not required to produce cryptographically strong
pseudo-random number generation.  For example, a particularly
inexpensive implementation might use a linear feedback shift register
to generate values.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1148" data-line-first="1149;psa.p4:476" style="display:block"><code data-line="1149;psa.p4:476"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> Random&lt;T&gt; {
  Random(T min, T max);
  T read();

  <span style="color:darkgreen">/*</span>
<span style="color:darkgreen">  @ControlPlaneAPI</span>
<span style="color:darkgreen">  {</span>
<span style="color:darkgreen">    void reset();</span>
<span style="color:darkgreen">    void setSeed(in T seed);</span>
<span style="color:darkgreen">  }</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">*/</span>
}</code></pre><h3 id="sec-action-profile" class="h2" data-line="1152" data-heading-depth="2" style="display:block"><span data-line="1152"></span><span class="heading-before"><span class="heading-label">4.10</span>.&#8194;</span><span data-line="1152"></span>Action Profile</h3>
<p class="p noindent" data-line="1154"><span data-line="1154"></span>Action profiles are used as table implementation attributes.
</p>
<p class="p indent" data-line="1156"><span data-line="1156"></span>Action profiles implement a mechanism to populate table entries
with actions and action data. The only data plane operation
required is to instantiate this extern. When the control plane adds
entries (members) into the extern, they are essentially populating
the corresponding table entries.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1162" data-line-first="1163;psa.p4:492" style="display:block"><code data-line="1163;psa.p4:492"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> ActionProfile {
  <span style="color:darkgreen">/// Construct an action profile of &#39;size&#39; entries</span>
  ActionProfile(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt; size);

  <span style="color:darkgreen">/*</span>
<span style="color:darkgreen">  @ControlPlaneAPI</span>
<span style="color:darkgreen">  {</span>
<span style="color:darkgreen">     entry_handle add_member    (action_ref, action_data);</span>
<span style="color:darkgreen">     void         delete_member (entry_handle);</span>
<span style="color:darkgreen">     entry_handle modify_member (entry_handle, action_ref, action_data);</span>
<span style="color:darkgreen">  }</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">*/</span>
}</code></pre><h3 id="sec-action-selector" class="h2" data-line="1166" data-heading-depth="2" style="display:block"><span data-line="1166"></span><span class="heading-before"><span class="heading-label">4.11</span>.&#8194;</span><span data-line="1166"></span>Action Selector</h3>
<p class="p noindent" data-line="1168"><span data-line="1168"></span>Action selectors are used as table implementation attributes.
</p>
<p class="p indent" data-line="1170"><span data-line="1170"></span>Action selectors implement another mechanism to populate table
entries with actions and action data. They are similar to action
profiles, with additional support to define groups of
entries. Action selectors require a hash algorithm to select
members in a group. The only data plane operation required is to
instantiate this extern. When the control plane adds entries
(members) into the extern, they are essentially populating the
corresponding table entries.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1179" data-line-first="1180;psa.p4:515" style="display:block"><code data-line="1180;psa.p4:515"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> ActionSelector {
  <span style="color:darkgreen">/// Construct an action selector of &#39;size&#39; entries</span>
  <span style="color:darkgreen">/// @param algo hash algorithm to select a member in a group</span>
  <span style="color:darkgreen">/// @param size number of entries in the action selector</span>
  <span style="color:darkgreen">/// @param outputWidth size of the key</span>
  ActionSelector(HashAlgorithm_t algo, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt; size, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">32</span>&gt; outputWidth);

  <span style="color:darkgreen">/*</span>
<span style="color:darkgreen">  @ControlPlaneAPI</span>
<span style="color:darkgreen">  {</span>
<span style="color:darkgreen">     entry_handle add_member        (action_ref, action_data);</span>
<span style="color:darkgreen">     void         delete_member     (entry_handle);</span>
<span style="color:darkgreen">     entry_handle modify_member     (entry_handle, action_ref, action_data);</span>
<span style="color:darkgreen">     group_handle create_group      ();</span>
<span style="color:darkgreen">     void         delete_group      (group_handle);</span>
<span style="color:darkgreen">     void         add_to_group      (group_handle, entry_handle);</span>
<span style="color:darkgreen">     void         delete_from_group (group_handle, entry_handle);</span>
<span style="color:darkgreen">  }</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">*/</span>
}</code></pre><h3 id="sec-packet-generation" class="h2" data-line="1183" data-heading-depth="2" style="display:block"><span data-line="1183"></span><span class="heading-before"><span class="heading-label">4.12</span>.&#8194;</span><span data-line="1183"></span>Packet Generation</h3>
<p class="p noindent" data-line="1185"><span data-line="1185"></span>\<span data-line="1185"></span>TODO: is generating a new packet and sending it to the stream or is
it adding a header to the current packet and sending it to the
stream (copying or redirecting).
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1189" data-line-first="1190;psa.p4:531" style="display:block"><code data-line="1190;psa.p4:531"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> Digest&lt;T&gt; {
  Digest(PortId_t receiver); <span style="color:darkgreen">/// define a digest stream to receiver</span>
  <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">void</span> emit(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> T data);      <span style="color:darkgreen">/// emit data into the stream</span>

  <span style="color:darkgreen">/*</span>
<span style="color:darkgreen">  @ControlPlaneAPI</span>
<span style="color:darkgreen">  {</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> TBD</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> If the type T is a named struct, the name should be used</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> to generate the control-plane API.</span>
<span style="color:darkgreen">  }</span>
<span style="color:darkgreen">  </span><span style="color:darkgreen">*/</span>
}</code></pre><h3 id="sec-parser-value-sets" class="h2" data-line="1194" data-heading-depth="2" style="display:block"><span data-line="1194"></span><span class="heading-before"><span class="heading-label">4.13</span>.&#8194;</span><span data-line="1194"></span>Parser Value Sets</h3>
<p class="p noindent" data-line="1196"><span data-line="1196"></span>A parser value set is a named set of values that may be used during
packet header parsing time to make decisions.  You may use control
plane API calls to add values to a set, and remove values from a set,
at run time, much like P4 tables.  Unlike tables, they may not have
actions associated with them.  They may only be used to determine
whether a particular value is in the set, returning a Boolean value.
That Boolean value can then be used in a <span data-line="1202"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">select</span></code><span data-line="1202"></span> statement to control
parsing (see examples below).
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1205" data-line-first="1206;psa.p4:552" style="display:block"><code data-line="1206;psa.p4:552"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">extern</span> ValueSet&lt;D&gt; {
    ValueSet(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">int</span>&lt;<span class="constant" style="color:purple">32</span>&gt; size);
    <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span> is_member(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> D data);

    <span style="color:darkgreen">/*</span>
<span style="color:darkgreen">    @ControlPlaneAPI</span>
<span style="color:darkgreen">    message ValueSetEntry {</span>
<span style="color:darkgreen">        uint32 value_set_id = 1;</span>
<span style="color:darkgreen">        </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> FieldMatch allows specification of exact, lpm, ternary, and</span>
<span style="color:darkgreen">        </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> range matching on fields for tables, and these options are</span>
<span style="color:darkgreen">        </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> permitted for the ValueSet extern as well.</span>
<span style="color:darkgreen">        repeated FieldMatch match = 2;</span>
<span style="color:darkgreen">    }</span>

<span style="color:darkgreen">    </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> ValueSetEntry should be added to the &#39;message Entity&#39;</span>
<span style="color:darkgreen">    </span><span style="color:darkgreen">/</span><span style="color:darkgreen">/</span><span style="color:darkgreen"> definition, inside its &#39;oneof Entity&#39; list of possibilities.</span>
<span style="color:darkgreen">    </span><span style="color:darkgreen">*/</span>
}</code></pre>
<p class="p noindent para-continued" data-line="1209"><span data-line="1209"></span>The control plane API excerpt above is intended to be added as part of
the P4Runtime API<span data-line="1210"></span><sup id="back-fn-p4runtimeapi" ><a href="#fn-p4runtimeapi" title="1.The P4Runtime API, defined as a Google Protocol
Buffer .proto file, can be found at
https://&#8203;github.&#8203;com/&#8203;p4lang/&#8203;PI/&#8203;blob/&#8203;master/&#8203;proto/&#8203;p4/&#8203;p4runtime.&#8203;proto
&#8617;" class="footnote-ref localref" ><span class="footnote-label">1</span></a></sup><span data-line="1210"></span>.
</p>
<p class="p indent" data-line="1216"><span data-line="1216"></span>The control plane API for a <span data-line="1216"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ValueSet</code><span data-line="1216"></span> is similar to that of a table,
except only match fields may be specified, with no actions.  This
includes API calls that specify ternary or range matching, although
for <span data-line="1219"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ValueSet</code><span data-line="1219"></span>s these do not require specifying any priority values,
since the only result of a <span data-line="1220"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ValueSet</code><span data-line="1220"></span> <span data-line="1220"></span><code class="code code1 language-p4 lang-p4 p4 colorized">is_member</code><span data-line="1220"></span> call is <span data-line="1220"></span>&#8220;in the set&#8221;<span data-line="1220"></span>
or <span data-line="1221"></span>&#8220;not in the set&#8221;<span data-line="1221"></span>.
</p>
<p class="p indent" data-line="1223"><span data-line="1223"></span>If a PSA target can do so, it should implement control plane API calls
involving ternary or range matching using ternary or range matching
capabilities in the target, consuming the minimal table entries
possible.
</p>
<p class="p indent" data-line="1228"><span data-line="1228"></span>However, a PSA target is allowed to implement such control plane API
calls by <span data-line="1229"></span>&#8220;expanding&#8221;<span data-line="1229"></span> them into as many exact match entries as needed
to have the same behavior.  For example, a control plane API call
adding all values in the range 5 through 8 may be implemented as
adding the four separate exact match values 5, 6, 7, and 8.
</p>
<p class="p indent" data-line="1234"><span data-line="1234"></span>The parser definition below shows an example that uses two <span data-line="1234"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ValueSet</code><span data-line="1234"></span>
instances called <span data-line="1235"></span><code class="code code1 language-p4 lang-p4 p4 colorized">tpid_types</code><span data-line="1235"></span> and <span data-line="1235"></span><code class="code code1 language-p4 lang-p4 p4 colorized">trill_types</code><span data-line="1235"></span>.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1237" data-line-first="1238;examples/psa-example-value-sets.p4:102" style="display:block"><code data-line="1238;examples/psa-example-value-sets.p4:102"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">parser</span> IngressParserImpl(packet_in buffer,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> headers parsed_hdr,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> metadata user_meta,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> psa_ingress_parser_input_metadata_t istd,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> psa_parser_output_metadata_t ostd)
{
    ValueSet&lt;<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">16</span>&gt;&gt;(<span class="constant" style="color:purple">4</span>) tpid_types;
    ValueSet&lt;<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">16</span>&gt;&gt;(<span class="constant" style="color:purple">2</span>) trill_types;
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> start {
        buffer.extract(parsed_hdr.ethernet);
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">select</span>(parsed_hdr.ethernet.etherType) {
            <span class="constant" style="color:purple">0x0800</span>: parse_ipv4;
            <span class="constant" style="color:purple">0x86DD</span>: parse_ipv6;
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">default</span>: dispatch_tpid_value_set;
        }
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> dispatch_tpid_value_set {
        <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span> is_tpid = tpid_types.is_member(parsed_hdr.ethernet.etherType);
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">select</span>(is_tpid) {
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">true</span>: parse_vlan_tag;
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">default</span>: dispatch_trill_value_set;
        }
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> dispatch_trill_value_set {
        <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span> is_trill = trill_types.is_member(parsed_hdr.ethernet.etherType);
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">select</span>(is_trill) {
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">true</span>: parse_trill;
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">default</span>: accept;
        }
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> parse_vlan_tag {
        <span style="color:darkgreen">// extract VLAN 802.1Q header here</span>
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> accept;
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> parse_trill {
        <span style="color:darkgreen">// extract TRILL header here</span>
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> accept;
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> parse_ipv4 {
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> accept;
    }
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> parse_ipv6 {
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> accept;
    }
}</code></pre>
<p class="p noindent para-continued" data-line="1241"><span data-line="1241"></span>The second example (below) has the same parsing behavior as the
example above, but combines the two parse states
<span data-line="1243"></span><code class="code code1 language-p4 lang-p4 p4 colorized">dispatch_tpid_value_set</code><span data-line="1243"></span> and <span data-line="1243"></span><code class="code code1 language-p4 lang-p4 p4 colorized">dispatch_trill_value_set</code><span data-line="1243"></span> into one.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1245" data-line-first="1246;examples/psa-example-value-sets2.p4:82" style="display:block"><code data-line="1246;examples/psa-example-value-sets2.p4:82">    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> dispatch_tpid_value_set {
        <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span> is_tpid = tpid_types.is_member(parsed_hdr.ethernet.etherType);
        <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span> is_trill = trill_types.is_member(parsed_hdr.ethernet.etherType);
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">select</span>(is_tpid, is_trill) {
            (<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">true</span>,     _): parse_vlan_tag;
            (<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">false</span>, <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">true</span>): parse_trill;
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">default</span>: accept;
        }
    }</code></pre>
<p class="p noindent para-continued" data-line="1249"><span data-line="1249"></span>The third example (below) demonstrates one way to have a <span data-line="1249"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ValueSet</code><span data-line="1249"></span>
that matches on multiple fields, by making the type <span data-line="1250"></span><code class="code code1 language-p4 lang-p4 p4 colorized">D</code><span data-line="1250"></span> a <span data-line="1250"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span></code><span data-line="1250"></span>
containing multiple bit vectors.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1253" data-line-first="1254;examples/psa-example-value-sets3.p4:81" style="display:block"><code data-line="1254;examples/psa-example-value-sets3.p4:81"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">struct</span> CustomValueSet1_t {
    <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">16</span>&gt; etherType;
    <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;<span class="constant" style="color:purple">8</span>&gt;  partialMacAddress;
}

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">parser</span> IngressParserImpl(packet_in buffer,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> headers parsed_hdr,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> metadata user_meta,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> psa_ingress_parser_input_metadata_t istd,
                         <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> psa_parser_output_metadata_t ostd)
{
    ValueSet&lt;CustomValueSet1_t&gt;(<span class="constant" style="color:purple">2</span>) trill_types;

    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">state</span> dispatch_tpid_value_set {
        <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span> is_trill =
            trill_types.is_member({parsed_hdr.ethernet.etherType,
                                   parsed_hdr.ethernet.dstAddr[<span class="constant" style="color:purple">7</span>:<span class="constant" style="color:purple">0</span>]});
        <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">select</span>(is_trill) {
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">true</span>: parse_vlan_tag;
            <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">default</span>: accept;
        }
    }

    <span style="color:darkgreen">// ... etc.</span></code></pre>
<p class="p noindent para-continued" data-line="1257"><span data-line="1257"></span>A PSA compliant implementation is not required to support any use of a
<span data-line="1258"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ValueSet</code><span data-line="1258"></span> <span data-line="1258"></span><code class="code code1 language-p4 lang-p4 p4 colorized">is_member</code><span data-line="1258"></span> method call return value, other than directly
inside of a <span data-line="1259"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">select</span></code><span data-line="1259"></span> expression.  For example, a program fragment like
the one shown below may be rejected, and thus P4 programmers striving
for maximum portability should avoid writing such code.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1262" data-line-first="1263" style="display:block"><code data-line="1263">    <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bool</span> is_tpid = tpid_types.is_member(parsed_hdr.ethernet.etherType);

    is_tpid = is_tpid &amp;&amp; (parsed_hdr.ethernet.dstAddr[<span class="constant" style="color:purple">47</span>:<span class="constant" style="color:purple">40</span>] == <span class="constant" style="color:purple">0xfe</span>);
    <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">transition</span> <span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">select</span>(is_tpid) {
        <span style="color:darkgreen">// ...</span></code></pre><h3 id="sec-timestamps" class="h2" data-line="1271" data-heading-depth="2" style="display:block"><span data-line="1271"></span><span class="heading-before"><span class="heading-label">4.14</span>.&#8194;</span><span data-line="1271"></span>Timestamps</h3>
<p class="p noindent" data-line="1273"><span data-line="1273"></span>A PSA implementation provides an <span data-line="1273"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ingress_timestamp</code><span data-line="1273"></span> value for every
packet in the ingress control block, as a field in the struct with
type <span data-line="1275"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_ingress_input_metadata_t</code><span data-line="1275"></span>.  This timestamp should be close
to the time that the first bit of the packet arrived to the device, or
alternately, to the time that the device began parsing the packet.
This timestamp is <span data-line="1278"></span><em class="em-low1">not</em><span data-line="1278"></span> automatically included with the packet in the
egress control block.  A P4 program wishing to use the value of
<span data-line="1280"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ingress_timestamp</code><span data-line="1280"></span> in egress code must copy it to a user-defined
metadata field that reaches egress.
</p>
<p class="p indent" data-line="1283"><span data-line="1283"></span>A PSA implementation also provides an <span data-line="1283"></span><code class="code code1 language-p4 lang-p4 p4 colorized">egress_timestamp</code><span data-line="1283"></span> value for
every packet in the egress control block, as a field of the struct
with type <span data-line="1285"></span><code class="code code1 language-p4 lang-p4 p4 colorized">psa_egress_input_metadata_t</code><span data-line="1285"></span>.
</p>
<p class="p indent" data-line="1287"><span data-line="1287"></span>One expected use case for timestamps is to store them in tables or
<span data-line="1288"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Register</code><span data-line="1288"></span> instances to implement checking for timeout events for
protocols, where precision on the order of milliseconds is sufficient
for most protocols.
</p>
<p class="p indent" data-line="1292"><span data-line="1292"></span>Another expected use case is INT (Inband Network Telemetry<span data-line="1292"></span><sup id="back-fn-int" ><a href="#fn-int" title="2.http://&#8203;p4.&#8203;org/&#8203;p4/&#8203;inband-&#8203;network-&#8203;telemetry
&#8617;" class="footnote-ref localref" ><span class="footnote-label">2</span></a></sup><span data-line="1292"></span>),
where precision on the order of microseconds or smaller is necessary
to measure queueing latencies that differ by those amounts.  It takes
only 0.74 microseconds to transmit a 9 Kbyte Ethernet jumbo frame on a
100 gigabit per second link.
</p>
<p class="p indent" data-line="1300"><span data-line="1300"></span>For these applications, it is recommended that an implementation<span data-line="1300"></span>&#39;<span data-line="1300"></span>s
timestamp increments at least once every microsecond.  Incrementing
once per clock cycle in an ASIC or FPGA implementation would be a
reasonable choice.  The timestamp should increment at a constant rate
over time.  For example, it should not be a simple count of clock
cycles in a device that implements dynamic frequency
scaling<span data-line="1306"></span><sup id="back-fn-dynamicfrequencyscaling" ><a href="#fn-dynamicfrequencyscaling" title="3.https://&#8203;en.&#8203;wikipedia.&#8203;org/&#8203;wiki/&#8203;Dynamic_&#8203;frequency_&#8203;scaling
&#8617;" class="footnote-ref localref" ><span class="footnote-label">3</span></a></sup><span data-line="1306"></span>.
</p>
<p class="p indent" data-line="1310"><span data-line="1310"></span>Timestamps are of type <span data-line="1310"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Timestamp_t</code><span data-line="1310"></span>, which is type <span data-line="1310"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;W&gt;</code><span data-line="1310"></span> for a
value of <span data-line="1311"></span><code class="code code1 language-p4 lang-p4 p4 colorized">W</code><span data-line="1311"></span> defined by the implementation.  Timestamps are expected
to wrap around during the normal passage of time.  It is recommended
that an implementation pick a rate of advance and a bit width such
that wrapping around occurs at most once every hour.  Making the wrap
time this long (or longer) makes timestamps more useful for several
use cases.
</p>
<ul class="ul list-dash compact" data-line="1318">
<li class="li ul-li list-dash-li compact-li" data-line="1318"><span data-line="1318"></span>Checking for timeouts of protocol hello / keep-alive traffic that is
on the order of seconds or minutes.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="1320"><span data-line="1320"></span>If timestamps are placed into packets without converting them to
other formats, then external data analysis systems using those
timestamps will in many cases need to do so, e.g. to compare
timestamps stored in packets by different PSA devices.  These
systems will need different formulas and/or parameters to perform
this conversion for each wrap period, or to add extra external time
references to the recorded data.  The extra data required for
accurate conversion is lower, and the likelihood of conversion
mistakes is lower, if the timestamp values wrap less often.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="1329"><span data-line="1329"></span>If timestamps are converted to other formats within a P4 program, it
will need access to parameters that are likely to change every wrap
time, e.g. at least a <span data-line="1331"></span>&#8220;base value&#8221;<span data-line="1331"></span> to add some calculated value to.
A straightforward way to do this requires the control plane to
update these values at least once or twice per timestamp wrap time.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="1334"><span data-line="1334"></span>Programs that wish to use <span data-line="1334"></span><code class="code code1 language-p4 lang-p4 p4 colorized">(egress_timestamp - ingress_timestamp)</code><span data-line="1334"></span>
to calculate the queueing latency experienced by a packet need the
wrap time to exceed the maximum queueing latency.
</li></ul>

<p class="p noindent" data-line="1338"><span data-line="1338"></span>Examples of the number of bits required for wrap times of at least one
hour:
</p>
<ul class="ul list-dash compact" data-line="1341">
<li class="li ul-li list-dash-li compact-li" data-line="1341"><span data-line="1341"></span>A 32-bit timestamp advancing by 1 per microsecond takes 1.19 hours
to wrap.
</li>
<li class="li ul-li list-dash-li compact-li" data-line="1343"><span data-line="1343"></span>A 42-bit timestamp advancing by 1 per nanosecond takes 1.22 hours to
wrap.
</li></ul>

<p class="p noindent" data-line="1346"><span data-line="1346"></span>A PSA implementation is not required to implement time
synchronization, e.g. via PTP<span data-line="1347"></span><sup id="back-fn-ptp" ><a href="#fn-ptp" title="4.https://&#8203;en.&#8203;wikipedia.&#8203;org/&#8203;wiki/&#8203;Precision_&#8203;Time_&#8203;Protocol
&#8617;" class="footnote-ref localref" ><span class="footnote-label">4</span></a></sup><span data-line="1347"></span> or NTP<span data-line="1347"></span><sup id="back-fn-ntp" ><a href="#fn-ntp" title="5.https://&#8203;en.&#8203;wikipedia.&#8203;org/&#8203;wiki/&#8203;Network_&#8203;Time_&#8203;Protocol
&#8617;" class="footnote-ref localref" ><span class="footnote-label">5</span></a></sup><span data-line="1347"></span>.
</p>
<p class="p indent" data-line="1352"><span data-line="1352"></span>TBD: This text has been written assuming that it is more important for
timestamps to be increasing at a constant rate, with no sudden <span data-line="1353"></span>&#8220;jumps&#8221;<span data-line="1353"></span>
due to time synchronization events.  Is this what people want from
timestamps?
</p>
<p class="p indent" data-line="1357"><span data-line="1357"></span>TBD: Some time synchronization methods avoid sudden <span data-line="1357"></span>&#8220;jumps&#8221;<span data-line="1357"></span> by
temporarily speeding up or slowing down the rate of increase by a
small percentage, until the desired synchronization is achieved.
(TBD: which ones?  citation?).  Would anyone mind if PSA
implementations were allowed to do this with their timestamp values?
</p>
<p class="p indent" data-line="1363"><span data-line="1363"></span>The control plane API excerpt below is intended to be added as part of
the P4Runtime API<span data-line="1364"></span><sup id="back-fn-p4runtimeapi" ><a href="#fn-p4runtimeapi" title="1.The P4Runtime API, defined as a Google Protocol
Buffer .proto file, can be found at
https://&#8203;github.&#8203;com/&#8203;p4lang/&#8203;PI/&#8203;blob/&#8203;master/&#8203;proto/&#8203;p4/&#8203;p4runtime.&#8203;proto
&#8617;" class="footnote-ref localref" ><span class="footnote-label">1</span></a></sup><span data-line="1364"></span>.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1366" data-line-first="1367" style="display:block"><code data-line="1367"><span style="color:darkgreen">// The TimestampInfo and Timestamp messages should be added to the</span>
<span style="color:darkgreen">// &quot;oneof&quot; inside of message &quot;Entity&quot;.</span>

<span style="color:darkgreen">// TimestampInfo is only intended to be read.  Attempts to update this</span>
<span style="color:darkgreen">// entity have no effect, and should return an error status that the</span>
<span style="color:darkgreen">// entity is read only.</span>

message TimestampInfo {
  <span style="color:darkgreen">// The number of bits in the device&#39;s `Timestamp_t` type.</span>
  uint32 size_in_bits = <span class="constant" style="color:purple">1</span>;
  <span style="color:darkgreen">// The timestamp value of this device increments</span>
  <span style="color:darkgreen">// `increments_per_period` times every `period_in_seconds` seconds.</span>
  uint64 increments_per_period = <span class="constant" style="color:purple">2</span>;
  uint64 period_in_seconds = <span class="constant" style="color:purple">3</span>;
}

<span style="color:darkgreen">// The timestamp value can be read or written.  Note that if there are</span>
<span style="color:darkgreen">// already timestamp values stored in tables or `Register` instances,</span>
<span style="color:darkgreen">// they will not be updated as a result of writing this timestamp</span>
<span style="color:darkgreen">// value.  Writing the device timestamp is intended only for</span>
<span style="color:darkgreen">// initialization and testing.</span>

message Timestamp {
  bytes value = <span class="constant" style="color:purple">1</span>;
}</code></pre>
<p class="p noindent para-continued" data-line="1394"><span data-line="1394"></span>For every packet <span data-line="1394"></span><code class="code code1 language-p4 lang-p4 p4 colorized">P</code><span data-line="1394"></span> that is processed by ingress and then egress,
with the minimum possible latency in the packet buffer, it is
guaranteed that the <span data-line="1396"></span><code class="code code1 language-p4 lang-p4 p4 colorized">egress_timestamp</code><span data-line="1396"></span> value for that packet will be
the same as, or slightly larger than, the <span data-line="1397"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ingress_timestamp</code><span data-line="1397"></span> value
that the packet was assigned on ingress.  By <span data-line="1398"></span>&#8220;slightly larger than&#8221;<span data-line="1398"></span>,
we mean that the difference <span data-line="1399"></span><code class="code code1 language-p4 lang-p4 p4 colorized">(egress_timestamp - ingress_timestamp)</code><span data-line="1399"></span>
should be a reasonably accurate estimate of this minimum possible
latency through the packet buffer, perhaps truncated down to 0 if
timestamps advance more slowly than this minimum latency.
</p>
<p class="p indent" data-line="1404"><span data-line="1404"></span>Consider two packets such that at the same time (e.g. the same clock
cycle), one is assigned its value of <span data-line="1405"></span><code class="code code1 language-p4 lang-p4 p4 colorized">ingress_timestamp</code><span data-line="1405"></span> near the time
it begins parsing, and the other is assigned its value of
<span data-line="1407"></span><code class="code code1 language-p4 lang-p4 p4 colorized">egress_timestamp</code><span data-line="1407"></span> near the time that it begins its egress processing.
It is allowed that these timestamps differ by a few tens of
nanoseconds (or by one <span data-line="1409"></span>&#8220;tick&#8221;<span data-line="1409"></span> of the timestamp, if one tick is larger
than that time), due to practical difficulties in making them always
equal.
</p>
<p class="p indent" data-line="1413"><span data-line="1413"></span>Recall that the binary operators <span data-line="1413"></span><code class="code code1 language-p4 lang-p4 p4 colorized">+</code><span data-line="1413"></span> and <span data-line="1413"></span><code class="code code1 language-p4 lang-p4 p4 colorized">-</code><span data-line="1413"></span> on the <span data-line="1413"></span><code class="code code1 language-p4 lang-p4 p4 colorized"><span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">bit</span>&lt;W&gt;</code><span data-line="1413"></span> type in
P4 are defined to perform wrap-around unsigned arithmetic.  Thus even
if a timestamp value wraps around from its maximum value back to 0,
you can always calculate the number of ticks that have elapsed from
timestamp <span data-line="1417"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAdCAYAAAAkXAW5AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABaklEQVRIx8WX0W2EMAxAnysGQB2BbsAKpRswAyPcDoxAR+iNcGxQlQ24EdrbwP0JkpWSQBEESxZB8TkPx+fEqCpHK1ACNyCfnU8AcAHUabEJArgCP0C1wjYHCqAGOvc7NVr+GwKojIPLgm3tLfgFNB7IJoh2yYEXhdIP+RqIjLhU00BVh5ihqj6AgQ3ytDBfumfPgRKEEJHKvN5OgQDezLg/C2J1PuwCISKjiKhVkw/4cyLS7gmRmdAXXkJOC727gjXJN3DfHUJV79axiNh86JJsx5n5EINIUh+CECnrQywSyepDDCJpPoQgkubDHwgRKc3r9RQIuxWnRcIk5cMVsLnTtUsViT4A0Hjlfdezw8+Hz4B9C7weGQn7hcNMFFrg44i/bRZb2NuGWlVfNqyRm/Fz6ILq9xjqTs7JQeeu7/nKTmvS2vibdHRtQGXs8lDHNLqr+rjUb3hXft2gjTgHu4iI5DNtQNROVR+/AFw+4vvcN5QAAAAASUVORK5CYII=" alt="$t1$" class="math-inline math-render-png math" style="height:0.7545em"><span data-line="1417"></span> until timestamp <span data-line="1417"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAdCAYAAADPa766AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB4UlEQVRIx82X4XGjQAyFP3muAE9KIB24hZAOXIPTAT2QDnwlhBJIOkjcAZQQ3IHyI/LN3oZlBdgz2Zkd2LW0PCPpPSGqym8Ym1scKiKliDQiMoiI2hxsbz/qpKpXm8AWaAEFjsABKO36YfsKDED5n6/j8GbMMWHb2QO3id8PARgF9i4g9m8uTpUDcJcCEdjVEZidB0gdOyTsdjmbKHwhkA8PkH9xzdgdLXyH3BsJ7EMwRc7hYtg6ciNMxFx44lypNlMlGCzbTMXeBfdby62p8R6t76d45DG4f515cH9NQisDrjllznkCTsAZeHbYF9H6PBZjz6xXEl9cwqWoKiJSRCh3Zgzw1zjiMj6BXlXPKySgC57Xq+r9Kv5Y+DZKN6F5+WMhkFBzmkmK9/LHAhD71Nmr9GWBMg8hrYdzs5I/5ow3A9MDD9l+5Bb5EWhLukW4dX4AlUuvEnKuwOGKyXnM2ibQK1BciS/qjF0B7OLNS785TMXbAaLwSoHlT5XKj2aij2idZVrPILh9Kj+qhNOQo3wT0HoGtyhQ/ElI82lEqGrgZUriRaQ1nmijxirVCjwahfRjcdUf3xzfIekcXbwumN1Y1TRhudmrO04R0Ui1zZ1titAqi/Ng18oR62EFkFpV+QImDmrl3dzOQAAAAABJRU5ErkJggg==" alt="$t2$" class="math-inline math-render-png math" style="height:0.7545em"><span data-line="1417"></span> using the expression <span data-line="1417"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJMAAAArCAYAAAB8fLoNAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAFUUlEQVR42u1d7ZHaSBB9TRGAjCMwm4GWi+BEBmwIhgzYcgRXOAPsDIwzYB2BV8oAOYIzyqDvBy3cEvoYfR4rzauagoXZ0WzrqftNz8cSM6MIROQAWDDzCyxGCSLyALwyc1RUb1LSyBzAL2vO0eM3gF9E5NYikxDJB/CP9UrjBjMHAD4C8IsIRVlhTkKbDyBg5idrTgvhxQ7AGsCHrJCX55kOAGbCxl5iMhEdiOhMRCzlLJ+t7G1s1dYuER3FYVT1UM8AQgA/8iokijCPAazS37VdADgAjnK9vVzbk1dfPmcAZwBe1/0ZegGwVTad12zDld/f3XyXcXPPAPwGHT6Y3nwAJyGNk/P9Wv3xvRD8zslQxbYOgDmAlTyo55Qt3Qb9OGYRMl1pJ5W8mhfxVGe3BoY55REpo0+NjfDGiVTFtquUzXx5MM8tkSnuyyGTTMJiBnBqcJGdSWeVq3QNn7CEYUZKpp0pEcRm7o3naIlMKqok2tECfCOv+wb6zksNJ/OwARABWJQJQRk1fFEfuZK2GBtMbQtmjpg5YOaww/48y+unGwGuWOs0YGvM+qMhq2NxXRbq0tppO0LPZGTbkjbObcqFuK2EZ5J0uQMgLEuZl6TcYxxLqs/Ue0c/dTl4Tf38MMLpDFPb9olA+rfWeaY4xDXJdC/V+5eK5Ahh0ZZt+0TclydNpjhF7vcR04W8geimzwb10xopGhmZqti2T/xM98+pGkdTmsek7FocydROXbwRbdSZbTvQTAnuTGuyfpnyFq7ccMjI65CacW4axvSUSjjwiee+bdtkAjgiokhItZiqjocVGgl1fSLSMX3fpisW8amNO+iJ5z5t2xJCIfzjRI2MmuiQLmP6Tr3/fofGHKte0t4RAOYT9dT/btCg28VIQ1YMXNse6XKYTmzbIiJNplkTz9RVDkQy41/jfAYzL8fGojvOL2V5ptlExFMTz9RVDuSH9C0E8LfNL929Z0Jjz9RFTCeivbj3AMBj3ax8TttrtQCvq3IYiV4CgH/jFNNUPJLToLFWYzoRbXGZi3vpKLS9yhB71qHbbysk3bteSmCq3js1brxeXH5ogUgrGb19YeZNR0PvAH+mj+5ZL7Vq2w7xPo5sExXe6jypXlsxXcTmAZfplU1BvXnZlpuhpQTu3DNdNfcEfxJkdUJdHIaivLUzon/KiDSX0PBZFq0X4RnlqwyGJL4b2bYHzLRnClvwTC95Yhe3k7RZKQDfkEgAsMA4Vhk0tm3Pnimc4jKxiKodS4WanznVdgbDel800rPBNR01yhssWrRtH5hrMsVrixwicioMwzX5ggyD7AB8KxrSEtFRvMwxlaDLu95SRPTQPVNj2/4PfT1OmTkgIu1avxs2UkSSNS7bkh4K6hyUK6+igcYQ4hrZ1iAk1ZU1RR70dZLq/F8VhtihIt5THIZEFG4APBZ0YovkshJYMrVjW32jVVllJFL3ksD1VL2qg7BFfE+YOUrv9DzW3CV6wmXh1QkGi/1xuyGwt4V2b3AHbiXb5mwPMy3rGptCr/eEmDkemp9kGPoOFkMQ8U7K20Vl9apOWxHRSTTTIzMH11NQRAx7AJb2CB0Lw9zgSULcA5A8BWWvY7SFRQluNu0mzmdSbutdmzP1FoP0TGcJjVdZNMlh2ydrLouS9ISD1PldNyfHiXZaIOd0MAsL8UohMydSFJOcWOgguZDfwiIm0i7LK2WSSRJmTwDWBlMcFuMikotL7muTNZVDeeeAq8MwH0cwF2ZRTiQHl2O8v+WtN6OiQ+Ulfe/VnAeyGBaZfNFJuakjMvgPBVsA7w3XGlkMk0hGHPgPrsvrttJk/5cAAAAASUVORK5CYII=" alt="$(t2 - t1)$" class="math-inline math-render-png math" style="vertical-align:-0.2797em;height:1.1187em"><span data-line="1417"></span>
(if more than <span data-line="1418"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADUAAAAjCAYAAAA0aUL2AAAACXBIWXMAAA7EAAAOxAGVKw4bAAACy0lEQVRYw9VY7XGbQBB9y6QAxiWgDpBTgUkHuITIHSiTEnAH2CVQguwOjDqAdBCpg82f1cxqzcEelmJ8MzeSjne626+3u4CZcekJoAbAoTmA347hAWQDe8oA9oBrCCWHZgB26rBG1tIRfKXwOwB5CK/2NIJvARTMjKsJJYdu1CVLB75Q+Mp5RgWg1WvfcN3Rq++ZA/83Bk9EqbjhWq8nVxZKX3LlwD+r76kDXwGomfn4P4XSlrqZ0Hop+KPHUkSUSww9vnt4zZgSnz/FSDuCSQF06nOQJc2eFkA+9CwZ0EBBRA0RHYiIZR5krfyAtTKnG/WOWNoA6Jl5Pwgw2jpRcC3MVchne5YHhDqdlmrHNC+03QVyXDZm1eCZCtzJBVIHPbsoWvY1ak8aELoIJOIi8H+bsTMTMWcjhruzTKIs+gRAB2UjwTqb1pUbvajl4wg+F+s9TR2ai1Zyh9ZTY612bgIOuZFJwFvzrPPcMwHwINq5lWQWHGJFraWciLKZCXUwxxjLrpSVtgBeguRgRmdIII3Q/DttBojgrPSx5DDiDTsvOVhL3ZgsXkwo4c38Xs2IqWcA9yPeMISvQvFuRzJwyf6SJYW9pJDD24Qbne5wQ0SFlxxgtNGK61WOwLd9jGfPQbm3x8V1y+Iih7MqnZl7W+VOjO/m985J67m494PDjfRzNznMrv0MsXSRCbiN6JEYwGFOvRlVpZ/8Wy3dR9Z/P534LhI/31KmBmwiW/syAp9OlUKj+yMOKm3+WOokubCnbf4jGtwz8xoLHt6YehWBegB3WPhIHFaqhY73ANberP6pYyKOtl8hhtxEoYih/koCBYVSPU3loOp88ULJRb01XT3VenzGTAaouwXwyMy/HCF5e+mq/uJEIeVJFZH1B9/4LCb5EtFOtdmeduWHlD60SEuZ11gxs1si+yXyQqOcqZN+qRXF7w/s3y9RqH9Od68MIChgRQAAAABJRU5ErkJggg==" alt="$2^W$" class="math-inline math-render-png math" style="height:0.9106em"><span data-line="1418"></span> ticks have elapsed, there will be aliasing of the
result).  For example, if timestamps were <span data-line="1419"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJcAAAAfCAYAAADqfF/MAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEeklEQVR42u1c4XXaMBD+Li8DuN2gZAOzAmwA3SBkA3iZIM9sYLJBzQawQQsb2N0geIPrj54bodqWZGNiE917+gHyGVv+7vTdJxliZnjz1tSIaATgAGDOzHu1746IIiJii3YqO7GlLxPRrOLiwqa+3nphMYAAwEjvuAPwAmAMYA4g0/qPAJ4ATOWYM2PmTPHdlPzwWvrGzLwtuzJmPsr5VwBypSsX/2mVr7cPz1ozAJPKA5j5XwMQAWClBWp/XRPkqr6Rra9yjoX4Jq6+vl23SbY6Kc97oR9zp2EtbYpiyWJtbQzgyMxznxd6b5EArNJ0cL1pn0ctfjxwTLEBgO8yjXrr93QYyrPauIAr1z5/dQRHI1+xVwCbC2VAb91aAuDRdJApcwWO4GjkS0QTACEzrzqKtICIFh4TFxnLJYDMpsjSwZU1yT6SJkOpLptkrliq0q7sO4CYiE4ivQQeJo01rWdb6nKnkfK8YfZJBByZK19TImHf1aAw80aRWpYATkQUy2B5c0sCLyU4scpcuj1YgGOhgOPNBZiSQZ47zloFwLbMPBZNbS+yR0pEiWReb2ZNa8TMa1ufMnDltlObgCNSwOEqZbxKJFyNxDPznpmnEjhbADMAByI6CPfzVv2snCr5MnC5ZB8dHLmhgiwj8euPGClmzkRP+4K/KwEhgB0RpZ78//esYgA/ZDXFaZB15XWHd9X1UKPQhgBS7bsZzlX6sMY/BTDpmeK8xLvqfAKwvMB5l9qYdNl2HYxLKGMRlPTFqFHo7w3T4siCxDvrZNcg8Q0yWbGWuZbMtQIQEVEk31sTWc2OMv12XaHmkhg60bQa3bsBjVyzBphUoFyNpFnNmtRoAOtnM/zdTlLcTzyE677g/S/rsqEpc5kIfR2JL1NobXSyq5P4DirM3a1XmJeo5MvAlRpIeVQ1RZR891Amtn4Uib9ghTlRKsxb3WuWtE0CpmrxjHcJOCYO4AgseNqQQFZWYSZSYd6MjNFE02qic+lT26sFOEp1MiHxxz6R+Jbk/wXvuwJGQw6aS2haZXZvkbkCAcfCssLLJKJV32L+Ht9AVI+kklwo9xvJEtOtaFp7AJnrGqx6PDPnpL+gIYOn8q4nAD8A/AbwzVSSEtEO71tfM2Z+IKIEwM+hca0SvvgsFWQhMaxMwSbT5dMVpAhIZbdueZ8p2u3jK2x9X8YriEgn5ZGDznM2LSokfj5QUE0kUxUBs5WxsFWrpwogr2FtA3gO+x0tsQLEtaazZVX6hapVHaAp8QZtJNb8e6XEO2pc6WfVuCzHKIWjQl9knyKNhxJ9LkrxmUI9JBIv3LLYH16o9k3V+U9tVeB6U8C1dQSHvjPicQCAKgqOhQKq1ZA5Yp/BlSlzqSs41Gpz1eeIr6j8Hv17ko0ssAVX3gIcuVIprnsKKr3y24ucsPcYMQZjIIR/qlWVT0SUA/hlIvRL1Gy3sXxZMuwhAZ3gfEtR0sfrHAiBN7UFfYY/IpGISxRxdyOZyr/G1kIkNfXff5JxmUgK95VfCzONm97/B2blaF1rfZyNAAAAAElFTkSuQmCC" alt="$W &gt;= 4$" class="math-inline math-render-png math" style="vertical-align:-0.0436em;height:0.8065em"><span data-line="1419"></span> bits in size,
<span data-line="1420"></span><img src="data:image/png;base64,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" alt="$t1=2^{W}-5$" class="math-inline math-render-png math" style="vertical-align:-0.0844em;height:0.9366em"><span data-line="1420"></span>, and <span data-line="1420"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAAAdCAYAAABL7VmUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADp0lEQVRo3u1a4XGbUAz+5PMAbkYgG5B0guAN3G4QZwPnMkEPb4AzQYI3wN0gZgOcDYo3UH9E9ORnHjwMtJeC7jhjeMA7fU/SJz0RM2OUfytENAPwBMAD4AO4AvAG4AAgZuad+cykp4kERBQTUU5ELEcu1xYjVCe6CgG8A5gBeAEwB3AHIAHwHUBCRBkRBScPMnNnh3w8AcAAIgBLAIH87uU6A8gBBF1++zMeopMYwMxy31M6YwDLP/ccXh67KhpAJpOxTWRpTGQxYNBC0ZdXM25l6MyrBU6spXhg5QBwZgPNmLCeiD9Q4HKlg6hinG/oK3IBLnRRsHq57+hO9UT2AwTN1AE31VcdOQlULEwrxj0AOAK4FYZkFWY+AtioSz4ReUMiJKKDS8f+cmGVvvzuHACeCSF5rwNP4qCWITLNYrEfAXyrYJ3mok4rgTPoZ1IziSt1PtOWapE34//10FBj5g0zf5FjWzHUBC6ps7i5Ot81BOIwZmidibbGXZGMTzqIb4XZp2L2a4fx5io6jvhYZal09FBcnIpbzEqUqd2mWRdbM/OjAvYA4KbBZL6Wmf8oZ3qPFWg3ouePe8xcBEDPICWhnG8kR9Os5tCEGZVMSC+UAzNfjzCd6MeX2uUCwBrAjzN9t8nfLsxhgq4T8JLqQp9H0mP5Kze+FdsqK9MO4ltTCdX5tqP3pwC2wmj7lGOPbv1OsfOCmT8ByIgoBXB/oisL+r2sLjH9Xlfuf1hhycuKzJOW+VvTPafnwkKYeT5GM6eqyb26FBXbYpOW+VsT+Skr6CBuYRQ38LZGuvRsA67z+EZEkTDVVGjtmLc1k1ddmSKi1bRFfdIVtJUkkbvRPV4smekVJyX5QyFxB6AthEVuRtBOeQQR7aUlYenwiFlCvJ3a3GRbixOSE5tVlpJxHj42X9OW33r4C+kAhA2vW5K0xCAcO10VcQ1+mn4W/SJ5BUWNHGhs0SsROoyNULO77tgG8CkScJzvaNe2cOC85SOx5W9xxQsSx9wjbFAxWAwoN/NKgJs5LO6TpiHbSlhV9En4Dg1DYcMtfG9giXUmuozg1u6RKWxys+TlGSUk0zeHAF6rYhERJRJIk7M+wPKtnbnaXRiSPEr839fFdtGjxub+JMYZJhyUuMjMocvrkpiRDbSctarjAYJJXuYJbcqPlCuLUNEr2UF1PhlwLTJQuwKR1HJ9ua4JV3ZmTBYQCh+cuTC+ku2IJkc4FpOxUAZS6DIXQyolbr8B6kqNkxMG3dsAAAAASUVORK5CYII=" alt="$t2=3$" class="math-inline math-render-png math" style="height:0.7545em"><span data-line="1420"></span>, then <span data-line="1420"></span><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAAArCAYAAACOwO+oAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAHJklEQVR42u1d7XHiOhQ9l6EAb7aCJR2QdPCgAzKvgpgOktkKMt4OyFawDzowW8EGOjCp4AU6uO8HV0EoNv6Q7EeQ7oyHJDggjnTutwQxM04JEUUAbpl5iSBeChGNALww8y6g4V56JeAPALwGmLyXNwCvRDQMUHRIQiHgCsBTsIJ+CzOvAdwDWAUituBp5Lmj4oKuAKyZ+S7AFETWRQIgBvAtuKYncYoB3AEYALgCsAHwAmCeZ9CKLOFc/vm+q5iDiOZEtCUilmsrf5uEaXWK9ZCIUlG0dS3ioyyo3wHJQmy3AKbCoSmAGwBPcktKRB+9CWY+ukTTMYCJ+ZzrC0AEIJX3m8l7j+RxJX9nAFsAo7bHc+kXgAcN00HD1xjK/ycB0yNcRmW8Ecuo1vX7es4jxRbAymIw86qkAZDJoKKC52Nt0XSiGM58outgG8mkT0TBbQ0shxbjSG2IfIHzElVdnxrHtmrdmzckJksbagMG8FBhQWVFBMwZk/XiuRBNWwXbiYHZShTa1hEJ1VjmgYQMpeRq3B/r82iaSgaQWQwmqTLJmkszrKFl3heUpxOdVCWQYDY0LZUrEmpejLdKMQfXtIFLnzLzUWJmKo8zi9h0ZKS1i2QKYAfgtixBIFm4Z+1PQymf+CZVsQUz75h5zcybFsfzKI/fPU/GRKL0bmuWfCDJzyMSxvL4bDEmlfVZVlhQkRD+tUKmbmX87mPGtCq2XdUOFx7PRZ5EUpqolEWVH1/eSShtSRGATdP6j7yGkrTk9it98LqWL5AX4/drz7RtHWy7lLVWF/NSDL7MKpbU/tbnsme4ojZadqz9vKxJqg2CuMK2S1Fj8b2hY6H9PJf6dlSgUAdSKlorb6JnuDqrLmIWIf1a4sIfFe43Y0DfujXqYNul/DHH56k85YRLr6ZVFGKmYnT+guEO1sqY4ZAZq3olDjODjUsonyTT1hq2cJgdzclcD0MjRO78pDhkq3Pr4v2GWnZsWKehEEUldubac28O3E1do2wuvKG8a2yt4iEi2mnZwbWvppCZfxDRxpgf5SVslQfIzLmJT8XgrIsalmWR2juN6xJb15ZQXlO1Yc1atihtXGkL86W3puVaRfN/+lqm0SbOajNmSfQA+MxiIp/jQd0a58XtNhnXhVjXNmXXUqZ5IGNf4FCKO7KKRHRkEfsaeG8Wb9xKDUsC2/fX9nRb1VnVBwsWszMSSqjxKcMNIpoL0e6ZeSGJmJ/4WEudEdG17EpBD4eaXRf1wTqvqz4AJJ079o19Z1wfzLOEV77Gg0QUEdFKyHajSg/SuXSHfQnH5NeDqq/2NHPZ1BK2VcP6LWP7kM71SM61PphnCX2WuXgs47xWQSHlNxzXE5VFjKwtYRsxCxHN5EOtRbM4m2giirWNw21dc0/iQQD4Vx4jH9kn1mwk+YrlCTdbWcWp8VTcFwtoA6DTmIWIHrDvY1225IK+YJ/qb8t9enPoOp57PBjk0Mj+VDHmfZZShloj4772fNSAMEPDJLtIxCQAnpl52gZiYlGm5z6zrrFtUb766pZKC9qgrqfCzEsiWkgMOehr4DWxDCNXMYskIebYt7E9lnzwyINShTNsWxbbnELeOph25N6mzPzDwWdv0jDxS0h41ZcXGDb80Mpd3BXtXSOiWZlVE2KlZQTUzH+Gy+/OcIJtB2KbU8j73F1uj7IhoY0BU+t309NYbGMJlyeC1kEJAdXxilUICOzbo3zYdWGNbceW0MmcMPMjM1NH19hyrOozRw02mqv7f/XEqqDuhBoxy5+C2xItcC2SlcSAjxXeUzXCXrQVdIhtFzJwScJPKAttPuqI8mCe+zjs7YuIKKpRDhjkmFZ9ISUA/jkVuxGR2taRGoXpovcbGxroUsUa2/9hrKmnJLwXr2VCRBPtxIFTSjYWl3vKzDvVdFr7SEEcDob6sLUI+xJDVuG0tSZNt5kHTdtW2J54XafbwXA4sIhRcmrehc+XjsNDxQb15OjcURy6vhOufw7mewc9DufGrE5NCuw65VNPJrYRtsbCUNckR+llOBy2rO6Lao4x9kUx1tw9kYl7OtHwT3A4b/TI2JmkSBtuPcnkxbMyTZCzpabulXi2UbQWtgXHRFa94oaKIpzGfaz8ZjjenL0Vdz0XX2JmVSLIJB3+BUEuIbkTGZm8Xdl9ddsDiSgTC3Dj4RYzd3OlvpVJkiQj7JtQQ5tUkDICKsW9YebrgEhz0c8dVYf+hq9CC1InxT4LUDiyhIZ78SV8/1yQEku4FRc2hC8OLaGu3b4HaIKcIGAsyZ/7gIZjS6jFhrcI38Ya5LQV3DDzTUDDvSVU1jBC/TacIH4QMAlWsGUSSkvYHYC4QitZEL8IOMS+djkNJYkW3VFD48XY14DCd0UEAkYAXrHvWZ0GRDogoQA/w77HMNSBAglXEgeGElaXJBTwHwB8rbjXL8hlEjCsgRblP7R6qca1wSKrAAAAAElFTkSuQmCC" alt="$(t2-t1)=8$" class="math-inline math-render-png math" style="vertical-align:-0.2797em;height:1.1187em"><span data-line="1420"></span>.
</p>
<p class="p indent" data-line="1422"><span data-line="1422"></span>It is sometimes useful to minimize storage costs by discarding some
bits of a timestamp value in a P4 program for use cases that do not
need the full wrap time or precision.  For example, an application
that only needs to detect protocol timeouts with an accuracy of 1
second can discard the least significant bits of a timestamp that
change more often than every 1 second.
</p>
<p class="p indent" data-line="1429"><span data-line="1429"></span>Another example is an application that needed full precision of the
least significant bits of a timestamp, but the combination of the
control plane and P4 program are designed to examine all entries of a
<span data-line="1432"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Register</code><span data-line="1432"></span> array where these partial timestamps are stored more often
than once every 5 seconds, to prevent wrapping.  In that case, the P4
program could discard the most significant bits of the timestamp so
that the remaining bits wrap every 8 seconds, and store those partial
timestamps in the <span data-line="1436"></span><code class="code code1 language-p4 lang-p4 p4 colorized">Register</code><span data-line="1436"></span> instance.
</p><h2 id="sec-programmable-blocks" class="h1" data-line="1439" data-heading-depth="1" style="display:block"><span data-line="1439"></span><span class="heading-before"><span class="heading-label">5</span>.&#8194;</span><span data-line="1439"></span>Programmable blocks</h2>
<p class="p noindent" data-line="1441"><span data-line="1441"></span>The following declarations provide a template for the programmable
blocks in the PSA. The P4 programmer is responsible for
implementing controls that match these interfaces and instantiate
them in a package definition.
</p>
<p class="p indent" data-line="1446"><span data-line="1446"></span>It uses the same user-defined metadata type <span data-line="1446"></span><code class="code code1 language-p4 lang-p4 p4 colorized">IM</code><span data-line="1446"></span> and header type <span data-line="1446"></span><code class="code code1 language-p4 lang-p4 p4 colorized">IH</code><span data-line="1446"></span>
for all ingress parsers and control blocks.  The egress parser and
control blocks can use the same types for those things, or different
types, as the P4 program author wishes.
</p>
<pre class="para-block pre-fenced pre-fenced3 language-p4 lang-p4 p4 colorized" data-line="1451" data-line-first="1452;psa.p4:589" style="display:block"><code data-line="1452;psa.p4:589"><span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">parser</span> IngressParser&lt;H, M&gt;(packet_in buffer,
                           <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> H parsed_hdr,
                           <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> M user_meta,
                           <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> psa_ingress_parser_input_metadata_t istd,
                           <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> psa_parser_output_metadata_t ostd);

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> Ingress&lt;H, M&gt;(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> H hdr, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> M user_meta,
                      PacketReplicationEngine pre,
                      <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span>    psa_ingress_input_metadata_t  istd,
                      <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_ingress_output_metadata_t ostd);

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">parser</span> EgressParser&lt;H, M&gt;(packet_in buffer,
                          <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> H parsed_hdr,
                          <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> M user_meta,
                          <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> psa_egress_parser_input_metadata_t istd,
                          <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">out</span> psa_parser_output_metadata_t ostd);

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> Egress&lt;H, M&gt;(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> H hdr, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> M user_meta,
                     BufferingQueueingEngine bqe,
                     <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span>    psa_egress_input_metadata_t  istd,
                     <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> psa_egress_output_metadata_t ostd);

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> ComputeChecksum&lt;H, M&gt;(<span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> H hdr, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">inout</span> M user_meta);

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">control</span> Deparser&lt;H&gt;(packet_out buffer, <span style="color:teal;font-weight:bold;font-family:monospace;font-size:10pt">in</span> H hdr);

<span style="color:blue;font-weight:bold;font-family:monospace;font-size:10pt">package</span> PSA_Switch&lt;IH, IM, EH, EM&gt;(IngressParser&lt;IH, IM&gt; ip,
                                   Ingress&lt;IH, IM&gt; ig,
                                   ComputeChecksum&lt;IH, IM&gt; ic,
                                   Deparser&lt;IH&gt; id,
                                   EgressParser&lt;EH, EM&gt; ep,
                                   Egress&lt;EH, EM&gt; eg,
                                   ComputeChecksum&lt;EH, EM&gt; ec,
                                   Deparser&lt;EH&gt; ed);</code></pre><span data-line=""></span>
<div class="footnotes madoko">
<hr >

<div id="fn-p4runtimeapi" class="footnote" data-line="1212" style="line-adjust:0">
<p class="p noindent" data-line="1212"><span data-line="1212"></span><span class="footnote-before"><sup><span class="footnote-label">1</span>.</sup></span><span data-line="1212"></span>The P4Runtime API, defined as a Google Protocol
Buffer <span data-line="1213"></span><code class="code code1 language-p4 lang-p4 p4 colorized">.proto</code><span data-line="1213"></span> file, can be found at
<span data-line="1214"></span><a href="https://github.com/p4lang/PI/blob/master/proto/p4/p4runtime.proto" class="texturl monospace">https://&#8203;github.&#8203;com/&#8203;p4lang/&#8203;PI/&#8203;blob/&#8203;master/&#8203;proto/&#8203;p4/&#8203;p4runtime.&#8203;proto</a><span data-line="1214"></span>
<span data-line="1215"></span><span data-line="1215"></span><a href="#back-fn-p4runtimeapi" class="footnote-backref localref">&#8617;</a></p></div>
<div id="fn-int" class="footnote" data-line="1298" style="line-adjust:0">
<p class="p noindent" data-line="1298"><span data-line="1298"></span><span class="footnote-before"><sup><span class="footnote-label">2</span>.</sup></span><span data-line="1298"></span><a href="http://p4.org/p4/inband-network-telemetry" class="texturl monospace">http://&#8203;p4.&#8203;org/&#8203;p4/&#8203;inband-&#8203;network-&#8203;telemetry</a><span data-line="1298"></span>
<span data-line="1299"></span><span data-line="1299"></span><a href="#back-fn-int" class="footnote-backref localref">&#8617;</a></p></div>
<div id="fn-dynamicfrequencyscaling" class="footnote" data-line="1308" style="line-adjust:0">
<p class="p noindent" data-line="1308"><span data-line="1308"></span><span class="footnote-before"><sup><span class="footnote-label">3</span>.</sup></span><span data-line="1308"></span><a href="https://en.wikipedia.org/wiki/Dynamic_frequency_scaling" class="texturl monospace">https://&#8203;en.&#8203;wikipedia.&#8203;org/&#8203;wiki/&#8203;Dynamic_&#8203;frequency_&#8203;scaling</a><span data-line="1308"></span>
<span data-line="1309"></span><span data-line="1309"></span><a href="#back-fn-dynamicfrequencyscaling" class="footnote-backref localref">&#8617;</a></p></div>
<div id="fn-ptp" class="footnote" data-line="1349" style="line-adjust:0">
<p class="p noindent" data-line="1349"><span data-line="1349"></span><span class="footnote-before"><sup><span class="footnote-label">4</span>.</sup></span><span data-line="1349"></span><a href="https://en.wikipedia.org/wiki/Precision_Time_Protocol" class="texturl monospace">https://&#8203;en.&#8203;wikipedia.&#8203;org/&#8203;wiki/&#8203;Precision_&#8203;Time_&#8203;Protocol</a><span data-line="1349"></span>
<span data-line="1350"></span><span data-line="1350"></span><a href="#back-fn-ptp" class="footnote-backref localref">&#8617;</a></p></div>
<div id="fn-ntp" class="footnote" data-line="1350" style="line-adjust:0">
<p class="p noindent" data-line="1350"><span data-line="1350"></span><span class="footnote-before"><sup><span class="footnote-label">5</span>.</sup></span><span data-line="1350"></span><a href="https://en.wikipedia.org/wiki/Network_Time_Protocol" class="texturl monospace">https://&#8203;en.&#8203;wikipedia.&#8203;org/&#8203;wiki/&#8203;Network_&#8203;Time_&#8203;Protocol</a><span data-line="1350"></span>
<span data-line="1351"></span><span data-line="1351"></span><a href="#back-fn-ntp" class="footnote-backref localref">&#8617;</a></p></div></div></div>
</body>

</html>
